---
phase: 39-accessibility-pass
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/src/components/accessibility/SkipLink.vue
  - app/src/components/accessibility/AriaLiveRegion.vue
  - app/src/components/accessibility/IconLegend.vue
  - app/src/composables/useAriaLive.ts
  - app/src/composables/index.ts
autonomous: true

must_haves:
  truths:
    - "SkipLink component renders a visually-hidden-focusable link that becomes visible on focus"
    - "AriaLiveRegion component renders a pre-existing aria-live region that announces messages to screen readers"
    - "IconLegend component renders an always-visible card with icon+label pairs"
    - "useAriaLive composable provides announce() function that updates live region text"
  artifacts:
    - path: "app/src/components/accessibility/SkipLink.vue"
      provides: "Skip to main content link"
      min_lines: 20
    - path: "app/src/components/accessibility/AriaLiveRegion.vue"
      provides: "Screen reader status announcement region"
      min_lines: 15
    - path: "app/src/components/accessibility/IconLegend.vue"
      provides: "Visual legend explaining symbolic icons"
      min_lines: 25
    - path: "app/src/composables/useAriaLive.ts"
      provides: "Composable for managing ARIA live region announcements"
      exports: ["useAriaLive"]
  key_links:
    - from: "app/src/composables/useAriaLive.ts"
      to: "app/src/components/accessibility/AriaLiveRegion.vue"
      via: "message and politeness refs bound to component props"
      pattern: "message|politeness"
    - from: "app/src/composables/index.ts"
      to: "app/src/composables/useAriaLive.ts"
      via: "barrel export"
      pattern: "useAriaLive"
---

<objective>
Create reusable accessibility foundation components and composable for WCAG 2.2 AA compliance.

Purpose: These components are required by all subsequent plans to add skip link, screen reader announcements, and icon legends to curation views.
Output: SkipLink.vue, AriaLiveRegion.vue, IconLegend.vue components and useAriaLive composable, all exported from composables barrel.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-accessibility-pass/39-CONTEXT.md
@.planning/phases/39-accessibility-pass/39-RESEARCH.md
@app/src/composables/index.ts
@app/src/components/ui/CategoryIcon.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create accessibility components (SkipLink, AriaLiveRegion, IconLegend)</name>
  <files>
    app/src/components/accessibility/SkipLink.vue
    app/src/components/accessibility/AriaLiveRegion.vue
    app/src/components/accessibility/IconLegend.vue
  </files>
  <action>
Create three Vue 3 components in `app/src/components/accessibility/`:

**SkipLink.vue:**
- Renders `<a href="#main" class="skip-link">Skip to main content</a>` as first focusable element
- Uses CSS: `position: fixed; top: 0; left: 0; opacity: 0; z-index: 9999; background: white; padding: 0.5em 1em; border: 2px solid black;` with `:focus { opacity: 1; }` (from RESEARCH.md Pattern 1)
- Also renders a `<span ref="backToTop" tabindex="-1" />` before the link
- Watches `route.path` and calls `backToTop.value?.focus()` on change to reset focus on navigation
- Uses `<script setup>` with Vue 3 Composition API
- Import `useRoute` from `vue-router` and `ref`, `watch` from `vue`

**AriaLiveRegion.vue:**
- Renders `<div role="status" :aria-live="politeness" aria-atomic="true" class="visually-hidden">{{ message }}</div>`
- Props: `message` (String), `politeness` (String, default 'polite', validator: ['polite', 'assertive'])
- Use Bootstrap's `.visually-hidden` class (NOT custom CSS) for screen-reader-only visibility
- CRITICAL: This component must be pre-rendered in DOM BEFORE content changes (per RESEARCH.md Pitfall 1). The component always exists; only its text content changes.
- Uses `<script setup>` with defineProps

**IconLegend.vue:**
- Renders a BCard with `body-class="p-2"` and `class="mb-3"`
- Inside: flex container with "Icon Legend:" label followed by icon+label pairs
- Props: `legendItems` (Array, required) where each item has `{ icon: string, color?: string, component?: string, componentProps?: object, label: string }`
- When `item.component` is provided, render that component dynamically (for CategoryIcon). When `item.icon` is provided, render `<i :class="item.icon" :style="{ color: item.color }" aria-hidden="true" />`
- Each item wrapped in `<div class="d-flex align-items-center gap-1">` with `<span class="small">{{ item.label }}</span>`
- Always visible (not collapsible) per RESEARCH.md decision
- Import BCard from bootstrap-vue-next
  </action>
  <verify>
All three files exist in `app/src/components/accessibility/`. Each component:
- Has `<template>`, `<script setup>`, and proper props
- SkipLink has route watcher and focus reset
- AriaLiveRegion uses `visually-hidden` class and has `role="status"` with `aria-live`
- IconLegend renders BCard with legendItems prop
  </verify>
  <done>Three accessibility components created with proper WCAG 2.2 patterns from research</done>
</task>

<task type="auto">
  <name>Task 2: Create useAriaLive composable and update barrel export</name>
  <files>
    app/src/composables/useAriaLive.ts
    app/src/composables/index.ts
  </files>
  <action>
**useAriaLive.ts:**
- Export named function `useAriaLive()` (NOT default export - follow useAriaLive pattern from RESEARCH.md)
- Returns `{ message, politeness, announce }`:
  - `message`: `ref('')` - current announcement text
  - `politeness`: `ref<'polite' | 'assertive'>('polite')` - current politeness level
  - `announce(text: string, level: 'polite' | 'assertive' = 'polite')`: Updates politeness and message, then clears message after 1000ms via setTimeout
- Fully typed with TypeScript
- Add JSDoc documenting the composable and each return value
- Export the `UseAriaLiveReturn` type

**composables/index.ts:**
- Add to the barrel exports at the end of the file:
```typescript
// Accessibility - ARIA live region announcements
export { useAriaLive } from './useAriaLive';
export type { UseAriaLiveReturn } from './useAriaLive';
```
- Do NOT change any existing exports
  </action>
  <verify>
`app/src/composables/useAriaLive.ts` exists with named export `useAriaLive`.
`app/src/composables/index.ts` includes the new useAriaLive export.
Run: `cd /home/bernt-popp/development/sysndd/app && npx vue-tsc --noEmit --pretty 2>&1 | head -30` to check for type errors (may show pre-existing errors; verify no NEW errors from our files).
  </verify>
  <done>useAriaLive composable created and exported from barrel. announce() updates message ref and auto-clears after timeout.</done>
</task>

</tasks>

<verification>
- All 4 new files exist: SkipLink.vue, AriaLiveRegion.vue, IconLegend.vue, useAriaLive.ts
- composables/index.ts barrel includes useAriaLive export
- No TypeScript compilation errors introduced
- Components follow RESEARCH.md patterns exactly
</verification>

<success_criteria>
- SkipLink component uses fixed positioning with opacity toggle on focus
- AriaLiveRegion pre-renders with visually-hidden class and role="status"
- IconLegend renders always-visible card with icon/label pairs
- useAriaLive composable provides announce() with auto-clear
- All new files use script setup and TypeScript where applicable
</success_criteria>

<output>
After completion, create `.planning/phases/39-accessibility-pass/39-01-SUMMARY.md`
</output>
