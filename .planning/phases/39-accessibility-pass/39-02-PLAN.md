---
phase: 39-accessibility-pass
plan: 02
type: execute
wave: 2
depends_on: ["39-01"]
files_modified:
  - app/src/App.vue
  - app/src/views/curate/ApproveUser.vue
  - app/src/views/curate/ApproveReview.vue
  - app/src/views/curate/ApproveStatus.vue
autonomous: true

must_haves:
  truths:
    - "App.vue has skip link as first focusable element and semantic landmarks (main with id='main')"
    - "ApproveUser, ApproveReview, ApproveStatus views have AriaLiveRegion that announces action outcomes"
    - "ApproveReview and ApproveStatus views have IconLegend explaining category/status icons"
    - "All decorative icons in action buttons have aria-hidden='true'"
    - "All BModal instances in ApproveUser, ApproveReview, ApproveStatus have a title prop (or aria-label/aria-labelledby) announcing their purpose"
  artifacts:
    - path: "app/src/App.vue"
      provides: "Skip link and semantic landmarks"
      contains: "SkipLink"
    - path: "app/src/views/curate/ApproveUser.vue"
      provides: "AriaLiveRegion integration, aria-hidden on decorative icons, modal titles"
      contains: "AriaLiveRegion"
    - path: "app/src/views/curate/ApproveReview.vue"
      provides: "AriaLiveRegion + IconLegend integration, modal titles"
      contains: "IconLegend"
    - path: "app/src/views/curate/ApproveStatus.vue"
      provides: "AriaLiveRegion + IconLegend integration, modal titles"
      contains: "IconLegend"
  key_links:
    - from: "app/src/App.vue"
      to: "app/src/components/accessibility/SkipLink.vue"
      via: "component import and template usage"
      pattern: "SkipLink"
    - from: "app/src/views/curate/ApproveUser.vue"
      to: "app/src/composables/useAriaLive.ts"
      via: "composable import in setup"
      pattern: "useAriaLive"
    - from: "app/src/views/curate/ApproveReview.vue"
      to: "app/src/components/accessibility/IconLegend.vue"
      via: "component import and template usage"
      pattern: "IconLegend"
---

<objective>
Add skip link and semantic landmarks to App.vue, then integrate AriaLiveRegion, IconLegend, aria-hidden on decorative icons, and modal title audit into ApproveUser, ApproveReview, and ApproveStatus views.

Purpose: Enables keyboard users to skip navigation, announces action outcomes to screen readers, provides visual legend for symbolic icons, prevents double-announcement of decorative icons, and ensures all modals announce their purpose to screen readers.
Output: App.vue with skip link + landmarks, 3 curation views with live regions + icon legends + aria-hidden + modal titles.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-accessibility-pass/39-CONTEXT.md
@.planning/phases/39-accessibility-pass/39-RESEARCH.md
@.planning/phases/39-accessibility-pass/39-01-SUMMARY.md
@app/src/App.vue
@app/src/views/curate/ApproveUser.vue
@app/src/views/curate/ApproveReview.vue
@app/src/views/curate/ApproveStatus.vue
@app/src/composables/useColorAndSymbols.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add skip link and semantic landmarks to App.vue</name>
  <files>app/src/App.vue</files>
  <action>
Modify App.vue template to add accessibility landmarks:

1. **Import SkipLink component** and register it in the components object.

2. **Add SkipLink before navbar** in the template:
```html
<SkipLink />
<div id="navbar">
  <Navbar />
</div>
```

3. **Wrap router-view content in semantic `<main>` element**:
Change the content div to use `<main>` tag with `id="main"` and `tabindex="-1"`:
```html
<main
  id="main"
  ref="scroll"
  class="content-style scrollable-content"
  tabindex="-1"
>
  <router-view :key="$route.fullPath" />
</main>
```
Remove the old `<div id="content" ...>` wrapper. The `id="main"` is the target of the skip link's `href="#main"`.

4. **Add role attributes for older browser support** (per RESEARCH.md):
- The `<main>` element already has implicit "main" role
- Keep existing structure for navbar and footer divs

5. **Do NOT change any existing functionality** - scroll behavior, toast provider, etc. must remain intact.

NOTE: The App.vue uses Options API (not script setup). Keep the existing pattern. Just add the SkipLink import and component registration.
  </action>
  <verify>
App.vue has SkipLink component imported and rendered before navbar.
Content area uses `<main id="main" tabindex="-1">` instead of `<div id="content">`.
App still renders correctly: `cd /home/bernt-popp/development/sysndd/app && npx vue-tsc --noEmit --pretty 2>&1 | head -30`
  </verify>
  <done>Skip link is first focusable element, main content has semantic landmark with id="main" target for skip link</done>
</task>

<task type="auto">
  <name>Task 2: Add AriaLiveRegion, IconLegend, and aria-hidden to ApproveUser, ApproveReview, ApproveStatus</name>
  <files>
    app/src/views/curate/ApproveUser.vue
    app/src/views/curate/ApproveReview.vue
    app/src/views/curate/ApproveStatus.vue
  </files>
  <action>
For each of the 3 views, apply these accessibility enhancements:

**All 3 views - AriaLiveRegion integration:**
1. Import `AriaLiveRegion` from `@/components/accessibility/AriaLiveRegion.vue`
2. Import `useAriaLive` from `@/composables`
3. In setup(), call `const { message: a11yMessage, politeness: a11yPoliteness, announce } = useAriaLive()` and return these
4. Add `<AriaLiveRegion :message="a11yMessage" :politeness="a11yPoliteness" />` at the END of the template (inside the root div, after all other content)
5. After successful API actions (approve, reject, submit), call `announce('User approved successfully')` (or appropriate message). Find the `makeToast()` calls for success and add `this.announce(...)` right after each one with the same message text. Use `'assertive'` politeness only for error announcements.

**All 3 views - aria-hidden on decorative icons:**
6. Find all `<i class="bi bi-*" />` icons inside buttons that already have `aria-label` attributes. Add `aria-hidden="true"` to these icons to prevent screen readers from double-announcing. Example: `<i class="bi bi-check-lg" aria-hidden="true" />`. This applies to ALL icon `<i>` elements inside `<BButton>` elements that have aria-label.
7. Also add `aria-hidden="true"` to decorative icons in table cells that are purely visual (like the person icon circle in ApproveUser's user_name cell, the envelope icon in email cell, the calendar icon, etc.).

**ApproveReview and ApproveStatus only - IconLegend:**
8. Import `IconLegend` from `@/components/accessibility/IconLegend.vue`
9. Import `CategoryIcon` if not already imported
10. Place `<IconLegend :legend-items="legendItems" />` ABOVE the main table (after the filter rows, before the BSpinner/BTable section)
11. Define `legendItems` as a computed property or data property:

For **ApproveReview**, the legend should include:
```javascript
legendItems: [
  { icon: 'bi bi-stoplights-fill', color: '#4caf50', label: 'Definitive' },
  { icon: 'bi bi-stoplights-fill', color: '#2196f3', label: 'Moderate' },
  { icon: 'bi bi-stoplights-fill', color: '#ff9800', label: 'Limited' },
  { icon: 'bi bi-stoplights-fill', color: '#f44336', label: 'Refuted' },
  { icon: 'bi bi-exclamation-triangle-fill', color: '#dc3545', label: 'Status change pending' },
  { icon: 'bi bi-eye', color: '#0d6efd', label: 'Toggle details' },
  { icon: 'bi bi-pen', color: '#6c757d', label: 'Edit review' },
  { icon: 'bi bi-check2-circle', color: '#dc3545', label: 'Approve review' },
]
```

For **ApproveStatus**, the legend should include:
```javascript
legendItems: [
  { icon: 'bi bi-stoplights-fill', color: '#4caf50', label: 'Definitive' },
  { icon: 'bi bi-stoplights-fill', color: '#2196f3', label: 'Moderate' },
  { icon: 'bi bi-stoplights-fill', color: '#ff9800', label: 'Limited' },
  { icon: 'bi bi-stoplights-fill', color: '#f44336', label: 'Refuted' },
  { icon: 'bi bi-check-circle-fill', color: '#198754', label: 'No problems' },
  { icon: 'bi bi-exclamation-triangle-fill', color: '#dc3545', label: 'Problematic' },
  { icon: 'bi bi-eye', color: '#0d6efd', label: 'Toggle details' },
  { icon: 'bi bi-pen', color: '#6c757d', label: 'Edit status' },
  { icon: 'bi bi-check2-circle', color: '#dc3545', label: 'Approve status' },
]
```

**ApproveUser only** (no legend needed - simpler table without symbolic icons):
- Only AriaLiveRegion and aria-hidden changes apply

**IMPORTANT:** These views use Options API. Add imports to components object, add useAriaLive to setup() return, add announce calls in methods alongside makeToast calls.
  </action>
  <verify>
Each of the 3 views:
- Has AriaLiveRegion component rendered in template
- Has useAriaLive imported and returned from setup()
- Has announce() calls after successful actions
- Has aria-hidden="true" on decorative icons inside labeled buttons
- ApproveReview and ApproveStatus have IconLegend with correct items
TypeScript check: `cd /home/bernt-popp/development/sysndd/app && npx vue-tsc --noEmit --pretty 2>&1 | head -30`
  </verify>
  <done>
ApproveUser has live region announcing approve/reject outcomes.
ApproveReview has live region + icon legend with category/action icons.
ApproveStatus has live region + icon legend with category/problematic/action icons.
All decorative icons have aria-hidden="true".
  </done>
</task>

<task type="auto">
  <name>Task 3: Audit and fix modal titles in ApproveUser, ApproveReview, ApproveStatus</name>
  <files>
    app/src/views/curate/ApproveUser.vue
    app/src/views/curate/ApproveReview.vue
    app/src/views/curate/ApproveStatus.vue
  </files>
  <action>
Audit every `<BModal>` instance in these 3 views and ensure each has a descriptive `title` prop so screen readers can announce the modal's purpose (RESEARCH.md Pitfall 6). BModal automatically sets `aria-labelledby` from its title prop.

**For each BModal found:**
1. Check if it already has a `title` prop or a `<template #title>` slot.
2. If YES: verify the title is descriptive (not empty, not generic like "Modal"). No change needed if descriptive.
3. If NO: add a `title` prop with a descriptive string that announces the modal's purpose.

**Expected modals by view:**

**ApproveUser.vue:**
- User approval confirmation modal -> title: "Approve User" (or similar)
- User rejection confirmation modal -> title: "Reject User" (or similar)
- Any other action modals

**ApproveReview.vue:**
- Review edit modal -> title: "Edit Review"
- Review approval confirmation modal -> title: "Approve Review"
- Any detail/preview modals

**ApproveStatus.vue:**
- Status edit modal -> title: "Edit Status"
- Status approval confirmation modal -> title: "Approve Status"
- Any detail/preview modals

**Rules:**
- Use short, action-oriented titles: "Approve User", "Edit Review", "Confirm Rejection"
- If a modal already has a visible title via `<template #title>`, that is sufficient -- BModal connects it via `aria-labelledby` automatically
- If a modal intentionally has NO visible title but needs one for screen readers, use the `title` prop (BModal renders it as an `<h5>` in the header) OR use `aria-label` directly on the BModal if no visible title is desired
- Do NOT add `titleVisuallyHidden` unless the design specifically needs to hide the title visually -- prefer visible titles
- Check for `header-close-label="Close"` or `header-close-label="Close modal"` on each BModal -- add it if missing, so the close button is announced properly

**IMPORTANT:** Read the FULL source of each view before editing to find ALL BModal instances. Some views may have multiple modals (e.g., one per action type). Do not miss any.
  </action>
  <verify>
For each view, grep for BModal and verify every instance has a title:
```bash
cd /home/bernt-popp/development/sysndd/app && grep -n 'BModal\|b-modal' src/views/curate/ApproveUser.vue src/views/curate/ApproveReview.vue src/views/curate/ApproveStatus.vue | head -30
```
Every BModal instance should have either a `title` prop, a `<template #title>` slot, or an `aria-label` attribute.
Each BModal should have `header-close-label` for accessible close button.
  </verify>
  <done>
All BModal instances in ApproveUser, ApproveReview, and ApproveStatus have descriptive titles that screen readers can announce.
All modal close buttons have accessible labels.
Success Criteria #3 (modal titles) is satisfied for these 3 views.
  </done>
</task>

</tasks>

<verification>
- App.vue renders SkipLink before navbar and uses semantic main element
- All 3 views have AriaLiveRegion at end of template
- ApproveReview and ApproveStatus have IconLegend above table
- All icon elements inside labeled buttons have aria-hidden="true"
- All BModal instances across the 3 views have descriptive title props or equivalent aria-label
- All BModal close buttons have header-close-label
- No visual or functional regressions
</verification>

<success_criteria>
- Pressing Tab on page load focuses skip link first
- Skip link navigates to main content area
- Screen readers announce action results via live region
- Icon legends visible above tables in ApproveReview and ApproveStatus
- Decorative icons hidden from screen readers
- All modals announce their purpose when opened (title or aria-label present)
</success_criteria>

<output>
After completion, create `.planning/phases/39-accessibility-pass/39-02-SUMMARY.md`
</output>
