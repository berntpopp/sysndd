---
phase: 39-accessibility-pass
plan: 02
type: execute
wave: 2
depends_on: ["39-01"]
files_modified:
  - app/src/App.vue
  - app/src/views/curate/ApproveUser.vue
  - app/src/views/curate/ApproveReview.vue
  - app/src/views/curate/ApproveStatus.vue
autonomous: true

must_haves:
  truths:
    - "App.vue has skip link as first focusable element and semantic landmarks (main with id='main')"
    - "ApproveUser, ApproveReview, ApproveStatus views have AriaLiveRegion that announces action outcomes"
    - "ApproveReview and ApproveStatus views have IconLegend explaining category/status icons"
    - "All decorative icons in action buttons have aria-hidden='true'"
  artifacts:
    - path: "app/src/App.vue"
      provides: "Skip link and semantic landmarks"
      contains: "SkipLink"
    - path: "app/src/views/curate/ApproveUser.vue"
      provides: "AriaLiveRegion integration and aria-hidden on decorative icons"
      contains: "AriaLiveRegion"
    - path: "app/src/views/curate/ApproveReview.vue"
      provides: "AriaLiveRegion + IconLegend integration"
      contains: "IconLegend"
    - path: "app/src/views/curate/ApproveStatus.vue"
      provides: "AriaLiveRegion + IconLegend integration"
      contains: "IconLegend"
  key_links:
    - from: "app/src/App.vue"
      to: "app/src/components/accessibility/SkipLink.vue"
      via: "component import and template usage"
      pattern: "SkipLink"
    - from: "app/src/views/curate/ApproveUser.vue"
      to: "app/src/composables/useAriaLive.ts"
      via: "composable import in setup"
      pattern: "useAriaLive"
    - from: "app/src/views/curate/ApproveReview.vue"
      to: "app/src/components/accessibility/IconLegend.vue"
      via: "component import and template usage"
      pattern: "IconLegend"
---

<objective>
Add skip link and semantic landmarks to App.vue, then integrate AriaLiveRegion, IconLegend, and aria-hidden on decorative icons into ApproveUser, ApproveReview, and ApproveStatus views.

Purpose: Enables keyboard users to skip navigation, announces action outcomes to screen readers, provides visual legend for symbolic icons, and prevents double-announcement of decorative icons.
Output: App.vue with skip link + landmarks, 3 curation views with live regions + icon legends + aria-hidden.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-accessibility-pass/39-CONTEXT.md
@.planning/phases/39-accessibility-pass/39-RESEARCH.md
@.planning/phases/39-accessibility-pass/39-01-SUMMARY.md
@app/src/App.vue
@app/src/views/curate/ApproveUser.vue
@app/src/views/curate/ApproveReview.vue
@app/src/views/curate/ApproveStatus.vue
@app/src/composables/useColorAndSymbols.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add skip link and semantic landmarks to App.vue</name>
  <files>app/src/App.vue</files>
  <action>
Modify App.vue template to add accessibility landmarks:

1. **Import SkipLink component** and register it in the components object.

2. **Add SkipLink before navbar** in the template:
```html
<SkipLink />
<div id="navbar">
  <Navbar />
</div>
```

3. **Wrap router-view content in semantic `<main>` element**:
Change the content div to use `<main>` tag with `id="main"` and `tabindex="-1"`:
```html
<main
  id="main"
  ref="scroll"
  class="content-style scrollable-content"
  tabindex="-1"
>
  <router-view :key="$route.fullPath" />
</main>
```
Remove the old `<div id="content" ...>` wrapper. The `id="main"` is the target of the skip link's `href="#main"`.

4. **Add role attributes for older browser support** (per RESEARCH.md):
- The `<main>` element already has implicit "main" role
- Keep existing structure for navbar and footer divs

5. **Do NOT change any existing functionality** - scroll behavior, toast provider, etc. must remain intact.

NOTE: The App.vue uses Options API (not script setup). Keep the existing pattern. Just add the SkipLink import and component registration.
  </action>
  <verify>
App.vue has SkipLink component imported and rendered before navbar.
Content area uses `<main id="main" tabindex="-1">` instead of `<div id="content">`.
App still renders correctly: `cd /home/bernt-popp/development/sysndd/app && npx vue-tsc --noEmit --pretty 2>&1 | head -30`
  </verify>
  <done>Skip link is first focusable element, main content has semantic landmark with id="main" target for skip link</done>
</task>

<task type="auto">
  <name>Task 2: Add AriaLiveRegion, IconLegend, and aria-hidden to ApproveUser, ApproveReview, ApproveStatus</name>
  <files>
    app/src/views/curate/ApproveUser.vue
    app/src/views/curate/ApproveReview.vue
    app/src/views/curate/ApproveStatus.vue
  </files>
  <action>
For each of the 3 views, apply these accessibility enhancements:

**All 3 views - AriaLiveRegion integration:**
1. Import `AriaLiveRegion` from `@/components/accessibility/AriaLiveRegion.vue`
2. Import `useAriaLive` from `@/composables`
3. In setup(), call `const { message: a11yMessage, politeness: a11yPoliteness, announce } = useAriaLive()` and return these
4. Add `<AriaLiveRegion :message="a11yMessage" :politeness="a11yPoliteness" />` at the END of the template (inside the root div, after all other content)
5. After successful API actions (approve, reject, submit), call `announce('User approved successfully')` (or appropriate message). Find the `makeToast()` calls for success and add `this.announce(...)` right after each one with the same message text. Use `'assertive'` politeness only for error announcements.

**All 3 views - aria-hidden on decorative icons:**
6. Find all `<i class="bi bi-*" />` icons inside buttons that already have `aria-label` attributes. Add `aria-hidden="true"` to these icons to prevent screen readers from double-announcing. Example: `<i class="bi bi-check-lg" aria-hidden="true" />`. This applies to ALL icon `<i>` elements inside `<BButton>` elements that have aria-label.
7. Also add `aria-hidden="true"` to decorative icons in table cells that are purely visual (like the person icon circle in ApproveUser's user_name cell, the envelope icon in email cell, the calendar icon, etc.).

**ApproveReview and ApproveStatus only - IconLegend:**
8. Import `IconLegend` from `@/components/accessibility/IconLegend.vue`
9. Import `CategoryIcon` if not already imported
10. Place `<IconLegend :legend-items="legendItems" />` ABOVE the main table (after the filter rows, before the BSpinner/BTable section)
11. Define `legendItems` as a computed property or data property:

For **ApproveReview**, the legend should include:
```javascript
legendItems: [
  { icon: 'bi bi-stoplights-fill', color: '#4caf50', label: 'Definitive' },
  { icon: 'bi bi-stoplights-fill', color: '#2196f3', label: 'Moderate' },
  { icon: 'bi bi-stoplights-fill', color: '#ff9800', label: 'Limited' },
  { icon: 'bi bi-stoplights-fill', color: '#f44336', label: 'Refuted' },
  { icon: 'bi bi-exclamation-triangle-fill', color: '#dc3545', label: 'Status change pending' },
  { icon: 'bi bi-eye', color: '#0d6efd', label: 'Toggle details' },
  { icon: 'bi bi-pen', color: '#6c757d', label: 'Edit review' },
  { icon: 'bi bi-check2-circle', color: '#dc3545', label: 'Approve review' },
]
```

For **ApproveStatus**, the legend should include:
```javascript
legendItems: [
  { icon: 'bi bi-stoplights-fill', color: '#4caf50', label: 'Definitive' },
  { icon: 'bi bi-stoplights-fill', color: '#2196f3', label: 'Moderate' },
  { icon: 'bi bi-stoplights-fill', color: '#ff9800', label: 'Limited' },
  { icon: 'bi bi-stoplights-fill', color: '#f44336', label: 'Refuted' },
  { icon: 'bi bi-check-circle-fill', color: '#198754', label: 'No problems' },
  { icon: 'bi bi-exclamation-triangle-fill', color: '#dc3545', label: 'Problematic' },
  { icon: 'bi bi-eye', color: '#0d6efd', label: 'Toggle details' },
  { icon: 'bi bi-pen', color: '#6c757d', label: 'Edit status' },
  { icon: 'bi bi-check2-circle', color: '#dc3545', label: 'Approve status' },
]
```

**ApproveUser only** (no legend needed - simpler table without symbolic icons):
- Only AriaLiveRegion and aria-hidden changes apply

**IMPORTANT:** These views use Options API. Add imports to components object, add useAriaLive to setup() return, add announce calls in methods alongside makeToast calls.
  </action>
  <verify>
Each of the 3 views:
- Has AriaLiveRegion component rendered in template
- Has useAriaLive imported and returned from setup()
- Has announce() calls after successful actions
- Has aria-hidden="true" on decorative icons inside labeled buttons
- ApproveReview and ApproveStatus have IconLegend with correct items
TypeScript check: `cd /home/bernt-popp/development/sysndd/app && npx vue-tsc --noEmit --pretty 2>&1 | head -30`
  </verify>
  <done>
ApproveUser has live region announcing approve/reject outcomes.
ApproveReview has live region + icon legend with category/action icons.
ApproveStatus has live region + icon legend with category/problematic/action icons.
All decorative icons have aria-hidden="true".
  </done>
</task>

</tasks>

<verification>
- App.vue renders SkipLink before navbar and uses semantic main element
- All 3 views have AriaLiveRegion at end of template
- ApproveReview and ApproveStatus have IconLegend above table
- All icon elements inside labeled buttons have aria-hidden="true"
- No visual or functional regressions
</verification>

<success_criteria>
- Pressing Tab on page load focuses skip link first
- Skip link navigates to main content area
- Screen readers announce action results via live region
- Icon legends visible above tables in ApproveReview and ApproveStatus
- Decorative icons hidden from screen readers
</success_criteria>

<output>
After completion, create `.planning/phases/39-accessibility-pass/39-02-SUMMARY.md`
</output>
