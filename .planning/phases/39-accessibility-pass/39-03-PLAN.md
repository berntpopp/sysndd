---
phase: 39-accessibility-pass
plan: 03
type: execute
wave: 2
depends_on: ["39-01"]
files_modified:
  - app/src/views/curate/ModifyEntity.vue
  - app/src/views/curate/ManageReReview.vue
  - app/src/views/review/Review.vue
autonomous: true

must_haves:
  truths:
    - "ModifyEntity, ManageReReview, and Review views have AriaLiveRegion that announces action outcomes"
    - "ModifyEntity has IconLegend explaining category and NDD status icons"
    - "ManageReReview has IconLegend explaining batch/assignment icons"
    - "All decorative icons in action buttons have aria-hidden='true'"
    - "All BModal instances in ModifyEntity, ManageReReview, and Review have a title prop (or aria-label/aria-labelledby) announcing their purpose"
  artifacts:
    - path: "app/src/views/curate/ModifyEntity.vue"
      provides: "AriaLiveRegion + IconLegend + aria-hidden + modal titles integration"
      contains: "AriaLiveRegion"
    - path: "app/src/views/curate/ManageReReview.vue"
      provides: "AriaLiveRegion + IconLegend + aria-hidden + modal titles integration"
      contains: "AriaLiveRegion"
    - path: "app/src/views/review/Review.vue"
      provides: "AriaLiveRegion + IconLegend + aria-hidden integration"
      contains: "AriaLiveRegion"
  key_links:
    - from: "app/src/views/curate/ModifyEntity.vue"
      to: "app/src/composables/useAriaLive.ts"
      via: "composable import in setup"
      pattern: "useAriaLive"
    - from: "app/src/views/curate/ManageReReview.vue"
      to: "app/src/components/accessibility/IconLegend.vue"
      via: "component import and template usage"
      pattern: "IconLegend"
---

<objective>
Integrate AriaLiveRegion, IconLegend, aria-hidden on decorative icons, and modal title audit into ModifyEntity, ManageReReview, and Review views.

Purpose: Complete accessibility coverage for the remaining 3 curation views with screen reader announcements, icon legends, proper decorative icon handling, and modal titles that announce purpose to screen readers.
Output: 3 curation views with ARIA live regions, icon legends where applicable, aria-hidden on decorative icons, and all modals properly titled.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-accessibility-pass/39-CONTEXT.md
@.planning/phases/39-accessibility-pass/39-RESEARCH.md
@.planning/phases/39-accessibility-pass/39-01-SUMMARY.md
@app/src/views/curate/ModifyEntity.vue
@app/src/views/curate/ManageReReview.vue
@app/src/views/review/Review.vue
@app/src/composables/useColorAndSymbols.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add AriaLiveRegion, IconLegend, and aria-hidden to ModifyEntity.vue</name>
  <files>app/src/views/curate/ModifyEntity.vue</files>
  <action>
Enhance ModifyEntity.vue with accessibility features:

1. **Import components and composable:**
   - Import `AriaLiveRegion` from `@/components/accessibility/AriaLiveRegion.vue`
   - Import `IconLegend` from `@/components/accessibility/IconLegend.vue`
   - Import `useAriaLive` from `@/composables`
   - Register AriaLiveRegion and IconLegend in components object

2. **Setup useAriaLive:**
   - In setup(), call `const { message: a11yMessage, politeness: a11yPoliteness, announce } = useAriaLive()` and add to return object

3. **Add AriaLiveRegion** at end of template (inside root div, after all modals):
   `<AriaLiveRegion :message="a11yMessage" :politeness="a11yPoliteness" />`

4. **Add IconLegend** after the entity preview card (when entity is loaded), before the modification action buttons. ModifyEntity shows category stoplight icons and NDD status icons. The legend items:
```javascript
legendItems: [
  { icon: 'bi bi-stoplights-fill', color: '#4caf50', label: 'Definitive' },
  { icon: 'bi bi-stoplights-fill', color: '#2196f3', label: 'Moderate' },
  { icon: 'bi bi-stoplights-fill', color: '#ff9800', label: 'Limited' },
  { icon: 'bi bi-stoplights-fill', color: '#f44336', label: 'Refuted' },
  { icon: 'bi bi-check', color: '#198754', label: 'NDD: Yes' },
  { icon: 'bi bi-x', color: '#ffc107', label: 'NDD: No' },
]
```
Add as a data property. Only render IconLegend when `entity_loaded && entity_info.entity_id` (same condition as the entity preview card).

5. **Add aria-hidden="true"** to all decorative `<i>` elements inside buttons that have aria-label or title attributes. Also add to purely decorative icons in the entity preview card that are accompanied by text labels.

6. **Add announce() calls** alongside existing makeToast() calls for success/error in methods like submit handlers. Use `this.announce('Review submitted successfully')` pattern. Use 'assertive' only for errors.
  </action>
  <verify>
ModifyEntity.vue has AriaLiveRegion, IconLegend (conditional on entity loaded), aria-hidden on decorative icons, and announce() calls.
  </verify>
  <done>ModifyEntity has live region, icon legend for category/NDD icons, and proper aria-hidden on decorative icons</done>
</task>

<task type="auto">
  <name>Task 2: Add AriaLiveRegion, IconLegend, and aria-hidden to ManageReReview.vue and Review.vue</name>
  <files>
    app/src/views/curate/ManageReReview.vue
    app/src/views/review/Review.vue
  </files>
  <action>
Enhance both views with accessibility features:

**ManageReReview.vue:**

1. **Import components and composable:**
   - Import `AriaLiveRegion` from `@/components/accessibility/AriaLiveRegion.vue`
   - Import `IconLegend` from `@/components/accessibility/IconLegend.vue`
   - Import `useAriaLive` from `@/composables`
   - Register in components object

2. **Setup useAriaLive** in setup(), return announce, a11yMessage, a11yPoliteness

3. **Add AriaLiveRegion** at end of template

4. **Add IconLegend** above the main re-review table. ManageReReview uses batch status icons and assignment icons. The legend items:
```javascript
legendItems: [
  { icon: 'bi bi-check-circle-fill', color: '#198754', label: 'Approved' },
  { icon: 'bi bi-hourglass-split', color: '#ffc107', label: 'Pending review' },
  { icon: 'bi bi-person-fill', color: '#0d6efd', label: 'Assigned user' },
  { icon: 'bi bi-arrow-clockwise', color: '#6c757d', label: 'Recalculate batch' },
  { icon: 'bi bi-archive', color: '#dc3545', label: 'Archive batch' },
]
```
Add as data property. Render above the BTable that lists batches/entities.

5. **Add aria-hidden="true"** to decorative icons inside labeled buttons (toggle collapse, action buttons)

6. **Add announce() calls** alongside makeToast() for batch operations (create, assign, recalculate, archive)

**Review.vue:**

1. **Import components and composable:**
   - Import `AriaLiveRegion` from `@/components/accessibility/AriaLiveRegion.vue`
   - Import `IconLegend` from `@/components/accessibility/IconLegend.vue`
   - Import `useAriaLive` from `@/composables`
   - Register in components object

2. **Setup useAriaLive** in setup(), return announce, a11yMessage, a11yPoliteness

3. **Add AriaLiveRegion** at end of template

4. **Add IconLegend** above the re-review table. Review.vue shows category stoplight icons and curation mode indicators. The legend items:
```javascript
legendItems: [
  { icon: 'bi bi-stoplights-fill', color: '#4caf50', label: 'Definitive' },
  { icon: 'bi bi-stoplights-fill', color: '#2196f3', label: 'Moderate' },
  { icon: 'bi bi-stoplights-fill', color: '#ff9800', label: 'Limited' },
  { icon: 'bi bi-stoplights-fill', color: '#f44336', label: 'Refuted' },
  { icon: 'bi bi-check-circle-fill', color: '#198754', label: 'Re-review approved' },
  { icon: 'bi bi-hourglass-split', color: '#ffc107', label: 'Pending re-review' },
]
```
Add as data property. Render above the BTable.

5. **Add aria-hidden="true"** to decorative icons inside labeled buttons

6. **Add announce() calls** alongside makeToast() for review submission and curation actions

**IMPORTANT:** Both views use Options API. Follow same pattern as Plan 02: add to components object, setup() return, data properties for legendItems, and announce() in methods.

**NOTE on ManageReReview.vue:** Read the FULL file before editing. It may have batch creation forms from Phase 38. Only add accessibility features - do NOT modify existing functionality.
  </action>
  <verify>
Both views have AriaLiveRegion, IconLegend, aria-hidden on decorative icons, and announce() calls.
ManageReReview legend covers batch/assignment icons.
Review legend covers category/re-review status icons.
TypeScript check: `cd /home/bernt-popp/development/sysndd/app && npx vue-tsc --noEmit --pretty 2>&1 | head -30`
  </verify>
  <done>
ManageReReview has live region, icon legend for batch icons, and aria-hidden.
Review has live region, icon legend for category/re-review icons, and aria-hidden.
  </done>
</task>

<task type="auto">
  <name>Task 3: Audit and fix modal titles in ModifyEntity, ManageReReview, and Review</name>
  <files>
    app/src/views/curate/ModifyEntity.vue
    app/src/views/curate/ManageReReview.vue
    app/src/views/review/Review.vue
  </files>
  <action>
Audit every `<BModal>` instance in these 3 views and ensure each has a descriptive `title` prop so screen readers can announce the modal's purpose (RESEARCH.md Pitfall 6). BModal automatically sets `aria-labelledby` from its title prop.

**For each BModal found:**
1. Check if it already has a `title` prop or a `<template #title>` slot.
2. If YES: verify the title is descriptive (not empty, not generic like "Modal"). No change needed if descriptive.
3. If NO: add a `title` prop with a descriptive string that announces the modal's purpose.

**Expected modals by view:**

**ModifyEntity.vue** (has the most modals -- this is a complex view):
- Status modification modal -> title: "Modify Status" (or similar)
- Review modification modal -> title: "Modify Review"
- Phenotype editing modal -> title: "Edit Phenotype"
- Variation editing modal -> title: "Edit Variation"
- Re-review modal -> title: "Request Re-Review"
- Any confirmation/preview modals

**ManageReReview.vue:**
- Batch creation modal -> title: "Create Re-Review Batch"
- Assignment modal -> title: "Assign Reviewer"
- Recalculation confirmation modal -> title: "Recalculate Batch"
- Any other action modals

**Review.vue:**
- Review.vue primarily uses a form (not modals) for review submission. However, check if any confirmation modals exist. If Review.vue has no BModal instances, note that in the summary and skip this view.

**Rules:**
- Use short, action-oriented titles: "Modify Status", "Create Batch", "Assign Reviewer"
- If a modal already has a visible title via `<template #title>`, that is sufficient -- BModal connects it via `aria-labelledby` automatically
- If a modal intentionally has NO visible title but needs one for screen readers, use the `title` prop (BModal renders it as an `<h5>` in the header) OR use `aria-label` directly on the BModal if no visible title is desired
- Do NOT add `titleVisuallyHidden` unless the design specifically needs to hide the title visually -- prefer visible titles
- Check for `header-close-label="Close"` or `header-close-label="Close modal"` on each BModal -- add it if missing, so the close button is announced properly

**IMPORTANT:** Read the FULL source of each view before editing to find ALL BModal instances. ModifyEntity.vue is a large file with potentially many modals -- do not miss any.
  </action>
  <verify>
For each view, grep for BModal and verify every instance has a title:
```bash
cd /home/bernt-popp/development/sysndd/app && grep -n 'BModal\|b-modal' src/views/curate/ModifyEntity.vue src/views/curate/ManageReReview.vue src/views/review/Review.vue | head -40
```
Every BModal instance should have either a `title` prop, a `<template #title>` slot, or an `aria-label` attribute.
Each BModal should have `header-close-label` for accessible close button.
  </verify>
  <done>
All BModal instances in ModifyEntity, ManageReReview, and Review (if applicable) have descriptive titles that screen readers can announce.
All modal close buttons have accessible labels.
Success Criteria #3 (modal titles) is satisfied for these 3 views.
  </done>
</task>

</tasks>

<verification>
- All 3 views have AriaLiveRegion component in template
- ModifyEntity legend appears when entity is loaded
- ManageReReview legend appears above batch table
- Review legend appears above re-review table
- All decorative icons in labeled buttons have aria-hidden="true"
- announce() calls present alongside makeToast() for all actions
- All BModal instances across the 3 views have descriptive title props or equivalent aria-label
- All BModal close buttons have header-close-label
</verification>

<success_criteria>
- Screen readers announce action outcomes in all 3 views
- Icon legends visible and explain all symbolic icons
- No double-announcement of decorative icon + button label
- All modals announce their purpose when opened (title or aria-label present)
- No functional regressions in any view
</success_criteria>

<output>
After completion, create `.planning/phases/39-accessibility-pass/39-03-SUMMARY.md`
</output>
