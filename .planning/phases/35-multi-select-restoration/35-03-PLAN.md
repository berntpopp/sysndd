---
phase: 35-multi-select-restoration
plan: 03
type: execute
wave: 3
depends_on: ["35-02"]
files_modified:
  - app/package.json
  - app/src/views/review/Review.vue
  - app/src/views/curate/ModifyEntity.vue
  - app/src/views/curate/ApproveReview.vue
autonomous: false

must_haves:
  truths:
    - "vue3-treeselect is removed from package.json dependencies"
    - "No commented-out treeselect code remains in any curation view"
    - "User can select multiple phenotypes and see chips display correctly"
    - "User can select multiple variations and see chips display correctly"
    - "Selections persist when form is saved"
  artifacts:
    - path: "app/package.json"
      provides: "Package manifest without vue3-treeselect"
  key_links:
    - from: "app/src/views/review/Review.vue"
      to: "app/src/components/forms/TreeMultiSelect.vue"
      via: "import"
      pattern: "import TreeMultiSelect"
---

<objective>
Remove legacy vue3-treeselect and verify multi-select functionality

Purpose: Complete the migration by removing the deprecated vue3-treeselect dependency and cleaning up all commented-out legacy code. Includes human verification to ensure the multi-select functionality works correctly in all three curation views.

Output:
- vue3-treeselect removed from package.json
- All commented-out treeselect code removed
- Verified working multi-select in Review, ModifyEntity, ApproveReview
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/35-multi-select-restoration/35-CONTEXT.md
@.planning/phases/35-multi-select-restoration/35-01-SUMMARY.md
@.planning/phases/35-multi-select-restoration/35-02-SUMMARY.md

# Files to clean
@app/package.json
@app/src/views/review/Review.vue
@app/src/views/curate/ModifyEntity.vue
@app/src/views/curate/ApproveReview.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove vue3-treeselect dependency</name>
  <files>
    app/package.json
  </files>
  <action>
Remove @zanmato/vue3-treeselect from dependencies:

```bash
cd /home/bernt-popp/development/sysndd/app && npm uninstall @zanmato/vue3-treeselect
```

Verify package.json no longer contains the dependency.

Then run npm install to update package-lock.json:
```bash
cd /home/bernt-popp/development/sysndd/app && npm install
```
  </action>
  <verify>
`grep -q "vue3-treeselect" app/package.json` returns exit code 1 (not found)
`cd /home/bernt-popp/development/sysndd/app && npm ls @zanmato/vue3-treeselect 2>&1 | grep -q "empty"` or similar indicating not installed
  </verify>
  <done>
@zanmato/vue3-treeselect removed from package.json dependencies
package-lock.json updated
npm install completed successfully
  </done>
</task>

<task type="auto">
  <name>Task 2: Clean up commented-out treeselect code</name>
  <files>
    app/src/views/review/Review.vue
    app/src/views/curate/ModifyEntity.vue
    app/src/views/curate/ApproveReview.vue
  </files>
  <action>
Remove all commented-out vue3-treeselect code from the three views.

In Review.vue, remove:
1. Commented-out treeselect import at top of script (lines ~1150-1154):
```javascript
// TODO: vue3-treeselect disabled pending Bootstrap-Vue-Next migration
// import the Treeselect component
// import Treeselect from '@zanmato/vue3-treeselect';
// import the Treeselect styles
// import '@zanmato/vue3-treeselect/dist/vue3-treeselect.min.css';
```

2. Commented-out treeselect components registration (line ~1171):
```javascript
// TODO: Treeselect disabled pending Bootstrap-Vue-Next migration
components: {},
```
Update to just remove the TODO comment, keep empty components if needed or remove entirely.

3. All commented-out `<treeselect>` component blocks in template section

4. Normalizer methods that are no longer used:
- `normalizePhenotypes` (only if not used elsewhere)
- `normalizeVariationOntology` (only if not used elsewhere)

5. Scoped CSS for vue-treeselect (at bottom, lines ~1962-1965):
```css
:deep(.vue-treeselect__menu) {
  outline: 1px solid red;
  color: blue;
}
```

Apply same cleanup to ModifyEntity.vue and ApproveReview.vue.

KEEP:
- `normalizeStatus` method (used for status dropdown which is still BFormSelect)
- `normalizeStatusOptions` method (used for status dropdown)
  </action>
  <verify>
`grep -r "vue3-treeselect" app/src/views/` returns no results
`grep -r "Treeselect from" app/src/views/` returns no results
`grep -r "vue-treeselect__menu" app/src/views/` returns no results
Run `cd /home/bernt-popp/development/sysndd/app && npm run lint -- --fix`
Run `cd /home/bernt-popp/development/sysndd/app && npm run type-check`
  </verify>
  <done>
All commented-out vue3-treeselect imports removed
All commented-out treeselect component code removed
Unused normalizer methods removed
Legacy CSS removed
Lint and type-check pass
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Multi-select TreeMultiSelect component integrated into all three curation views:
- Review.vue (Re-review page)
- ModifyEntity.vue (Modify Entity page)
- ApproveReview.vue (Approve Review page)

Features implemented (using Bootstrap-Vue-Next ONLY - no PrimeVue):
- Hierarchical tree display with expand/collapse (BCollapse)
- Checkbox multi-selection (BFormCheckbox on leaf nodes)
- Search filtering (matches names and HP:IDs)
- Selected items display as chips below selector (BFormTag)
- X button on chips for quick removal
- Tooltip on hover shows full hierarchy path
  </what-built>
  <how-to-verify>
**Prerequisites:**
1. Start the development server: `cd /home/bernt-popp/development/sysndd/app && npm run dev`
2. Log in as a user with review permissions

**Test 1: Review.vue (Re-review page)**
1. Navigate to the Re-review page
2. Click the edit review button (pen icon) for any entity
3. Verify phenotype selector:
   - Click dropdown to open - should show hierarchical tree
   - Click parent node chevron to expand/collapse children
   - Parent nodes show only chevron + name (no checkbox)
   - Leaf nodes show checkbox + name + HP:ID
   - Check multiple leaf items - checkboxes should work
   - Verify chips appear below dropdown showing selected items
   - Hover over a chip - tooltip should show full path (e.g., "Phenotypic abnormality > Abnormality of the nervous system > Seizure")
   - Click X on a chip - item should be deselected
   - Type in search box - tree should filter, showing matches in context
   - Click "Done" button to close dropdown
4. Repeat for variation selector
5. Click "Save review" and verify no errors

**Test 2: ModifyEntity.vue**
1. Navigate to Modify Entity page
2. Enter an entity ID and click "Modify review" button
3. Test phenotype and variation multi-select same as above
4. Save and verify no errors

**Test 3: ApproveReview.vue**
1. Navigate to Approve Review page
2. Click edit review button (pen icon) for any pending review
3. Test phenotype and variation multi-select same as above
4. Save and verify no errors

**Expected behavior:**
- Tree displays hierarchically with parent/child relationships
- Parent nodes are navigation only (expand/collapse, no checkbox)
- Leaf nodes can be selected via checkboxes
- Multiple items can be selected
- Selected items show as chips with X removal button
- Search filters tree while showing matching items in context
- Selections persist when saving
  </how-to-verify>
  <resume-signal>
Type "approved" if all three views work correctly with multi-select.
If issues found, describe what's broken and I'll fix it.
  </resume-signal>
</task>

</tasks>

<verification>
1. `grep -r "vue3-treeselect" app/` returns no results
2. `grep -r "primevue" app/src/components/forms/` returns no results (no PrimeVue used)
3. `grep -r "TreeMultiSelect" app/src/views/` shows usage in all 3 views
4. `cd /home/bernt-popp/development/sysndd/app && npm run build` succeeds
5. Human verified multi-select works in Review, ModifyEntity, ApproveReview
</verification>

<success_criteria>
- vue3-treeselect removed from package.json
- No commented-out treeselect code in any view
- No PrimeVue used anywhere in the codebase for this feature
- Multi-select phenotypes works in all three views
- Multi-select variations works in all three views
- Chips display correctly with tooltips
- Search filtering works
- Selections persist when saving
- Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/35-multi-select-restoration/35-03-SUMMARY.md`
</output>
