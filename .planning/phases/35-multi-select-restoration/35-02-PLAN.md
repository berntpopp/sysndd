---
phase: 35-multi-select-restoration
plan: 02
type: execute
wave: 2
depends_on: ["35-01"]
files_modified:
  - app/src/views/review/Review.vue
  - app/src/views/curate/ModifyEntity.vue
  - app/src/views/curate/ApproveReview.vue
autonomous: true

must_haves:
  truths:
    - "User can select multiple phenotypes in Review.vue review modal"
    - "User can select multiple variations in Review.vue review modal"
    - "User can select multiple phenotypes/variations in ModifyEntity.vue review modal"
    - "User can select multiple phenotypes/variations in ApproveReview.vue review modal"
    - "Selected items persist correctly when saving reviews"
  artifacts:
    - path: "app/src/views/review/Review.vue"
      provides: "Review page with TreeMultiSelect for phenotypes and variations"
      contains: "TreeMultiSelect"
    - path: "app/src/views/curate/ModifyEntity.vue"
      provides: "ModifyEntity page with TreeMultiSelect for phenotypes and variations"
      contains: "TreeMultiSelect"
    - path: "app/src/views/curate/ApproveReview.vue"
      provides: "ApproveReview page with TreeMultiSelect for phenotypes and variations"
      contains: "TreeMultiSelect"
  key_links:
    - from: "app/src/views/review/Review.vue"
      to: "app/src/components/forms/TreeMultiSelect.vue"
      via: "import statement"
      pattern: "import TreeMultiSelect"
    - from: "app/src/views/curate/ModifyEntity.vue"
      to: "app/src/components/forms/TreeMultiSelect.vue"
      via: "import statement"
      pattern: "import TreeMultiSelect"
    - from: "app/src/views/curate/ApproveReview.vue"
      to: "app/src/components/forms/TreeMultiSelect.vue"
      via: "import statement"
      pattern: "import TreeMultiSelect"
---

<objective>
Integrate TreeMultiSelect into all curation views

Purpose: Replace single-select BFormSelect workaround with proper multi-select TreeMultiSelect component in Review.vue, ModifyEntity.vue, and ApproveReview.vue. This restores the original multi-select functionality that was disabled when vue3-treeselect broke.

Output:
- Review.vue uses TreeMultiSelect for phenotypes and variations
- ModifyEntity.vue uses TreeMultiSelect for phenotypes and variations
- ApproveReview.vue uses TreeMultiSelect for phenotypes and variations
- All three views maintain existing v-model bindings (select_phenotype, select_variation arrays)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/35-multi-select-restoration/35-CONTEXT.md
@.planning/phases/35-multi-select-restoration/35-RESEARCH.md
@.planning/phases/35-multi-select-restoration/35-01-SUMMARY.md (from prior plan)

# Views to update
@app/src/views/review/Review.vue
@app/src/views/curate/ModifyEntity.vue
@app/src/views/curate/ApproveReview.vue

# TreeMultiSelect component (created in 35-01)
@app/src/components/forms/TreeMultiSelect.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Review.vue with TreeMultiSelect</name>
  <files>
    app/src/views/review/Review.vue
  </files>
  <action>
Update Review.vue to use TreeMultiSelect for phenotypes and variations:

1. Add import at top of script section:
```javascript
import TreeMultiSelect from '@/components/forms/TreeMultiSelect.vue';
```

2. Register component in components object:
```javascript
components: {
  TreeMultiSelect,
  // ... other existing components
},
```

3. Replace the phenotype BFormSelect (around lines 553-565) with TreeMultiSelect:
```vue
<!-- Replace this BFormSelect: -->
<!-- <BFormSelect
  v-if="phenotypes_options && phenotypes_options.length > 0"
  id="review-phenotype-select"
  v-model="select_phenotype[0]"
  :options="normalizePhenotypesOptions(phenotypes_options)"
  size="sm"
>
  <template #first>
    <BFormSelectOption :value="null">
      Select phenotype...
    </BFormSelectOption>
  </template>
</BFormSelect> -->

<!-- With this TreeMultiSelect: -->
<TreeMultiSelect
  v-if="phenotypes_options && phenotypes_options.length > 0"
  id="review-phenotype-select"
  v-model="select_phenotype"
  :options="phenotypes_options"
  placeholder="Select phenotypes..."
  search-placeholder="Search phenotypes (name or HP:ID)..."
/>
```

4. Replace the variation BFormSelect (around lines 612-624) with TreeMultiSelect:
```vue
<!-- Replace this BFormSelect: -->
<!-- <BFormSelect
  v-if="variation_ontology_options && variation_ontology_options.length > 0"
  id="review-variation-select"
  v-model="select_variation[0]"
  :options="normalizeVariationOntologyOptions(variation_ontology_options)"
  size="sm"
>
  <template #first>
    <BFormSelectOption :value="null">
      Select variation...
    </BFormSelectOption>
  </template>
</BFormSelect> -->

<!-- With this TreeMultiSelect: -->
<TreeMultiSelect
  v-if="variation_ontology_options && variation_ontology_options.length > 0"
  id="review-variation-select"
  v-model="select_variation"
  :options="variation_ontology_options"
  placeholder="Select variations..."
  search-placeholder="Search variation types..."
/>
```

5. Remove the TODO comments about vue3-treeselect (lines 542-552 and 601-611 approximately)

6. Remove unused methods that were only needed for BFormSelect flattening:
- Remove `normalizePhenotypesOptions` method
- Remove `normalizeVariationOntologyOptions` method
- Remove `flattenTreeOptions` method
(Keep `normalizeStatusOptions` as status is still single-select)

IMPORTANT: The select_phenotype and select_variation arrays use compound key format `${modifier_id}-${phenotype_id}`. The TreeMultiSelect component works with these IDs directly since the API returns tree data with `id` field already in this format.
  </action>
  <verify>
File contains: `import TreeMultiSelect from '@/components/forms/TreeMultiSelect.vue'`
File contains: `<TreeMultiSelect` (at least twice - phenotypes and variations)
File does NOT contain: `flattenTreeOptions` method
Run `cd /home/bernt-popp/development/sysndd/app && npm run lint -- --fix`
Run `cd /home/bernt-popp/development/sysndd/app && npm run type-check`
  </verify>
  <done>
Review.vue imports and uses TreeMultiSelect component
Phenotype select replaced with TreeMultiSelect
Variation select replaced with TreeMultiSelect
Unused flatten methods removed
TODO comments about vue3-treeselect removed
Lint and type-check pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Update ModifyEntity.vue with TreeMultiSelect</name>
  <files>
    app/src/views/curate/ModifyEntity.vue
  </files>
  <action>
Update ModifyEntity.vue to use TreeMultiSelect for phenotypes and variations:

1. Add import at top of script section:
```javascript
import TreeMultiSelect from '@/components/forms/TreeMultiSelect.vue';
```

2. Register component in components object:
```javascript
components: {
  TreeMultiSelect,
  // ... other existing components
},
```

3. Replace the phenotype BFormSelect (in the modifyReviewModal) with TreeMultiSelect:
```vue
<!-- Replace the BFormSelect with: -->
<TreeMultiSelect
  v-if="phenotypes_options && phenotypes_options.length > 0"
  id="review-phenotype-select"
  v-model="select_phenotype"
  :options="phenotypes_options"
  placeholder="Select phenotypes..."
  search-placeholder="Search phenotypes (name or HP:ID)..."
/>
```

4. Replace the variation BFormSelect with TreeMultiSelect:
```vue
<!-- Replace the BFormSelect with: -->
<TreeMultiSelect
  v-if="variation_ontology_options && variation_ontology_options.length > 0"
  id="review-variation-select"
  v-model="select_variation"
  :options="variation_ontology_options"
  placeholder="Select variations..."
  search-placeholder="Search variation types..."
/>
```

5. Remove TODO comments about vue3-treeselect

6. Remove unused methods:
- Remove `normalizePhenotypesOptions` method
- Remove `normalizeVariationOntologyOptions` method
- Remove `flattenTreeOptions` method
(Keep `normalizeStatusOptions` as status dropdown is still single-select)
  </action>
  <verify>
File contains: `import TreeMultiSelect from '@/components/forms/TreeMultiSelect.vue'`
File contains: `<TreeMultiSelect` (at least twice)
File does NOT contain: `flattenTreeOptions` method
Run `cd /home/bernt-popp/development/sysndd/app && npm run lint -- --fix`
Run `cd /home/bernt-popp/development/sysndd/app && npm run type-check`
  </verify>
  <done>
ModifyEntity.vue imports and uses TreeMultiSelect component
Phenotype select replaced with TreeMultiSelect
Variation select replaced with TreeMultiSelect
Unused flatten methods removed
Lint and type-check pass
  </done>
</task>

<task type="auto">
  <name>Task 3: Update ApproveReview.vue with TreeMultiSelect</name>
  <files>
    app/src/views/curate/ApproveReview.vue
  </files>
  <action>
Update ApproveReview.vue to use TreeMultiSelect for phenotypes and variations:

1. Add import at top of script section:
```javascript
import TreeMultiSelect from '@/components/forms/TreeMultiSelect.vue';
```

2. Register component in components object:
```javascript
components: {
  TreeMultiSelect,
  // ... other existing components
},
```

3. Replace the phenotype BFormSelect (in the reviewModal) with TreeMultiSelect:
```vue
<!-- Replace the BFormSelect with: -->
<TreeMultiSelect
  v-if="phenotypes_options && phenotypes_options.length > 0"
  id="review-phenotype-select"
  v-model="select_phenotype"
  :options="phenotypes_options"
  placeholder="Select phenotypes..."
  search-placeholder="Search phenotypes (name or HP:ID)..."
/>
```

4. Replace the variation BFormSelect with TreeMultiSelect:
```vue
<!-- Replace the BFormSelect with: -->
<TreeMultiSelect
  v-if="variation_ontology_options && variation_ontology_options.length > 0"
  id="review-variation-select"
  v-model="select_variation"
  :options="variation_ontology_options"
  placeholder="Select variations..."
  search-placeholder="Search variation types..."
/>
```

5. Remove TODO comments about vue3-treeselect

6. Remove unused methods:
- Remove `normalizePhenotypesOptions` method
- Remove `normalizeVariationOntologyOptions` method
- Remove `flattenTreeOptions` method
(Keep `normalizeStatusOptions` as status dropdown is still single-select)
  </action>
  <verify>
File contains: `import TreeMultiSelect from '@/components/forms/TreeMultiSelect.vue'`
File contains: `<TreeMultiSelect` (at least twice)
File does NOT contain: `flattenTreeOptions` method
Run `cd /home/bernt-popp/development/sysndd/app && npm run lint -- --fix`
Run `cd /home/bernt-popp/development/sysndd/app && npm run type-check`
  </verify>
  <done>
ApproveReview.vue imports and uses TreeMultiSelect component
Phenotype select replaced with TreeMultiSelect
Variation select replaced with TreeMultiSelect
Unused flatten methods removed
Lint and type-check pass
  </done>
</task>

</tasks>

<verification>
1. All three views import TreeMultiSelect
2. `grep -r "TreeMultiSelect" app/src/views/` shows usage in Review.vue, ModifyEntity.vue, ApproveReview.vue
3. `grep -r "flattenTreeOptions" app/src/views/` returns no results (method removed)
4. `cd /home/bernt-popp/development/sysndd/app && npm run type-check` passes
5. `cd /home/bernt-popp/development/sysndd/app && npm run lint` passes
6. `cd /home/bernt-popp/development/sysndd/app && npm run build` succeeds
</verification>

<success_criteria>
- Review.vue uses TreeMultiSelect for phenotypes and variations
- ModifyEntity.vue uses TreeMultiSelect for phenotypes and variations
- ApproveReview.vue uses TreeMultiSelect for phenotypes and variations
- All flattenTreeOptions methods removed (no longer needed)
- All TODO comments about vue3-treeselect removed
- TypeScript type-check passes
- Lint passes
- Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/35-multi-select-restoration/35-02-SUMMARY.md`
</output>
