---
phase: 75-frontend-fixes-ux-improvements
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/src/composables/useColumnTooltip.ts
  - app/src/components/small/GenericTable.vue
  - app/src/components/tables/TablesEntities.vue
autonomous: true

must_haves:
  truths:
    - "Hovering over table column headers in the Entities table displays statistics tooltips showing unique filtered/total values"
    - "The tooltip composable is reusable and follows the same format as TablesGenes existing tooltips"
    - "GenericTable supports column header tooltips via a head slot that consumers can override"
  artifacts:
    - path: "app/src/composables/useColumnTooltip.ts"
      provides: "Reusable tooltip text generation for table column headers"
      exports: ["useColumnTooltip"]
    - path: "app/src/components/small/GenericTable.vue"
      provides: "Generic table with head() slot override for tooltip support"
    - path: "app/src/components/tables/TablesEntities.vue"
      provides: "Entities table with column header tooltips"
  key_links:
    - from: "app/src/components/tables/TablesEntities.vue"
      to: "app/src/composables/useColumnTooltip.ts"
      via: "composable import and usage in template"
      pattern: "useColumnTooltip"
    - from: "app/src/components/small/GenericTable.vue"
      to: "bootstrap-vue-next BTable"
      via: "head() template slot passthrough"
      pattern: "#head\\(\\)"
---

<objective>
Restore column header statistics tooltips across data tables by creating a reusable composable and adding tooltip support to GenericTable and TablesEntities.

Purpose: FE-02 restores the hover tooltip behavior that shows "Column (unique filtered/total values: X/Y)" on column headers. TablesGenes and TablesPhenotypes already have this inline. The goal is to extract into a composable and add to TablesEntities (which uses GenericTable).
Output: New useColumnTooltip composable, updated GenericTable with head slot, updated TablesEntities with tooltips.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/75-frontend-fixes-ux-improvements/75-CONTEXT.md
@.planning/phases/75-frontend-fixes-ux-improvements/75-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useColumnTooltip composable</name>
  <files>app/src/composables/useColumnTooltip.ts</files>
  <action>
Create a new composable `app/src/composables/useColumnTooltip.ts` that extracts the tooltip formatting logic currently inline in TablesGenes.vue (lines 76-101).

The composable should:

1. Export a `useColumnTooltip` function that returns a `getTooltipText` helper.
2. Accept a field object with optional `count` and `count_filtered` properties (these come from the API fspec metadata).
3. Return tooltip text in the exact same format as TablesGenes: `"Column (unique filtered/total values: X/Y)"`

```typescript
/**
 * Composable for generating column header tooltip text.
 * Extracts the tooltip pattern used in TablesGenes into a reusable utility.
 *
 * The backend API returns field specs (fspec) with count and count_filtered
 * properties for each column. This composable formats those into a human-readable
 * tooltip string.
 */

export interface FieldWithCounts {
  key: string;
  label?: string;
  count?: number;
  count_filtered?: number;
  [key: string]: unknown;
}

export function useColumnTooltip() {
  /**
   * Generate tooltip text for a table column header.
   * Format: "Label (unique filtered/total values: X/Y)"
   *
   * @param field - Field definition with optional count data
   * @returns Formatted tooltip string
   */
  const getTooltipText = (field: FieldWithCounts): string => {
    const label = field.label || field.key;
    const filtered = field.count_filtered ?? 0;
    const total = field.count ?? 0;
    return `${label} (unique filtered/total values: ${filtered}/${total})`;
  };

  return { getTooltipText };
}
```

Also export from the composables index. Add `export { useColumnTooltip } from './useColumnTooltip';` to `app/src/composables/index.ts`.
  </action>
  <verify>
Run `cd /home/bernt-popp/development/sysndd/app && npx eslint src/composables/useColumnTooltip.ts` to check for lint errors.
Verify the file exports useColumnTooltip and FieldWithCounts.
  </verify>
  <done>
useColumnTooltip composable exists at app/src/composables/useColumnTooltip.ts, exports useColumnTooltip function and FieldWithCounts interface, and is re-exported from composables/index.ts.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add tooltip support to GenericTable and TablesEntities</name>
  <files>
    app/src/components/small/GenericTable.vue
    app/src/components/tables/TablesEntities.vue
  </files>
  <action>
**GenericTable.vue changes:**

Add a `#head()` template slot to GenericTable's BTable that allows consumers to override column headers. This is the same pattern TablesGenes uses directly on its BTable.

In GenericTable.vue, add the following template slot inside the `<BTable>` component, BEFORE the existing `#thead-top` slot:

```vue
<!-- Column header with optional tooltip support -->
<template #head()="data">
  <slot name="column-header" :data="data" :fields="fields">
    {{ data.label }}
  </slot>
</template>
```

This provides a named slot `column-header` that passes `data` (the BTable head slot data containing `label`, `column`, `field`) and the full `fields` array. The default fallback just renders the label text (preserving current behavior for consumers that don't use tooltips).

**TablesEntities.vue changes:**

1. Import `useColumnTooltip` in the setup function:
```javascript
import { useColumnTooltip } from '@/composables/useColumnTooltip';
```

2. In the `setup(props)` function, add:
```javascript
const { getTooltipText } = useColumnTooltip();
```

3. Add `getTooltipText` to the setup return object.

4. Also import `useText` and get the `truncate` function (it's already imported and returned in setup - verify this).

5. In the template, add the column-header slot to the `<GenericTable>` usage:

```vue
<!-- Column header tooltips -->
<template #column-header="{ data }">
  <div
    v-b-tooltip.hover.top
    :title="
      getTooltipText(
        fields.find((f) => f.label === data.label) || { key: data.column, label: data.label }
      )
    "
  >
    {{ truncate(data.label.replace(/( word)|( name)/g, ''), 20) }}
  </div>
</template>
```

This replicates the exact same tooltip behavior as TablesGenes.vue lines 77-101, but using the composable instead of inline logic. The `truncate` function and the regex label cleanup match the TablesGenes pattern exactly.

NOTE: The `fields` data in TablesEntities is updated from API response in `applyApiResponse()` which sets `this.fields = data.meta[0].fspec`. The fspec from the API already contains `count` and `count_filtered` properties on each field object, so the tooltip composable will have the data it needs.
  </action>
  <verify>
Run `cd /home/bernt-popp/development/sysndd/app && npx eslint src/components/small/GenericTable.vue src/components/tables/TablesEntities.vue` to check for lint errors.

Verify GenericTable has a `#head()` slot with a named `column-header` slot.
Verify TablesEntities uses the `column-header` slot with v-b-tooltip.
  </verify>
  <done>
GenericTable has a column-header slot in its head() template. TablesEntities uses the column-header slot to display tooltips with "Label (unique filtered/total values: X/Y)" format, matching TablesGenes behavior. ESLint passes for all modified files.
  </done>
</task>

</tasks>

<verification>
1. `app/src/composables/useColumnTooltip.ts` exists and exports `useColumnTooltip`
2. GenericTable.vue has a `#head()` template slot that passes data to a `column-header` named slot
3. TablesEntities.vue uses the `column-header` slot with `v-b-tooltip` and `getTooltipText`
4. TablesGenes.vue and TablesPhenotypes.vue already have inline tooltip code (no changes needed - they use BTable directly, not GenericTable)
5. ESLint passes for all modified files
</verification>

<success_criteria>
- New useColumnTooltip composable exported from composables/index.ts
- GenericTable provides a column-header slot for tooltip override
- TablesEntities displays tooltips on column header hover matching "Label (unique filtered/total values: X/Y)" format
- No regressions in existing table behavior
</success_criteria>

<output>
After completion, create `.planning/phases/75-frontend-fixes-ux-improvements/75-02-SUMMARY.md`
</output>
