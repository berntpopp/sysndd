---
phase: 62-admin-infrastructure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .github/workflows/gh-pages.yml
  - documentation/_quarto.yml
  - documentation/index.qmd
  - documentation/01-intro.qmd
  - documentation/02-web-tool.qmd
  - documentation/03-api.qmd
  - documentation/04-database-structure.qmd
  - documentation/05-curation-criteria.qmd
  - documentation/06-re-review-instructions.qmd
  - documentation/07-tutorial-videos.qmd
  - documentation/references.qmd
  - documentation/styles.css
autonomous: true

must_haves:
  truths:
    - "Documentation renders with Quarto"
    - "GitHub Pages deploys via actions/deploy-pages environment"
    - "Workflow triggers on push to master only"
    - "Theme aligns with SysNDD styling (logo, colors)"
    - "All original content preserved"
  artifacts:
    - path: "documentation/_quarto.yml"
      provides: "Quarto project configuration"
      contains: "type: website"
    - path: "documentation/index.qmd"
      provides: "Home page in Quarto format"
      min_lines: 30
    - path: ".github/workflows/gh-pages.yml"
      provides: "Modern Pages deployment workflow"
      contains: "actions/deploy-pages"
  key_links:
    - from: ".github/workflows/gh-pages.yml"
      to: "documentation/_quarto.yml"
      via: "quarto render documentation"
      pattern: "quarto-dev/quarto-actions"
    - from: ".github/workflows/gh-pages.yml"
      to: "github-pages environment"
      via: "actions/deploy-pages"
      pattern: "deploy-pages@v4"
---

<objective>
Migrate documentation from bookdown to Quarto with GitHub Pages environment deployment

Purpose: Modernize documentation system from legacy bookdown to Quarto (official successor), and switch from gh-pages branch deployment to the modern GitHub Pages environment approach using actions/deploy-pages.

Output: Quarto-based documentation site, modernized GitHub Actions workflow, SysNDD-styled theme
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/62-admin-infrastructure/62-CONTEXT.md
@.planning/phases/62-admin-infrastructure/62-RESEARCH.md

@documentation/_bookdown.yml (current bookdown config)
@documentation/_output.yml (current output config)
@documentation/index.Rmd (current home page)
@documentation/style.css (current styles)
@.github/workflows/gh-pages.yml (current workflow)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Quarto project configuration</name>
  <files>
    documentation/_quarto.yml
    documentation/styles.css
  </files>
  <action>
Create `_quarto.yml` consolidating settings from `_bookdown.yml` and `_output.yml`:

```yaml
project:
  type: website
  output-dir: _site

website:
  title: "SysNDD Documentation"
  description: "Documentation for SysNDD - Systematic Neurodevelopmental Disorder Gene Database"
  repo-url: https://github.com/berntpopp/sysndd
  repo-branch: master
  repo-subdir: documentation
  favicon: static/img/android-chrome-192x192.png

  navbar:
    background: primary
    logo: static/img/android-chrome-192x192.png
    left:
      - href: index.qmd
        text: Home
      - href: 02-web-tool.qmd
        text: Web Tool
      - href: 03-api.qmd
        text: API
      - href: 04-database-structure.qmd
        text: Database
    right:
      - icon: github
        href: https://github.com/berntpopp/sysndd

  sidebar:
    style: docked
    search: true
    contents:
      - section: "Overview"
        contents:
          - index.qmd
          - 01-intro.qmd
      - section: "Using SysNDD"
        contents:
          - 02-web-tool.qmd
          - 03-api.qmd
          - 04-database-structure.qmd
      - section: "Curation"
        contents:
          - 05-curation-criteria.qmd
          - 06-re-review-instructions.qmd
          - 07-tutorial-videos.qmd
      - section: "References"
        contents:
          - references.qmd

  page-footer:
    center: |
      SysNDD - Systematic Neurodevelopmental Disorder Gene Database
      <br>
      <a href="https://sysndd.dbmr.unibe.ch/">sysndd.dbmr.unibe.ch</a>

format:
  html:
    theme:
      light: cosmo
    css: styles.css
    toc: true
    toc-depth: 3
    code-copy: true
    code-overflow: wrap

bibliography: sysndd.bib
csl: apa.csl
```

Create/update `styles.css` with SysNDD branding:
```css
/* SysNDD Documentation Styles */

/* Match SysNDD primary color scheme */
:root {
  --bs-primary: #0d6efd;
  --sysndd-header-bg: #343a40;
}

/* Logo sizing in navbar */
.navbar-brand img {
  height: 40px;
  width: auto;
}

/* Sidebar styling */
.sidebar {
  border-right: 1px solid #dee2e6;
}

/* Footer styling */
.page-footer {
  background-color: var(--sysndd-header-bg);
  color: white;
  padding: 1rem;
}

.page-footer a {
  color: #adb5bd;
}

/* Code block styling */
pre {
  background-color: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 0.25rem;
}

/* Table styling */
table {
  width: 100%;
  margin-bottom: 1rem;
  border-collapse: collapse;
}

table th, table td {
  padding: 0.75rem;
  border: 1px solid #dee2e6;
}

table th {
  background-color: #f8f9fa;
}
```

Remove old config files after Quarto setup verified:
- `_bookdown.yml`
- `_output.yml`
- `preamble.tex` (not needed for HTML-only)
  </action>
  <verify>
Run `cd documentation && quarto check` - Quarto installation verified
Run `cd documentation && quarto render` - renders without errors
Check `documentation/_site/index.html` exists
  </verify>
  <done>
_quarto.yml created with website config, navbar, sidebar, footer. styles.css has SysNDD branding. Old bookdown configs removed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert Rmd files to Quarto qmd format</name>
  <files>
    documentation/index.qmd
    documentation/01-intro.qmd
    documentation/02-web-tool.qmd
    documentation/03-api.qmd
    documentation/04-database-structure.qmd
    documentation/05-curation-criteria.qmd
    documentation/06-re-review-instructions.qmd
    documentation/07-tutorial-videos.qmd
    documentation/references.qmd
  </files>
  <action>
Convert each .Rmd file to .qmd format:

**Key conversion steps for each file:**

1. **YAML frontmatter:**
   - Remove bookdown-specific fields (site, output, bibliography at file level)
   - Keep/add: title, author (if applicable)
   - Move bibliography/csl to _quarto.yml (already done)

2. **Chapter numbering:**
   - Remove `# Chapter Title {-}` unnumbered syntax - use `{.unnumbered}` instead
   - Or just use regular headings (Quarto handles numbering via _quarto.yml)

3. **Cross-references:**
   - `\@ref(fig:name)` becomes `@fig-name`
   - `\@ref(tab:name)` becomes `@tbl-name`
   - `\@ref(sec:name)` becomes `@sec-name`

4. **Figures:**
   ```
   # Old bookdown
   knitr::include_graphics("path.png")

   # New Quarto
   ![Caption](path.png){#fig-name}
   ```

5. **Code chunks:**
   - `{r name, options}` stays mostly the same
   - `echo=FALSE` becomes `#| echo: false`
   - Can keep old syntax, Quarto supports both

6. **Citations:**
   - `[@citation]` syntax works in both - no change needed

**Specific files:**

**index.qmd (from index.Rmd):**
- Keep Preface content
- Remove bookdown YAML header (site, output, etc.)
- Simple frontmatter: `title: "SysNDD Documentation"`

**01-intro.qmd:**
- Content about SysNDD history and concept
- Convert any cross-refs

**02-web-tool.qmd:**
- Many screenshots - verify image paths work
- Update figure references if any

**03-api.qmd:**
- API documentation with screenshots
- Keep all content, update refs

**04-database-structure.qmd:**
- Database schema diagram
- Keep as-is, update refs

**05-curation-criteria.qmd:**
- Curation guidelines tables
- Keep tables as markdown

**06-re-review-instructions.qmd:**
- Re-review workflow
- Keep content, update refs

**07-tutorial-videos.qmd:**
- Video embeds
- Keep as-is

**references.qmd:**
- Create simple page for bibliography
- Just needs: `# References {.unnumbered}`

After conversion, remove .Rmd files to avoid confusion.
  </action>
  <verify>
Run `cd documentation && quarto render`
Open `documentation/_site/index.html` in browser
Navigate through all pages - content displays correctly
Images load, links work, sidebar navigation functional
  </verify>
  <done>
All .Rmd files converted to .qmd format. Content preserved, cross-references updated. Old .Rmd files removed. Full documentation renders correctly.
  </done>
</task>

<task type="auto">
  <name>Task 3: Modernize GitHub Actions workflow</name>
  <files>
    .github/workflows/gh-pages.yml
  </files>
  <action>
Replace current workflow with modern Quarto + Pages environment approach:

```yaml
# GitHub Pages Documentation Build
# Renders Quarto documentation and deploys to GitHub Pages environment
#
# Triggers:
# - Push to master (documentation changes only)
#
# References:
# - https://quarto.org/docs/publishing/github-pages.html
# - https://github.com/quarto-dev/quarto-actions

name: Documentation

on:
  push:
    branches: [master]
    paths:
      - 'documentation/**'
      - '.github/workflows/gh-pages.yml'

# Required permissions for Pages deployment
permissions:
  contents: read
  pages: write
  id-token: write

# Cancel in-progress runs for the same branch
concurrency:
  group: pages
  cancel-in-progress: false

jobs:
  build:
    name: Build Documentation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Setup Quarto
        uses: quarto-dev/quarto-actions/setup@v2

      - name: Render Quarto Project
        uses: quarto-dev/quarto-actions/render@v2
        with:
          path: documentation

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: documentation/_site

  deploy:
    name: Deploy to GitHub Pages
    runs-on: ubuntu-latest
    needs: build
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

Key changes from old workflow:
1. **Removed:** R setup, TinyTeX, bookdown rendering
2. **Added:** Quarto setup via quarto-dev/quarto-actions
3. **Changed:** JamesIves/github-pages-deploy-action -> actions/deploy-pages
4. **Changed:** gh-pages branch -> github-pages environment
5. **Removed:** PR builds (push to master only per CONTEXT.md)
6. **Added:** Required permissions (pages: write, id-token: write)
7. **Removed:** R package caching (not needed for Quarto)

The workflow is simpler and uses GitHub's official Pages deployment approach.

**Post-migration cleanup (manual step for user):**
After successful deployment, delete the gh-pages branch:
```bash
git push origin --delete gh-pages
```
Document this in SUMMARY.md as a post-migration step.
  </action>
  <verify>
Push changes to a test branch, verify workflow runs
Check Actions tab - build succeeds
Check Pages settings - environment deployment shows
Visit https://berntpopp.github.io/sysndd/ - documentation loads
  </verify>
  <done>
Workflow updated to use Quarto and actions/deploy-pages. Old bookdown/R setup removed. Push to master triggers build and deploy. gh-pages branch can be deleted after verification.
  </done>
</task>

</tasks>

<verification>
1. Run `cd documentation && quarto render` locally - no errors
2. Open `documentation/_site/index.html` - site renders correctly
3. Navigate all sections - content preserved, images load
4. Commit and push to master branch
5. Check GitHub Actions - workflow completes successfully
6. Check GitHub Pages environment - deployment shows
7. Visit https://berntpopp.github.io/sysndd/ - live site works
8. Verify navbar, sidebar, footer display correctly with SysNDD branding
</verification>

<success_criteria>
- documentation/_quarto.yml exists with website configuration
- All 8 chapters converted from .Rmd to .qmd format
- All original content preserved (no substantive changes)
- styles.css has SysNDD branding (colors, logo placement)
- .github/workflows/gh-pages.yml uses quarto-actions and deploy-pages
- Workflow triggers on push to master only (no PR builds)
- GitHub Pages environment deployment succeeds
- Live documentation site accessible at berntpopp.github.io/sysndd/
- Old bookdown files removed (_bookdown.yml, _output.yml, .Rmd files)
</success_criteria>

<output>
After completion, create `.planning/phases/62-admin-infrastructure/62-02-SUMMARY.md`

Note: After successful deployment, user should manually delete gh-pages branch:
`git push origin --delete gh-pages`
</output>
