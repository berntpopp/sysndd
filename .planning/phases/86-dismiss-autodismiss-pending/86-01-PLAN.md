# Phase 86 Plan 01: Dismiss & Auto-Dismiss Pending Statuses/Reviews

**Goal:** Allow curators to dismiss unwanted pending statuses/reviews, and auto-clean siblings when approving one.

## Tasks

### Task 1: Backend — Filter dismissed from pending lists
Add `is.na(approving_user_id)` filter to pending queries in:
- `api/endpoints/status_endpoints.R` (line ~87) — status pending list
- `api/endpoints/review_endpoints.R` (line ~100) — review pending list
- `api/services/approval-service.R` (lines ~49, ~120) — "approve all" batch queries

Pattern: `{if (!filter_status_approved) filter(., is.na(approving_user_id)) else .}`

### Task 2: Backend — Auto-dismiss siblings on approve
When approving a status/review, auto-set `approving_user_id` on remaining pending siblings for the same entity:
- `api/functions/status-repository.R` — in `status_approve()` approve path
- `api/functions/review-repository.R` — in `review_approve()` approve path

SQL: `UPDATE ndd_entity_status SET approving_user_id = ? WHERE entity_id IN (...) AND status_approved = 0 AND approving_user_id IS NULL AND status_id NOT IN (...)`

### Task 3: Frontend — Add dismiss to ApproveStatus.vue
- Dismiss button (outline-danger, bi-x-circle icon) in actions column
- Dismiss confirmation modal (danger theme)
- Duplicate warning button (variant="warning", bi-exclamation-triangle-fill)
- Enhanced approve modal with auto-dismiss info alert when hasDuplicates
- Updated legend with dismiss and duplicate icons

### Task 4: Frontend — Add dismiss to ApproveReview.vue
- Same pattern as ApproveStatus: dismiss button, modal, methods
- Calls `PUT /api/review/approve/{id}?review_ok=false`
- Auto-dismiss info alert in approve modal for duplicate entities
- Updated legend

### Task 5: Lint and type-check
- `npm run type-check` — verify TypeScript
- `npm run lint` — verify ESLint

### Task 6: Backend integration tests
- 40 assertions covering dismiss state, pending filter, auto-dismiss siblings, approve-all skip, cross-entity isolation, re-submission after dismiss

### Task 7: E2E testing via Playwright
- ApproveStatus: verify table, dismiss one status, approve with auto-dismiss
- ApproveReview: verify table, dismiss one review, approve with auto-dismiss

## Files Modified

| File | Change |
|------|--------|
| `api/endpoints/status_endpoints.R` | Add `is.na(approving_user_id)` filter |
| `api/endpoints/review_endpoints.R` | Add `is.na(approving_user_id)` filter |
| `api/services/approval-service.R` | Filter dismissed from "all" batch |
| `api/functions/status-repository.R` | Auto-dismiss siblings on approve |
| `api/functions/review-repository.R` | Auto-dismiss siblings on approve |
| `app/src/views/curate/ApproveStatus.vue` | Dismiss button/modal, duplicate warning, enhanced approve modal |
| `app/src/views/curate/ApproveReview.vue` | Dismiss button/modal, auto-dismiss warning |

## Files Created

| File | Purpose |
|------|---------|
| `api/tests/testthat/test-integration-dismiss-autodismiss.R` | Integration tests (40 assertions) |

---
*Phase: 86-dismiss-autodismiss-pending*
*Plan: 01*
