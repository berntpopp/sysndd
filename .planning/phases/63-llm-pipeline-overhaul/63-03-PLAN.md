---
phase: 63-llm-pipeline-overhaul
plan: 03
type: execute
wave: 3
depends_on: ["63-02"]
files_modified: []
autonomous: false
must_haves:
  truths:
    - "LlmSummaryCard component displays summary content in AnalyseGeneClusters.vue"
    - "LlmSummaryCard component displays summary content in AnalysesPhenotypeClusters.vue"
    - "AI-generated badge is visible with confidence indicator"
    - "Browser automation confirms UI rendering matches expected state"
  artifacts:
    - path: "app/src/components/llm/LlmSummaryCard.vue"
      provides: "LLM summary display component"
      contains: "AI-Generated"
    - path: "app/src/components/analyses/AnalyseGeneClusters.vue"
      provides: "Functional cluster analysis component"
      contains: "LlmSummaryCard"
    - path: "app/src/components/analyses/AnalysesPhenotypeClusters.vue"
      provides: "Phenotype cluster analysis component"
      contains: "LlmSummaryCard"
  key_links:
    - from: "app/src/components/analyses/AnalyseGeneClusters.vue"
      to: "/api/analysis/functional_cluster_summary"
      via: "useFetch on cluster selection"
      pattern: "functional_cluster_summary"
    - from: "app/src/components/llm/LlmSummaryCard.vue"
      to: "summary_json"
      via: "props binding"
      pattern: "summaryData"
---

<objective>
Verify LLM summaries display correctly in the browser using Playwright MCP automation.

Purpose: Confirm the complete user experience - from navigating to cluster analysis pages to seeing AI-generated summaries with badges and content. This is the final verification step per user requirements.

Output: Screenshot evidence and verification that LlmSummaryCard displays properly in both AnalyseGeneClusters and AnalysesPhenotypeClusters components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/63-llm-pipeline-overhaul/63-02-SUMMARY.md
@app/src/components/analyses/AnalyseGeneClusters.vue
@app/src/components/analyses/AnalysesPhenotypeClusters.vue
@app/src/components/llm/LlmSummaryCard.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Start Development Environment</name>
  <files>None</files>
  <action>
    Ensure the full development stack is running for browser verification:

    1. **Start database and API containers**:
       ```bash
       cd /home/bernt-popp/development/sysndd
       docker compose up -d mysql api
       ```

    2. **Wait for API to be healthy**:
       ```bash
       until curl -s http://localhost:7777/api/health/ | grep -q "healthy"; do sleep 2; done
       echo "API is ready"
       ```

    3. **Start frontend dev server**:
       ```bash
       cd /home/bernt-popp/development/sysndd/app
       npm run dev &
       sleep 5  # Wait for Vite to start
       ```

    4. **Verify frontend is accessible**:
       ```bash
       curl -s -o /dev/null -w "%{http_code}" http://localhost:5173/
       ```
       Should return 200.

    5. **Verify API proxy works through Vite**:
       ```bash
       curl -s "http://localhost:5173/api/health/" | jq -r '.status'
       ```
       Should return "healthy".

    Note: The frontend proxies /api calls to the backend at localhost:7777.
  </action>
  <verify>
    1. API healthy: `curl -s http://localhost:7777/api/health/ | jq -r '.status'` returns "healthy"
    2. Frontend accessible: `curl -s http://localhost:5173/ | head -1` returns HTML
    3. Proxy works: `curl -s http://localhost:5173/api/version/ | jq -r '.version'` returns version string
  </verify>
  <done>Full development stack running with API at :7777 and frontend at :5173.</done>
</task>

<task type="auto">
  <name>Task 2: Verify LLM Summaries with Playwright MCP</name>
  <files>None (verification using Playwright MCP tools)</files>
  <action>
    Use Playwright MCP tools to automate browser verification of LLM summaries.

    **Playwright MCP Tool Invocations:**

    **Step 1: Navigate to Functional Cluster Analysis**

    ```
    mcp__playwright__browser_navigate(url="http://localhost:5173/Analyses/GeneClusters")
    ```
    Wait for page load, then capture initial state:
    ```
    mcp__playwright__browser_snapshot()
    ```

    **Step 2: Interact with Cluster Visualization**

    From the snapshot, identify a cluster node element. Click on it:
    ```
    mcp__playwright__browser_click(element="[cluster node selector from snapshot]", ref="cluster_node_ref")
    ```

    Wait for LlmSummaryCard to appear and capture state:
    ```
    mcp__playwright__browser_snapshot()
    ```

    **Step 3: Verify LlmSummaryCard Content**

    From the snapshot, verify these elements are present:
    - Card with "AI-Generated" badge (look for text "AI-Generated" in snapshot)
    - Summary text (2-3 sentences describing cluster function)
    - Key themes list (look for "Key Themes" section)
    - Pathways section (look for "Pathways" section)
    - Tags displayed (BBadge elements with keywords)
    - Confidence indicator (high/medium/low badge)

    **Step 4: Take Screenshot Evidence**

    Capture screenshot of the functional cluster page with summary visible:
    ```
    mcp__playwright__browser_take_screenshot(filename="functional_cluster_summary.png")
    ```

    **Step 5: Navigate to Phenotype Cluster Analysis**

    ```
    mcp__playwright__browser_navigate(url="http://localhost:5173/Analyses/PhenotypeClusters")
    ```
    Capture initial state:
    ```
    mcp__playwright__browser_snapshot()
    ```

    **Step 6: Select Phenotype Cluster**

    Click on a phenotype cluster node:
    ```
    mcp__playwright__browser_click(element="[phenotype cluster selector from snapshot]", ref="phenotype_cluster_ref")
    ```

    Wait and capture state:
    ```
    mcp__playwright__browser_snapshot()
    ```

    **Step 7: Verify and Screenshot Phenotype Summary**

    Verify LlmSummaryCard displays for phenotype cluster.
    Take screenshot:
    ```
    mcp__playwright__browser_take_screenshot(filename="phenotype_cluster_summary.png")
    ```

    **Expected UI Elements (from LlmSummaryCard.vue):**
    - BCard with header showing "AI-Generated Summary"
    - BBadge with "AI-Generated" label (variant="info")
    - Confidence badge (variant based on derived_confidence score)
    - Summary text in card body
    - Key themes as comma-separated list
    - Pathways as comma-separated list
    - Tags as BBadge elements
    - Footer with model name and generation date

    **Fallback if no summaries exist:**

    If summaries are not yet generated (404 from API), the component should:
    - Hide gracefully (not show error)
    - OR show "No AI summary available" placeholder

    In this case, trigger clustering first (from Plan 02) to generate summaries,
    then retry verification.
  </action>
  <verify>
    Playwright MCP verification confirms:
    1. AnalyseGeneClusters page loads and shows clusters
    2. Clicking a cluster shows LlmSummaryCard
    3. AI-Generated badge is visible in snapshot
    4. Summary content (text, themes, pathways) displays in snapshot
    5. Same verification passes for AnalysesPhenotypeClusters
    6. Screenshots captured: functional_cluster_summary.png, phenotype_cluster_summary.png
  </verify>
  <done>
    Browser automation confirms LlmSummaryCard displays correctly in both views;
    screenshots captured as evidence.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete LLM pipeline fix with end-to-end verification:
    - Docker build fixed for ICU compatibility
    - Database operations work in mirai daemons
    - LLM batch generation triggers after clustering
    - Summaries stored in cache table
    - API endpoints return 200 with summary data
    - Frontend LlmSummaryCard displays summaries
    - All tests pass (687 + 11 E2E)
    - All linting passes (R + TypeScript)
    - Browser automation verified UI rendering
  </what-built>
  <how-to-verify>
    1. Open browser to http://localhost:5173/Analyses/GeneClusters
    2. Wait for cluster visualization to load
    3. Click on a cluster node in the visualization
    4. Verify LlmSummaryCard appears with:
       - "AI-Generated" badge (blue/info color)
       - Summary text describing cluster function
       - Key themes section
       - Confidence indicator badge
    5. Navigate to http://localhost:5173/Analyses/PhenotypeClusters
    6. Repeat verification for phenotype clusters
    7. Check browser console for any errors (should be clean)
  </how-to-verify>
  <resume-signal>
    Type "approved" if LLM summaries display correctly in both views.
    If issues found, describe what's missing or broken.
  </resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Development Environment**: Full stack running (API + frontend)
2. **Playwright Verification**: Browser automation confirms UI works
3. **Human Verification**: User confirms visual appearance is correct
4. **Screenshot Evidence**: Captures stored for documentation

Complete LLM-FIX-07 requirement:
- LlmSummaryCard component displays summary content
- AI-Generated badge visible with confidence indicator
- Both functional and phenotype cluster views work
</verification>

<success_criteria>
- LLM-FIX-07: Frontend displays AI-generated summaries
- LlmSummaryCard visible in AnalyseGeneClusters.vue
- LlmSummaryCard visible in AnalysesPhenotypeClusters.vue
- AI-Generated badge displays with correct styling
- Summary content (text, themes, pathways, tags) renders
- Confidence indicator shows derived confidence score
- Human verification confirms visual correctness
</success_criteria>

<output>
After completion, create `.planning/phases/63-llm-pipeline-overhaul/63-03-SUMMARY.md`

Also create `.planning/phases/63-llm-pipeline-overhaul/63-VERIFICATION.md` with:
- All LLM-FIX requirements verified
- Test results summary
- Lint results summary
- Screenshot references
</output>
