---
phase: 01-api-refactoring-completion
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - api/README.md
autonomous: true

must_haves:
  truths:
    - "Legacy api/_old/ directory no longer exists"
    - "README accurately describes the new modular endpoint structure"
    - "README lists all 21 endpoint files"
    - "No references to sysndd_plumber.R remain in documentation"
  artifacts:
    - path: "api/README.md"
      provides: "Updated API documentation"
      contains: "endpoints/"
      min_lines: 100
  key_links:
    - from: "api/README.md"
      to: "api/endpoints/*.R"
      via: "documentation of endpoint files"
      pattern: "endpoints/"
---

<objective>
Remove legacy code and update documentation to reflect the new modular API structure.

Purpose: REF-02 (remove legacy _old/) and REF-03 (update documentation) complete the refactoring by cleaning up obsolete code and ensuring documentation matches reality.

Output: Clean repository without legacy code; README that accurately documents the 21-file modular endpoint structure.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-api-refactoring-completion/01-01-SUMMARY.md

# Current documentation
@api/README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove legacy _old/ directory</name>
  <files>api/_old/</files>
  <action>
Remove the legacy code directory that contains pre-refactoring files.

The directory contains:
- api/_old/plumber_2021-04-17.R (very old version)
- api/_old/sysndd_plumber.R (pre-refactor monolithic file)

Steps:
1. Verify Plan 01 checkpoint passed (endpoints verified working)
2. Remove the entire api/_old/ directory using git:
   ```bash
   cd /mnt/c/development/sysndd
   git rm -r api/_old/
   ```

This is safe because:
- Endpoint verification (Plan 01) confirmed new structure works
- Legacy code is preserved in git history if ever needed
- The old sysndd_plumber.R had ~20 basic endpoints; new structure has 94 across 21 files
  </action>
  <verify>
Run: `ls /mnt/c/development/sysndd/api/_old/ 2>/dev/null || echo "Directory removed"`
Expected: "Directory removed"

Run: `git status`
Expected: Shows deleted files in api/_old/
  </verify>
  <done>api/_old/ directory removed from repository</done>
</task>

<task type="auto">
  <name>Task 2: Update README to document new structure</name>
  <files>api/README.md</files>
  <action>
Update the API README to accurately document the refactored modular endpoint structure.

Changes needed:

1. **Remove references to legacy files:**
   - Remove mention of `sysndd_plumber.R` as an active file
   - Remove `_old` from directory structure
   - Update "Core Files" section to reflect current state

2. **Add comprehensive endpoint documentation:**
   Add a new section "## API Endpoints" that lists all 21 endpoint files with their mount paths:

   ```markdown
   ## API Endpoints

   The API uses a modular structure with endpoints organized by domain. Each endpoint file is mounted at `/api/<resource>`:

   | Mount Path | Endpoint File | Description |
   |------------|---------------|-------------|
   | /api/entity | entity_endpoints.R | Entity CRUD operations |
   | /api/gene | gene_endpoints.R | Gene information |
   | /api/phenotype | phenotype_endpoints.R | Phenotype data |
   | /api/ontology | ontology_endpoints.R | Ontology services |
   | /api/status | status_endpoints.R | Entity status management |
   | /api/review | review_endpoints.R | Review workflow |
   | /api/re_review | re_review_endpoints.R | Re-review workflow |
   | /api/publication | publication_endpoints.R | Publication references |
   | /api/panels | panels_endpoints.R | Gene panels |
   | /api/comparisons | comparisons_endpoints.R | Entity comparisons |
   | /api/analysis | analysis_endpoints.R | Data analysis |
   | /api/statistics | statistics_endpoints.R | Database statistics |
   | /api/search | search_endpoints.R | Search functionality |
   | /api/list | list_endpoints.R | List generation |
   | /api/hash | hash_endpoints.R | Hash validation |
   | /api/variant | variant_endpoints.R | Variant data |
   | /api/user | user_endpoints.R | User management |
   | /api/auth | authentication_endpoints.R | Authentication |
   | /api/admin | admin_endpoints.R | Admin operations |
   | /api/logs | logging_endpoints.R | API logging |
   | /api/external | external_endpoints.R | External API proxies |
   ```

3. **Update Directory Structure:**
   Remove `_old` folder, ensure `endpoints/` is clearly shown with note about 21 files.

4. **Update "Core Files" section:**
   - Remove `sysndd_plumber.R` reference
   - Emphasize `start_sysndd_api.R` as the single entry point
   - Note that it mounts all endpoint files

Keep existing sections about:
- Code Quality Standards
- Development Commands
- Setup and Usage
- Contribution guidelines
  </action>
  <verify>
Check README contains key sections:
- `grep -c "API Endpoints" api/README.md` returns 1
- `grep -c "entity_endpoints.R" api/README.md` returns at least 1
- `grep -c "_old" api/README.md` returns 0
- `grep -c "sysndd_plumber.R" api/README.md` returns 0 (or only in historical context)
  </verify>
  <done>README updated with modular endpoint structure; no references to legacy files</done>
</task>

<task type="auto">
  <name>Task 3: Commit changes</name>
  <files>git</files>
  <action>
Commit the legacy removal and documentation updates.

```bash
cd /mnt/c/development/sysndd

# Stage changes
git add api/_old/ api/README.md

# Commit with conventional commit message
git commit -m "refactor(api): complete endpoint modularization (#109)

## Summary
Remove legacy monolithic plumber file and update documentation to reflect
the new 21-file modular endpoint structure.

## Details
- Remove api/_old/ directory containing sysndd_plumber.R (pre-refactor)
- Update README.md with comprehensive endpoint documentation
- Document all 21 mount points and their purpose
- Clean up references to legacy file structure

Closes #109"
```
  </action>
  <verify>
Run: `git log --oneline -1`
Expected: Shows commit with message containing "#109"

Run: `git status`
Expected: Clean working tree (nothing to commit)
  </verify>
  <done>Changes committed with reference to Issue #109</done>
</task>

</tasks>

<verification>
- [ ] api/_old/ directory no longer exists
- [ ] api/README.md documents all 21 endpoint files
- [ ] No broken references to removed files
- [ ] Commit references Issue #109
- [ ] Git working tree is clean
</verification>

<success_criteria>
- Legacy api/_old/ directory removed from repository
- README.md accurately describes modular endpoint structure
- README.md lists all 21 endpoint files with mount paths
- Changes committed with proper conventional commit message
- Issue #109 referenced in commit for traceability
</success_criteria>

<output>
After completion, create `.planning/phases/01-api-refactoring-completion/01-02-SUMMARY.md`
</output>
