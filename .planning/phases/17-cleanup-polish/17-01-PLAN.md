---
phase: 17-cleanup-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/vite.config.ts
  - app/dist/stats.html
  - .planning/phases/17-cleanup-polish/BUNDLE-ANALYSIS.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Bundle analysis report exists with baseline measurements"
    - "Bundle size measured in gzipped bytes"
    - "Top 10 largest chunks identified"
    - "Lighthouse baseline scores recorded for key pages"
  artifacts:
    - path: "app/dist/stats.html"
      provides: "Bundle visualization treemap"
    - path: ".planning/phases/17-cleanup-polish/BUNDLE-ANALYSIS.md"
      provides: "Baseline measurements and analysis"
      contains: "Total bundle size"
  key_links:
    - from: "app/vite.config.ts"
      to: "rollup-plugin-visualizer"
      via: "plugin configuration"
      pattern: "visualizer"
---

<objective>
Establish baseline bundle and performance measurements before cleanup changes

Purpose: Measure current state to track optimization progress and ensure changes improve rather than regress performance
Output: BUNDLE-ANALYSIS.md with baseline metrics, bundle visualization HTML
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-cleanup-polish/17-CONTEXT.md
@.planning/phases/17-cleanup-polish/17-RESEARCH.md
@app/vite.config.ts
@app/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install and configure rollup-plugin-visualizer</name>
  <files>app/package.json, app/vite.config.ts</files>
  <action>
Install rollup-plugin-visualizer:
```bash
cd app && npm install --save-dev rollup-plugin-visualizer
```

Update vite.config.ts to add visualizer plugin at the end of plugins array:
```typescript
import { visualizer } from 'rollup-plugin-visualizer';
import type { PluginOption } from 'vite';

// In plugins array, add at the end:
visualizer({
  filename: './dist/stats.html',
  open: process.env.ANALYZE === 'true',
  gzipSize: true,
  brotliSize: true,
  template: 'treemap',
}) as PluginOption,
```

Do NOT modify any other parts of vite.config.ts (keep @vue/compat alias and compatConfig for now).
  </action>
  <verify>
```bash
cd app && npm run build:production
ls -la app/dist/stats.html
```
Build succeeds and stats.html is generated.
  </verify>
  <done>Visualizer plugin configured and generating bundle stats on production build</done>
</task>

<task type="auto">
  <name>Task 2: Generate baseline measurements and create BUNDLE-ANALYSIS.md</name>
  <files>.planning/phases/17-cleanup-polish/BUNDLE-ANALYSIS.md</files>
  <action>
Run production build with analysis:
```bash
cd app && ANALYZE=true npm run build:production
```

Calculate bundle sizes:
```bash
# Total JS size (gzipped)
find app/dist/assets -name "*.js" -exec gzip -c {} \; | wc -c

# Individual chunk sizes
ls -la app/dist/assets/*.js

# Check against 2MB target
du -h app/dist/
```

Run Lighthouse baseline on dev server (start server first, then run lighthouse):
```bash
cd app && npm run dev &
sleep 5
npx lighthouse http://localhost:5173 --output=json --output-path=./.lighthouse-baseline.json --chrome-flags="--headless" 2>/dev/null || echo "Lighthouse baseline: manual measurement needed"
```

Create `.planning/phases/17-cleanup-polish/BUNDLE-ANALYSIS.md` with:
- Current date and milestone
- Total bundle size (raw and gzipped)
- Individual chunk breakdown (vendor, bootstrap, viz, etc.)
- Lighthouse baseline scores (if captured, otherwise note for manual)
- Top 10 largest modules from stats.html analysis
- Recommendations based on findings
- Comparison to 2MB target

Format per CONTEXT.md: include size breakdown, recommendations, and optimization history sections.
  </action>
  <verify>
```bash
cat .planning/phases/17-cleanup-polish/BUNDLE-ANALYSIS.md | head -50
```
File exists with baseline measurements.
  </verify>
  <done>BUNDLE-ANALYSIS.md created with current bundle size, chunk breakdown, and baseline Lighthouse scores</done>
</task>

</tasks>

<verification>
- [ ] rollup-plugin-visualizer installed in devDependencies
- [ ] vite.config.ts has visualizer plugin configured
- [ ] Production build generates dist/stats.html
- [ ] BUNDLE-ANALYSIS.md exists with baseline measurements
- [ ] Bundle size compared to 2MB gzipped target
</verification>

<success_criteria>
- Bundle analysis tooling installed and configured
- Baseline measurements documented in BUNDLE-ANALYSIS.md
- Current bundle size known (will inform if 2MB target is already met or needs work)
- Foundation established for tracking optimization progress
</success_criteria>

<output>
After completion, create `.planning/phases/17-cleanup-polish/17-01-SUMMARY.md`
</output>
