---
phase: 17-cleanup-polish
plan: 04
type: execute
wave: 3
depends_on: ["17-02", "17-03"]
files_modified:
  - app/package.json
  - app/package-lock.json
autonomous: true
user_setup: []

must_haves:
  truths:
    - "All unused dependencies removed"
    - "No Vue CLI packages in dependencies"
    - "No webpack packages in devDependencies"
    - "npm audit shows no high/critical vulnerabilities in production deps"
    - "Build and tests still pass after cleanup"
  artifacts:
    - path: "app/package.json"
      provides: "Cleaned dependency list"
  key_links:
    - from: "app/package.json"
      to: "vite"
      via: "devDependencies"
      pattern: "\"vite\":"
---

<objective>
Remove unused dependencies and fix security vulnerabilities

Purpose: Minimize bundle size, reduce attack surface, and ensure no unnecessary packages remain from Vue CLI/webpack era
Output: Lean package.json with only needed dependencies, no npm audit issues
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-cleanup-polish/17-CONTEXT.md
@.planning/phases/17-cleanup-polish/17-RESEARCH.md
@app/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Identify and remove unused dependencies</name>
  <files>app/package.json</files>
  <action>
Run depcheck to find unused packages:
```bash
cd app && npx depcheck
```

Based on package.json analysis and depcheck output, remove:

**Vue CLI packages (replaced by Vite):**
```bash
cd app && npm uninstall @vue/cli-plugin-babel @vue/cli-plugin-pwa @vue/cli-plugin-router @vue/cli-service vue-cli-plugin-axios vue-cli-plugin-mdb vue-cli-plugin-sitemap vue-cli-plugin-tailwind vue-cli-plugin-webpack-bundle-analyzer
```

**Webpack packages (replaced by Vite/Rollup):**
```bash
cd app && npm uninstall webpack-bundle-analyzer webpack-cli css-loader sass-loader
```

**Legacy/unused packages:**
```bash
cd app && npm uninstall vue-loader vue-server-renderer esm @fullhuman/postcss-purgecss @fullhuman/vue-cli-plugin-purgecss bootstrap-vue-loader core-js @babel/plugin-syntax-dynamic-import
```

Note: Keep vue-loader only if Vitest requires it (check after removal).
Note: Keep core-js only if transpilation still needs it (unlikely with modern browsers target).

Run build and tests after each batch to catch issues early.
  </action>
  <verify>
```bash
cd app && npm run build:production && npm run test:unit
```
Build succeeds and tests pass after removals.
  </verify>
  <done>Unused Vue CLI and webpack dependencies removed</done>
</task>

<task type="auto">
  <name>Task 2: Run npm audit and fix vulnerabilities</name>
  <files>app/package.json, app/package-lock.json</files>
  <action>
Run security audit:
```bash
cd app && npm audit
```

Fix safe vulnerabilities (within semver):
```bash
cd app && npm audit fix
```

For remaining issues, check if they are in production or dev dependencies:
```bash
cd app && npm audit --production
```

If production vulnerabilities exist:
- Check if package can be updated to newer version
- Check if package has a replacement
- Document any accepted risks in BUNDLE-ANALYSIS.md

DO NOT run `npm audit fix --force` - this can break functionality.

If a vulnerability requires major version update, investigate manually:
```bash
cd app && npm outdated
```

For packages with vulnerabilities that can't be auto-fixed:
- Try updating to latest: `npm install package@latest`
- If that breaks things, document the issue
  </action>
  <verify>
```bash
cd app && npm audit --production | grep -E "(high|critical)" || echo "No high/critical production vulnerabilities"
cd app && npm run build:production && npm run test:unit
```
No high/critical production vulnerabilities, build passes.
  </verify>
  <done>Security vulnerabilities addressed, audit clean or documented exceptions</done>
</task>

<task type="auto">
  <name>Task 3: Update package.json scripts and verify</name>
  <files>app/package.json</files>
  <action>
Remove Vue CLI scripts from package.json scripts section:
- Remove: "serve": "vue-cli-service serve"
- Remove: "build": "vue-cli-service build" (or rename to build:legacy)
- Remove: "sitemap": "vue-cli-service sitemap"
- Remove: "start": "vue-cli-service serve --open"

Rename/update scripts for clarity:
- "dev" stays as is (vite)
- "build" should point to Vite: "vue-tsc --noEmit && vite build"
- Keep "build:vite", "build:docker", "build:production"
- Keep all test scripts

Clean up any other Vue CLI references in scripts.

Final verification:
```bash
cd app && npm run build
cd app && npm run dev &
sleep 3
curl -s http://localhost:5173 | head -10
pkill -f "vite"
cd app && npm run test:unit
```
  </action>
  <verify>
```bash
cd app && npm run build && npm run test:unit
grep "vue-cli-service" app/package.json && echo "FAIL: Vue CLI refs remain" || echo "PASS: No Vue CLI refs"
```
No vue-cli-service references in scripts, build passes.
  </verify>
  <done>Package.json cleaned of Vue CLI references, scripts point to Vite</done>
</task>

</tasks>

<verification>
- [ ] depcheck shows no unused dependencies (or documented exceptions)
- [ ] No @vue/cli-* packages in package.json
- [ ] No webpack packages in package.json (except if needed by a tool)
- [ ] npm audit --production shows no high/critical issues
- [ ] package.json scripts use Vite, not Vue CLI
- [ ] npm run build succeeds
- [ ] npm run test:unit passes
</verification>

<success_criteria>
- Dependency list minimal and intentional
- No legacy Vue CLI or webpack packages
- Security audit clean (or documented exceptions)
- Build and tests pass
- Scripts all point to Vite tooling
</success_criteria>

<output>
After completion, create `.planning/phases/17-cleanup-polish/17-04-SUMMARY.md`
</output>
