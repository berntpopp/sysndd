---
phase: 17-cleanup-polish
plan: 06
type: execute
wave: 5
depends_on: ["17-05"]
files_modified:
  - .planning/phases/17-cleanup-polish/BUNDLE-ANALYSIS.md
  - app/lighthouserc.json
autonomous: false
user_setup: []

must_haves:
  truths:
    - "Lighthouse audit completed on key pages"
    - "Performance, Accessibility, Best Practices, SEO scores documented"
    - "Issues preventing score of 100 identified and either fixed or documented"
    - "All fixable issues addressed"
  artifacts:
    - path: ".planning/phases/17-cleanup-polish/BUNDLE-ANALYSIS.md"
      provides: "Lighthouse results section"
      contains: "Lighthouse"
  key_links:
    - from: "app/lighthouserc.json"
      to: "lighthouse"
      via: "configuration"
      pattern: "assertions"
---

<objective>
Audit performance with Lighthouse and achieve maximum scores

Purpose: Verify application meets performance targets (target: 100 in all categories per CONTEXT.md)
Output: Lighthouse scores documented, issues fixed or GitHub issues filed
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-cleanup-polish/17-CONTEXT.md
@.planning/phases/17-cleanup-polish/17-RESEARCH.md
@.planning/phases/17-cleanup-polish/BUNDLE-ANALYSIS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up Lighthouse CI configuration</name>
  <files>app/lighthouserc.json</files>
  <action>
Create lighthouserc.json in app/ directory:
```json
{
  "ci": {
    "collect": {
      "url": [
        "http://localhost:5173/",
        "http://localhost:5173/Genes",
        "http://localhost:5173/Entities",
        "http://localhost:5173/Ontology"
      ],
      "numberOfRuns": 3,
      "settings": {
        "preset": "desktop"
      }
    },
    "assert": {
      "assertions": {
        "categories:performance": ["warn", {"minScore": 0.9}],
        "categories:accessibility": ["warn", {"minScore": 0.9}],
        "categories:best-practices": ["warn", {"minScore": 0.9}],
        "categories:seo": ["warn", {"minScore": 0.9}]
      }
    }
  }
}
```

Note: Using "warn" instead of "error" during initial audit. Will tighten after fixing issues.
Note: URLs adjusted to match actual routes in the application.
  </action>
  <verify>
```bash
cat app/lighthouserc.json | jq .
```
Valid JSON configuration file exists.
  </verify>
  <done>Lighthouse CI configuration created</done>
</task>

<task type="auto">
  <name>Task 2: Run Lighthouse audits and document results</name>
  <files>.planning/phases/17-cleanup-polish/BUNDLE-ANALYSIS.md</files>
  <action>
Start dev server and run Lighthouse:
```bash
cd app && npm run build:production
cd app && npm run preview &
sleep 3
```

Run Lighthouse on key pages (requires Chrome):
```bash
# Install Lighthouse CLI if needed
npm install -g lighthouse

# Run on landing page
lighthouse http://localhost:4173/ --output=json --output-path=./lighthouse-landing.json --chrome-flags="--headless" --preset=desktop

# Run on genes page
lighthouse http://localhost:4173/Genes --output=json --output-path=./lighthouse-genes.json --chrome-flags="--headless" --preset=desktop

# Run on entities page
lighthouse http://localhost:4173/Entities --output=json --output-path=./lighthouse-entities.json --chrome-flags="--headless" --preset=desktop

# Extract scores
for f in lighthouse-*.json; do
  echo "=== $f ==="
  cat $f | jq '.categories | to_entries[] | "\(.key): \(.value.score * 100)"'
done
```

Document results in BUNDLE-ANALYSIS.md under "Lighthouse Audit Results" section:
- Table of scores per page
- Issues identified (from "opportunities" and "diagnostics")
- List of fixable vs. unfixable issues

```bash
pkill -f "vite preview"
```
  </action>
  <verify>
```bash
grep -A20 "Lighthouse Audit" .planning/phases/17-cleanup-polish/BUNDLE-ANALYSIS.md
```
Lighthouse results documented.
  </verify>
  <done>Lighthouse audits completed and documented</done>
</task>

<task type="auto">
  <name>Task 3: Fix addressable Lighthouse issues</name>
  <files>app/src/**/*.vue, app/index.html</files>
  <action>
Based on Lighthouse results, fix common issues:

**Performance issues:**
- Add width/height to images: `<img width="X" height="Y" ...>`
- Preload critical fonts: Add `<link rel="preload">` to index.html
- Defer non-critical scripts: Already handled by Vite async imports

**Accessibility issues:**
- Add missing aria-labels to interactive elements
- Ensure color contrast meets WCAG AA (4.5:1 for text)
- Add alt text to images: `<img alt="description" ...>`
- Ensure form labels are associated

**Best Practices issues:**
- Use HTTPS for all resources (should already be configured)
- Remove console.log statements from production
- Ensure no deprecated APIs

**SEO issues:**
- Ensure meta description exists in index.html
- Ensure title tags are present
- Add structured data if missing

Only fix issues that are within scope. For issues requiring significant refactoring, create GitHub issues instead:
```bash
# Example: If image optimization needed
echo "Create GitHub issue: Optimize images for Lighthouse performance"
```

Re-run Lighthouse after fixes to verify improvement.
  </action>
  <verify>
```bash
cd app && npm run build:production
cd app && npm run preview &
sleep 3
lighthouse http://localhost:4173/ --output=json --output-path=./lighthouse-final.json --chrome-flags="--headless" --preset=desktop
cat lighthouse-final.json | jq '.categories | to_entries[] | "\(.key): \(.value.score * 100)"'
pkill -f "vite preview"
```
Scores improved or documented why they cannot be improved.
  </verify>
  <done>Addressable Lighthouse issues fixed, remaining issues documented</done>
</task>

</tasks>

<verification>
- [ ] lighthouserc.json configuration created
- [ ] Lighthouse audits run on key pages
- [ ] Results documented in BUNDLE-ANALYSIS.md
- [ ] Addressable issues fixed
- [ ] Unfixable issues documented with GitHub issue references
- [ ] Final scores documented
</verification>

<success_criteria>
- Lighthouse scores documented for landing, gene, entity, disease pages
- Target: 100 in all categories (per CONTEXT.md)
- If 100 not achievable, issues filed per CONTEXT.md
- Performance audit complete with actionable insights
- Application still works after fixes
</success_criteria>

<output>
After completion, create `.planning/phases/17-cleanup-polish/17-06-SUMMARY.md`
</output>

<checkpoint type="checkpoint:human-verify" gate="blocking">
  <what-built>Lighthouse audit results and performance fixes</what-built>
  <how-to-verify>
1. Review Lighthouse scores in BUNDLE-ANALYSIS.md
2. If scores < 100, verify GitHub issues were filed
3. Start dev server: `cd app && npm run dev`
4. Open http://localhost:5173 in Chrome
5. Open DevTools > Lighthouse tab
6. Run audit and compare to documented scores
7. Verify no critical issues remain unfixed
  </how-to-verify>
  <resume-signal>Type "approved" to continue to browser testing, or describe issues to address</resume-signal>
</checkpoint>
