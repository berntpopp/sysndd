---
phase: 11-bootstrap-vue-next
plan: 06
type: execute
wave: 4
depends_on: ["11-05"]
files_modified:
  - app/src/main.js
  - app/src/App.vue
  - app/src/views/Login.vue
  - app/src/views/Register.vue
  - app/src/views/PasswordReset.vue
  - app/src/components/analyses/AnalysesCurationUpset.vue
  - app/src/views/*.vue (23 files with metaInfo)
  - app/package.json
autonomous: false
user_setup:
  - service: npm
    why: "Installing new packages and removing old ones"
    env_vars: []
    dashboard_config: []

must_haves:
  truths:
    - "Page titles update correctly on navigation"
    - "Form validation works with vee-validate 4 - error messages appear for invalid input"
    - "Treeselect components open, allow selection, and emit selection events"
    - "UpSet.js chart renders with sample data from curation analysis view"
    - "No vue2-perfect-scrollbar usage (native scrollbars)"
    - "No Bootstrap-Vue imports remain"
  artifacts:
    - path: "app/src/main.js"
      provides: "@unhead/vue setup, removed old packages"
      contains: "@unhead/vue"
    - path: "app/src/views/Login.vue"
      provides: "Migrated vee-validate 4 form validation"
      contains: "useForm|useField"
    - path: "app/src/components/analyses/AnalysesCurationUpset.vue"
      provides: "@upsetjs/bundle integration"
      contains: "@upsetjs/bundle"
  key_links:
    - from: "main.js"
      to: "@unhead/vue"
      via: "createHead plugin"
      pattern: "createHead|useHead"
    - from: "Login.vue"
      to: "vee-validate"
      via: "useForm composable"
      pattern: "useForm.*useField"
    - from: "treeselect components"
      to: "@r2rka/vue3-treeselect"
      via: "TreeSelect import"
      pattern: "import.*TreeSelect.*vue3-treeselect"
---

<objective>
Migrate third-party libraries to Vue 3 compatible versions and remove deprecated packages

Purpose: Complete the Bootstrap-Vue-Next migration by updating all third-party dependencies that don't support Vue 3. This includes vue-meta -> @unhead/vue, vee-validate 3 -> 4, vue-treeselect replacement, and removing vue2-perfect-scrollbar.

Output:
- @unhead/vue replaces vue-meta (23 files)
- vee-validate 4 replaces vee-validate 3 (3 files)
- @r2rka/vue3-treeselect replaces @riophae/vue-treeselect (12 files)
- vue2-perfect-scrollbar removed (2 files)
- @upsetjs/bundle replaces @upsetjs/vue (1 file)
- All old Bootstrap-Vue imports removed
- Old packages uninstalled
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-bootstrap-vue-next/11-CONTEXT.md
@.planning/phases/11-bootstrap-vue-next/11-RESEARCH.md
@.planning/phases/11-bootstrap-vue-next/11-05-SUMMARY.md
@app/src/main.js
@app/src/App.vue
@app/src/views/Login.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate vue-meta to @unhead/vue</name>
  <files>app/src/main.js, app/src/views/*.vue (23 files), app/src/App.vue</files>
  <action>
Replace vue-meta with @unhead/vue for page head management:

1. Install @unhead/vue:
   ```bash
   cd app && npm install @unhead/vue --legacy-peer-deps
   ```

2. Update main.js:
   ```javascript
   // Remove
   import VueMeta from 'vue-meta'
   Vue.use(VueMeta, {...})

   // Add
   import { createHead } from '@unhead/vue/client'

   // After createApp
   const head = createHead()
   app.use(head)
   ```

3. For each component with `metaInfo` option (23 files), convert to useHead():

   **Option A - For Composition API or setup():**
   ```javascript
   // Before (Options API)
   export default {
     metaInfo: {
       title: 'Page Title',
       meta: [{ vmid: 'description', name: 'description', content: '...' }]
     }
   }

   // After
   import { useHead } from '@unhead/vue'

   export default {
     setup() {
       useHead({
         title: 'Page Title',
         meta: [{ name: 'description', content: '...' }]
       })
     }
   }
   ```

   **Option B - For reactive titles in Options API:**
   ```javascript
   import { useHead } from '@unhead/vue'
   import { computed } from 'vue'

   export default {
     setup() {
       // Return empty, head managed separately
       return {}
     },
     created() {
       useHead({
         title: computed(() => this.pageTitle || 'Default'),
       })
     }
   }
   ```

4. Update App.vue root metaInfo (template string, default title):
   ```javascript
   import { useHead } from '@unhead/vue'

   // In setup or created
   useHead({
     titleTemplate: '%s | SysNDD - The expert curated database...',
     htmlAttrs: { lang: 'en' },
     meta: [{ name: 'description', content: 'SysNDD contains...' }]
   })
   ```

Files to update (grep -r "metaInfo" app/src --include="*.vue" -l):
- All view files that set page-specific titles
- App.vue for the template
  </action>
  <verify>
Navigate between pages and verify:
- Browser tab title changes
- Document head contains correct meta tags
- No vue-meta warnings in console
  </verify>
  <done>
@unhead/vue installed and configured. All 23 files using metaInfo migrated to useHead(). Page titles update correctly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate vee-validate 3 to 4</name>
  <files>app/src/main.js, app/src/views/Login.vue, app/src/views/Register.vue, app/src/views/PasswordReset.vue</files>
  <action>
Migrate vee-validate from version 3 to version 4:

1. Install vee-validate 4:
   ```bash
   npm install vee-validate@4 @vee-validate/rules --legacy-peer-deps
   ```

2. Update main.js - remove old vee-validate setup:
   ```javascript
   // Remove all of:
   import { ValidationObserver, ValidationProvider, extend, localize } from 'vee-validate'
   import en from 'vee-validate/dist/locale/en.json'
   import * as rules from 'vee-validate/dist/rules'
   Object.keys(rules).forEach(...)
   localize('en', en)
   Vue.component('ValidationObserver', ValidationObserver)
   Vue.component('ValidationProvider', ValidationProvider)
   ```

3. Update Login.vue (similar for Register, PasswordReset):
   ```vue
   <!-- Before -->
   <validation-observer ref="observer" v-slot="{ handleSubmit }">
     <b-form @submit.prevent="handleSubmit(onSubmit)">
       <validation-provider v-slot="{ errors }" name="email" rules="required|email">
         <b-form-input v-model="email" :state="errors.length ? false : null" />
         <b-form-invalid-feedback>{{ errors[0] }}</b-form-invalid-feedback>
       </validation-provider>
     </b-form>
   </validation-observer>

   <!-- After -->
   <BForm @submit="onSubmit">
     <BFormGroup label="Email">
       <BFormInput v-model="email" :state="emailMeta.valid === false ? false : null" />
       <BFormInvalidFeedback v-if="emailError">{{ emailError }}</BFormInvalidFeedback>
     </BFormGroup>
   </BForm>

   <script>
   import { useForm, useField } from 'vee-validate'
   import { toTypedSchema } from '@vee-validate/yup'
   import * as yup from 'yup'

   // OR use string-based rules from @vee-validate/rules:
   import { required, email } from '@vee-validate/rules'
   import { defineRule } from 'vee-validate'

   defineRule('required', required)
   defineRule('email', email)

   export default {
     setup() {
       const { handleSubmit } = useForm()
       const { value: emailValue, errorMessage: emailError, meta: emailMeta } = useField('email', 'required|email')

       const onSubmit = handleSubmit((values) => {
         // handle form submission
       })

       return { email: emailValue, emailError, emailMeta, onSubmit }
     }
   }
   </script>
   ```

4. Apply same pattern to Register.vue and PasswordReset.vue
  </action>
  <verify>
Test form validation on Login.vue:
1. Leave email empty, try to submit - verify error message appears
2. Enter invalid email format (no @), try to submit - verify error message
3. Enter valid email - verify error clears
4. Complete login flow - verify form submits successfully
  </verify>
  <done>
vee-validate 4 configured with Composition API in Login, Register, PasswordReset. Forms validate correctly with error messages appearing for invalid input.
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate vue-treeselect to vue3-treeselect</name>
  <files>12 Vue files using treeselect (see action)</files>
  <action>
Replace @riophae/vue-treeselect with @r2rka/vue3-treeselect:

1. Install replacement:
   ```bash
   npm install @r2rka/vue3-treeselect --legacy-peer-deps
   ```

2. Find all files using treeselect:
   ```bash
   grep -r "vue-treeselect\|Treeselect" app/src --include="*.vue" -l
   ```

3. Update imports in each file:
   ```javascript
   // Before
   import Treeselect from '@riophae/vue-treeselect'
   import '@riophae/vue-treeselect/dist/vue-treeselect.css'

   // After
   import { TreeSelect } from '@r2rka/vue3-treeselect'
   import '@r2rka/vue3-treeselect/dist/style.css'
   ```

4. Component name in template may need update:
   ```vue
   <!-- Before -->
   <treeselect v-model="value" :options="options" />

   <!-- After -->
   <TreeSelect v-model="value" :options="options" />
   ```

5. Register component locally in each file:
   ```javascript
   export default {
     components: { TreeSelect },
     // ...
   }
   ```
  </action>
  <verify>
For each component with treeselect:
1. Open the view/component in browser
2. Click on treeselect dropdown - verify it opens
3. Select an option - verify selection is captured
4. Verify @input or @select events fire (check console or data binding)
  </verify>
  <done>
@r2rka/vue3-treeselect replaces @riophae/vue-treeselect in all 12 files. Treeselect dropdowns open, allow selection, and emit events correctly.
  </done>
</task>

<task type="auto">
  <name>Task 4: Remove perfect-scrollbar and update UpSet.js</name>
  <files>app/src/main.js, app/src/App.vue, app/src/components/analyses/AnalysesCurationUpset.vue, app/package.json</files>
  <action>
Remove vue2-perfect-scrollbar and migrate @upsetjs/vue:

**Remove vue2-perfect-scrollbar (per CONTEXT.md decision - use native):**

1. Update main.js:
   ```javascript
   // Remove
   import PerfectScrollbar from 'vue2-perfect-scrollbar'
   import 'vue2-perfect-scrollbar/dist/vue2-perfect-scrollbar.css'
   Vue.use(PerfectScrollbar)
   ```

2. Update App.vue:
   ```vue
   <!-- Before -->
   <perfect-scrollbar ref="scroll">
     <div id="content" class="content-style">
       <router-view :key="$route.fullPath" />
     </div>
   </perfect-scrollbar>

   <!-- After - use native scrollbar -->
   <div id="content" class="content-style scrollable-content">
     <router-view :key="$route.fullPath" />
   </div>

   <style>
   .scrollable-content {
     height: calc(100vh - 116px);
     overflow-y: auto;
   }
   </style>
   ```

3. Remove scrollbar-related watchers and methods from App.vue:
   - Remove `scrollbarUpdateTrigger` watcher
   - Remove `updateScrollbar` method
   - Remove refs to `scroll`

4. The UI store's `triggerScrollbarUpdate()` can be removed or kept for future use.

**Migrate @upsetjs/vue to @upsetjs/bundle (1 file):**

1. Install bundle version:
   ```bash
   npm install @upsetjs/bundle --legacy-peer-deps
   ```

2. Update AnalysesCurationUpset.vue:
   ```vue
   <template>
     <div ref="upsetContainer" class="upset-container"></div>
   </template>

   <script>
   import { ref, onMounted, watch } from 'vue'
   import { render, extractSets } from '@upsetjs/bundle'

   export default {
     props: ['elems', 'width', 'height'],
     emits: ['hover'],
     setup(props, { emit }) {
       const upsetContainer = ref(null)

       const renderChart = () => {
         if (!upsetContainer.value || !props.elems?.length) return

         const sets = extractSets(props.elems)
         render(upsetContainer.value, {
           sets,
           width: props.width || 800,
           height: props.height || 400,
           onHover: (s) => emit('hover', s),
           theme: 'vega'
         })
       }

       onMounted(renderChart)
       watch(() => props.elems, renderChart, { deep: true })

       return { upsetContainer }
     }
   }
   </script>
   ```

**Remove old Bootstrap-Vue imports from main.js:**
```javascript
// Remove all of these:
import { BootstrapVue, BootstrapVueIcons, ToastPlugin } from 'bootstrap-vue'
import 'bootstrap-vue/dist/bootstrap-vue.css'
Vue.use(BootstrapVue)
Vue.use(BootstrapVueIcons)
Vue.use(ToastPlugin)
```

**Uninstall old packages:**
```bash
npm uninstall bootstrap-vue vue-meta @riophae/vue-treeselect vue2-perfect-scrollbar @upsetjs/vue vee-validate --legacy-peer-deps
```

Note: Keep vee-validate if the new version is installed as vee-validate@4.
  </action>
  <verify>
- App scrolls correctly with native scrollbar
- UpSet.js chart renders on Analyses page (if accessible)
- No import errors for removed packages
- `npm ls bootstrap-vue` returns empty (not installed)
  </verify>
  <done>
vue2-perfect-scrollbar removed, native scrollbar in use. @upsetjs/bundle renders UpSet chart. All old packages uninstalled. No Bootstrap-Vue imports remain.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 5: Comprehensive component verification (FR-02.9)</name>
  <what-built>
Complete Bootstrap-Vue-Next migration across 50+ components including:
- Layout: Navbar, Footer, Sidebar, Cards, Containers
- Tables: TablesEntities, TablesGenes, GenericTable with sorting/pagination
- Forms: Login, Register, PasswordReset, Curate forms with validation
- Modals: Confirmation dialogs, detail modals, edit modals
- Toasts: Success/error/warning notifications
- Navigation: Tabs, Breadcrumbs, Pagination
- Inputs: Text, Select, Checkbox, Radio, Treeselect
- Visualizations: UpSet.js chart, OntologyGraph
- Misc: Badges, Alerts, Spinners, Collapse, Dropdowns
  </what-built>
  <how-to-verify>
Systematic verification checklist:

**1. Layout Components (navigate to any page)**
- [ ] Navbar renders with logo, navigation links, user menu
- [ ] Footer displays at bottom of page
- [ ] Cards render with proper shadows and borders
- [ ] Container widths are responsive

**2. Table Components (visit /entities or /genes)**
- [ ] Table renders with data rows
- [ ] Column sorting works (click header)
- [ ] Pagination controls work (next/prev/page numbers)
- [ ] Search/filter input works
- [ ] Row actions (view/edit) clickable

**3. Form Components (visit /login)**
- [ ] Email input accepts text
- [ ] Password input masks text
- [ ] Submit button clickable
- [ ] Validation errors display on invalid input
- [ ] Form submits on valid input

**4. Modal Components (trigger from table action or button)**
- [ ] Modal opens when triggered
- [ ] Modal backdrop visible
- [ ] Modal close button works
- [ ] Modal cancel/confirm buttons work
- [ ] Modal closes on ESC key

**5. Toast Components (trigger success/error action)**
- [ ] Toast appears in top-right corner
- [ ] Success toast auto-dismisses after 3 seconds
- [ ] Error toast stays until manually closed
- [ ] Toast shows correct variant color

**6. Navigation Components (click through app)**
- [ ] Tabs switch content
- [ ] Breadcrumbs show path
- [ ] Dropdowns open on click
- [ ] Pagination updates URL/content

**7. Input Components (visit /curate if accessible)**
- [ ] Treeselect opens and allows selection
- [ ] Checkbox toggles
- [ ] Radio buttons switch
- [ ] Select dropdowns work
- [ ] Textarea expands

**8. Visualization Components (visit /analyses if accessible)**
- [ ] UpSet.js chart renders with data
- [ ] Chart hover shows tooltips

**9. Miscellaneous**
- [ ] Badges display with colors
- [ ] Alerts render (if any on pages)
- [ ] Spinners animate during loading
- [ ] Collapse/accordion expands/collapses

**Console check:**
- [ ] No "Unknown component" warnings
- [ ] No "Cannot read property of undefined" errors
- [ ] No Vue warnings about props or events
  </how-to-verify>
  <resume-signal>Type "verified" if all component types render correctly, or describe specific failures that need fixing</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:

1. Package verification:
   ```bash
   cd app
   # Should NOT be installed:
   npm ls bootstrap-vue 2>&1 | grep -i "empty\|not\|missing"
   npm ls vue-meta 2>&1 | grep -i "empty\|not\|missing"
   npm ls @riophae/vue-treeselect 2>&1 | grep -i "empty\|not\|missing"
   npm ls vue2-perfect-scrollbar 2>&1 | grep -i "empty\|not\|missing"

   # Should BE installed:
   npm ls bootstrap-vue-next
   npm ls @unhead/vue
   npm ls vee-validate
   npm ls @r2rka/vue3-treeselect
   npm ls @upsetjs/bundle
   ```

2. Functionality verification:
   - Page titles change on navigation
   - Login form validates (try empty email, invalid format)
   - Treeselect dropdowns work in filter/search components
   - App content scrolls (native scrollbar)
   - UpSet chart renders on curation analysis page

3. Code verification:
   ```bash
   # No old imports remaining
   grep -r "bootstrap-vue[^-]" app/src --include="*.js" --include="*.vue" | grep -v "bootstrap-vue-next" | wc -l  # 0
   grep -r "vue-meta" app/src --include="*.js" --include="*.vue" | wc -l  # 0
   grep -r "@riophae/vue-treeselect" app/src --include="*.vue" | wc -l  # 0
   grep -r "vue2-perfect-scrollbar" app/src --include="*.js" | wc -l  # 0
   grep -r "@upsetjs/vue" app/src --include="*.vue" | wc -l  # 0
   ```

4. Console check:
   - No module resolution errors
   - No "Cannot find module" errors
   - App runs cleanly
</verification>

<success_criteria>
- @unhead/vue installed, configured, all 23 metaInfo usages migrated to useHead()
- vee-validate 4 installed, Login/Register/PasswordReset use Composition API validation
- @r2rka/vue3-treeselect replaces @riophae/vue-treeselect in all 12 files
- vue2-perfect-scrollbar removed, App.vue uses native scrollbar
- @upsetjs/bundle replaces @upsetjs/vue in AnalysesCurationUpset.vue
- All old Bootstrap-Vue imports removed from main.js
- Old packages uninstalled from package.json
- No import errors, app runs successfully
- All 50+ component types verified rendering correctly (FR-02.9)
</success_criteria>

<output>
After completion, create `.planning/phases/11-bootstrap-vue-next/11-06-SUMMARY.md`
</output>
