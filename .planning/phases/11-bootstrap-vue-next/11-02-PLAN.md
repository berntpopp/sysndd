---
phase: 11-bootstrap-vue-next
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - app/src/assets/js/mixins/toastMixin.js
  - app/src/components/analyses/AnalysesCurationUpset.vue
  - app/src/components/analyses/AnalysesOntologyGraph.vue
  - app/src/components/analyses/AnalysesPhenotypeClusters.vue
  - app/src/components/tables/TablesEntities.vue
  - app/src/components/tables/TablesGenes.vue
  - app/src/components/small/GenericTable.vue
  - app/src/views/curate/Curate.vue
  - app/src/views/review/Review.vue
  - app/src/views/review/ReviewDetail.vue
autonomous: true

must_haves:
  truths:
    - "Toast notifications appear in top-right position"
    - "Success/info toasts auto-dismiss after 3 seconds"
    - "Error toasts require manual close"
    - "Modals can be shown and hidden programmatically"
    - "No $bvToast or $bvModal usage remains"
    - "No $root.$emit('bv::show::modal') patterns remain"
  artifacts:
    - path: "app/src/assets/js/mixins/toastMixin.js"
      provides: "Updated mixin using useToastNotifications composable"
      contains: "useToastNotifications"
    - path: "app/src/components/tables/TablesEntities.vue"
      provides: "Example of migrated modal pattern"
      contains: "useModalControls"
  key_links:
    - from: "toastMixin.js"
      to: "useToastNotifications"
      via: "composable import"
      pattern: "import.*useToastNotifications"
    - from: "components using modals"
      to: "useModalControls"
      via: "composable import"
      pattern: "useModalControls"
    - from: "modal trigger buttons"
      to: "showModal/hideModal calls"
      via: "composable method invocation"
      pattern: "showModal\\(|hideModal\\("
---

<objective>
Migrate all modal and toast patterns from Bootstrap-Vue to Bootstrap-Vue-Next

Purpose: Replace deprecated $bvToast.toast(), $bvModal.show(), and $root.$emit('bv::show::modal') patterns with the new composable-based API. This is critical because Vue 3 removed the instance event system that Bootstrap-Vue relied on.

Output:
- toastMixin updated to use useToastNotifications composable
- All 15 $root.$emit modal patterns replaced
- All modal show/hide calls using new composable or v-model
- Toast notifications working with correct positioning and auto-dismiss behavior
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-bootstrap-vue-next/11-CONTEXT.md
@.planning/phases/11-bootstrap-vue-next/11-RESEARCH.md
@.planning/phases/11-bootstrap-vue-next/11-01-SUMMARY.md
@app/src/assets/js/mixins/toastMixin.js
@app/src/composables/useToastNotifications.js
@app/src/composables/useModalControls.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update toastMixin to use useToastNotifications composable</name>
  <files>app/src/assets/js/mixins/toastMixin.js</files>
  <action>
Update toastMixin.js to delegate to the new composable while maintaining backward compatibility:

1. Import the composable:
   ```javascript
   import { useToastNotifications } from '@/composables/useToastNotifications'
   ```

2. In the mixin's methods, delegate to the composable:
   ```javascript
   export default {
     methods: {
       makeToast(message, title = null, variant = null, autoHide = true, autoHideDelay = 3000) {
         const { makeToast: showToast } = useToastNotifications()

         // For error toasts (danger variant), disable auto-hide per CONTEXT.md requirements
         const shouldAutoHide = variant === 'danger' ? false : autoHide

         showToast(message, title, variant, shouldAutoHide, autoHideDelay)
       },
     },
   }
   ```

3. Ensure the makeToast signature matches existing usage throughout codebase:
   - message: string or object with message property
   - title: optional string
   - variant: 'success', 'danger', 'warning', 'info'
   - autoHide: boolean (but OVERRIDE to false for 'danger' per context decision)
   - autoHideDelay: number in ms (default 3000)

This approach keeps the mixin API stable while all components continue to work via `this.makeToast()`.
  </action>
  <verify>
Grep for makeToast usage to ensure API compatibility:
`grep -r "makeToast" app/src --include="*.vue" | head -20`

Run app and trigger a toast (e.g., failed login) to verify it appears correctly.
  </verify>
  <done>
toastMixin delegates to useToastNotifications composable. All existing makeToast() calls continue to work. Error toasts no longer auto-dismiss.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace $root.$emit modal patterns with useModalControls</name>
  <files>Multiple Vue files (see action for list)</files>
  <action>
Find and replace all $root.$emit('bv::show::modal') and $root.$emit('bv::hide::modal') patterns.

Research identified 15 instances. For each file with this pattern:

1. Import the composable in setup or at component level:
   ```javascript
   import { useModalControls } from '@/composables/useModalControls'
   ```

2. In methods, get the composable and call it:
   ```javascript
   // Before:
   this.$root.$emit('bv::show::modal', 'modal-id')

   // After (in Options API component):
   const { showModal } = useModalControls()
   showModal('modal-id')
   ```

3. For hiding:
   ```javascript
   // Before:
   this.$root.$emit('bv::hide::modal', 'modal-id')

   // After:
   const { hideModal } = useModalControls()
   hideModal('modal-id')
   ```

4. **CRITICAL: For each modal trigger point (button clicks, table row actions, form submissions), explicitly:**
   - Import `useModalControls` at the top of the script section
   - In the method that triggers the modal (e.g., `openDetailModal`, `showConfirmDialog`, `onRowClick`):
     - Call `const { showModal } = useModalControls()` or destructure once at component level
     - Replace the event emit with `showModal('modal-id-here')`
   - Verify the modal ID matches the `id` prop on the corresponding `<BModal>` component

   Example modal trigger points to check:
   - Table row action buttons (view, edit, delete)
   - "Add new" buttons that open creation modals
   - Confirmation dialogs before destructive actions
   - Detail/preview modals from list views

Files to check (run `grep -r "\\$root.\\$emit.*modal" app/src --include="*.vue" -l` to confirm):
- Components in views/curate/
- Components in views/review/
- Components in components/tables/
- Components in components/analyses/

Alternative: For simple modal show/hide, consider using v-model on BModal directly:
```vue
<BModal v-model="isModalVisible">...</BModal>

<script>
const isModalVisible = ref(false)
const openModal = () => { isModalVisible.value = true }
</script>
```
  </action>
  <verify>
1. Run `grep -r "\\$root.\\$emit" app/src --include="*.vue"` - should return 0 results related to modals.

2. For each component with modals, verify the wiring:
   - Check that `useModalControls` is imported
   - Check that `showModal('id')` or `hideModal('id')` is called in the trigger method
   - Check that the modal ID in the call matches the `<BModal id="...">` in the template

3. Test modal functionality in Curate and Review views if accessible - click trigger buttons and verify modals open.
  </verify>
  <done>
All $root.$emit('bv::show::modal') and $root.$emit('bv::hide::modal') patterns replaced. Each modal trigger point (button, action) imports useModalControls and calls showModal/hideModal. Modals open and close correctly using composable or v-model.
  </done>
</task>

<task type="auto">
  <name>Task 3: Replace $bvModal and $bvToast direct calls</name>
  <files>Multiple Vue files</files>
  <action>
Find and replace any remaining direct $bvModal and $bvToast usage:

1. Search for $bvModal:
   `grep -r "\\$bvModal" app/src --include="*.vue" -l`

   Replace patterns:
   ```javascript
   // Before:
   this.$bvModal.show('modal-id')
   this.$bvModal.hide('modal-id')
   this.$bvModal.msgBoxConfirm('message')

   // After:
   import { useModalControls } from '@/composables/useModalControls'
   const { showModal, hideModal, confirm } = useModalControls()

   showModal('modal-id')
   hideModal('modal-id')
   const result = await confirm({ body: 'message' })
   ```

2. Search for $bvToast:
   `grep -r "\\$bvToast" app/src --include="*.vue" -l`

   Most toast usage should go through toastMixin.makeToast(), but if any direct $bvToast.toast() exists:
   ```javascript
   // Before:
   this.$bvToast.toast('message', { title: 'Title', variant: 'success' })

   // After:
   this.makeToast('message', 'Title', 'success')
   // or import composable directly if not using mixin
   ```

3. Update any components still using Bootstrap-Vue's b-toast or b-modal events:
   - @ok, @cancel, @hidden events should still work on BModal
   - v-model replaces :visible.sync
  </action>
  <verify>
Run:
- `grep -r "\\$bvModal" app/src --include="*.vue"` - should return 0 results
- `grep -r "\\$bvToast" app/src --include="*.vue"` - should return 0 results
- App runs without "Cannot read property 'show' of undefined" errors
  </verify>
  <done>
All $bvModal and $bvToast direct calls replaced. Components use composables or mixin for toast/modal operations.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Modal verification:
   - Open a view that uses modals (Review, Curate)
   - Verify modals open when triggered
   - Verify modals close when clicking close/cancel
   - Verify modal events still fire (if applicable)

2. Toast verification:
   - Trigger a success action (if available) - toast appears top-right, auto-dismisses after 3s
   - Trigger an error (e.g., bad API call) - toast appears top-right, does NOT auto-dismiss
   - Toast can be manually closed via X button

3. Code verification:
   ```bash
   # No old patterns remaining
   grep -r "\\$root.\\$emit.*modal" app/src --include="*.vue" | wc -l  # Should be 0
   grep -r "\\$bvModal" app/src --include="*.vue" | wc -l              # Should be 0
   grep -r "\\$bvToast" app/src --include="*.vue" | wc -l              # Should be 0
   ```
</verification>

<success_criteria>
- toastMixin updated to use useToastNotifications composable
- All 15 $root.$emit modal patterns replaced with useModalControls
- All $bvModal and $bvToast direct calls removed
- Toasts positioned top-right with correct auto-dismiss behavior (3s for success, manual for errors)
- Modals open and close correctly throughout the application
</success_criteria>

<output>
After completion, create `.planning/phases/11-bootstrap-vue-next/11-02-SUMMARY.md`
</output>
