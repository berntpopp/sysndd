---
phase: 11-bootstrap-vue-next
plan: 03
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - app/src/components/small/GenericTable.vue
  - app/src/components/tables/TablesEntities.vue
  - app/src/components/tables/TablesGenes.vue
  - app/src/components/tables/TablesPhenotypes.vue
  - app/src/components/tables/TablesLogs.vue
  - app/src/assets/js/mixins/tableMethodsMixin.js
  - app/src/assets/js/mixins/tableDataMixin.js
autonomous: true

must_haves:
  truths:
    - "Tables render with data from API"
    - "Sorting works (click column header to sort)"
    - "Pagination works (navigate between pages)"
    - "Filtering works (search filters results)"
    - "Row selection works where implemented"
    - "No :sort-by.sync or :sort-desc.sync remain"
  artifacts:
    - path: "app/src/components/small/GenericTable.vue"
      provides: "Migrated BTable component with new sorting API"
      contains: "v-model:sort-by"
    - path: "app/src/assets/js/mixins/tableMethodsMixin.js"
      provides: "Updated sort handling for array-based sortBy"
      contains: "sortBy"
    - path: "app/src/assets/js/mixins/tableDataMixin.js"
      provides: "Updated table state with array-based sortBy"
      contains: "sortBy"
  key_links:
    - from: "GenericTable.vue"
      to: "BTable"
      via: "v-model:sort-by binding"
      pattern: "v-model:sort-by"
    - from: "tableMethodsMixin.js"
      to: "API calls"
      via: "sort parameter extraction"
      pattern: "sortBy\\[0\\]"
---

<objective>
Migrate all b-table components to Bootstrap-Vue-Next BTable API

Purpose: Bootstrap-Vue-Next tables have significant API changes - sortBy is now an array of objects instead of a string, .sync modifiers become v-model:, and filter-included-fields is removed. This plan updates all table components to use the new API.

Output:
- All tables using v-model:sort-by with array format
- tableMethodsMixin and tableDataMixin updated for new sort model
- filter-included-fields props removed or handled externally
- Sorting, filtering, and pagination functional across all tables
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-bootstrap-vue-next/11-CONTEXT.md
@.planning/phases/11-bootstrap-vue-next/11-RESEARCH.md
@.planning/phases/11-bootstrap-vue-next/11-01-SUMMARY.md
@app/src/components/small/GenericTable.vue
@app/src/assets/js/mixins/tableMethodsMixin.js
@app/src/assets/js/mixins/tableDataMixin.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update tableDataMixin for array-based sortBy</name>
  <files>app/src/assets/js/mixins/tableDataMixin.js</files>
  <action>
Update tableDataMixin.js to use the new array-based sortBy format:

1. Change sortBy from string to array:
   ```javascript
   // Before:
   data() {
     return {
       sortBy: 'entity_id',
       sortDesc: false,
       // ...
     }
   }

   // After:
   data() {
     return {
       sortBy: [{ key: 'entity_id', order: 'asc' }],
       // sortDesc is now part of sortBy array
       // ...
     }
   }
   ```

2. If sortDesc is used separately, it should be derived from sortBy:
   ```javascript
   computed: {
     sortDesc() {
       return this.sortBy.length > 0 && this.sortBy[0].order === 'desc'
     },
     sortColumn() {
       return this.sortBy.length > 0 ? this.sortBy[0].key : ''
     },
   }
   ```

3. Update any methods that set sorting:
   ```javascript
   // Before:
   this.sortBy = 'column_name'
   this.sortDesc = true

   // After:
   this.sortBy = [{ key: 'column_name', order: 'desc' }]
   ```

Maintain backward compatibility with existing component usage where possible.
  </action>
  <verify>
Check that components using tableDataMixin still have access to sort state.
Run `grep -r "sortDesc" app/src --include="*.vue" --include="*.js"` to identify all usages.
  </verify>
  <done>
tableDataMixin uses array-based sortBy. sortDesc computed property derived from sortBy for backward compatibility.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update tableMethodsMixin for new sort events</name>
  <files>app/src/assets/js/mixins/tableMethodsMixin.js</files>
  <action>
Update tableMethodsMixin.js to handle new sort event format:

1. Update sort change handler:
   ```javascript
   // Before (if handling @sort-changed):
   handleSortChanged({ sortBy, sortDesc }) {
     this.sortBy = sortBy
     this.sortDesc = sortDesc
     this.loadData()
   }

   // After (for @update:sort-by):
   handleSortByUpdate(newSortBy) {
     // newSortBy is array: [{ key: 'column', order: 'asc'|'desc' }]
     this.sortBy = newSortBy
     this.loadData()
   }
   ```

2. Update loadData to extract sort parameters from array:
   ```javascript
   loadData() {
     const sortColumn = this.sortBy.length > 0 ? this.sortBy[0].key : 'entity_id'
     const sortOrder = this.sortBy.length > 0 ? this.sortBy[0].order : 'asc'

     // Use sortColumn and sortOrder in API call
     const params = {
       sort: sortOrder === 'desc' ? `-${sortColumn}` : sortColumn,
       // ... other params
     }
   }
   ```

3. If mixin has handleSortByOrDescChange or similar, update to new format.

4. Ensure pagination reset on sort change still works.
  </action>
  <verify>
Trace through a table sort operation to ensure API call includes correct sort parameter.
  </verify>
  <done>
tableMethodsMixin handles array-based sortBy. Sort change triggers data reload with correct sort parameter.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update GenericTable and table components</name>
  <files>app/src/components/small/GenericTable.vue, app/src/components/tables/*.vue</files>
  <action>
Update GenericTable.vue and other table components for Bootstrap-Vue-Next BTable:

1. Replace .sync modifiers with v-model:
   ```vue
   <!-- Before -->
   <b-table
     :sort-by.sync="sortBy"
     :sort-desc.sync="sortDesc"
     @sort-changed="handleSortChanged"
   />

   <!-- After -->
   <BTable
     v-model:sort-by="sortBy"
     @update:sort-by="handleSortByUpdate"
   />
   ```

2. Remove filter-included-fields (8 tables affected per research):
   ```vue
   <!-- Before -->
   <b-table
     :filter="filter"
     :filter-included-fields="['entity_id', 'gene_symbol']"
   />

   <!-- After - use field-level filterable or external filtering -->
   <BTable
     :filter="filter"
   />
   ```

   For field-level filtering, add `filterable: true` to field definitions:
   ```javascript
   fields: [
     { key: 'entity_id', sortable: true, filterable: true },
     { key: 'gene_symbol', sortable: true, filterable: true },
     { key: 'actions', sortable: false, filterable: false },
   ]
   ```

3. Update per-page binding if using .sync:
   ```vue
   <!-- Before -->
   <b-table :per-page.sync="perPage" />

   <!-- After -->
   <BTable v-model:per-page="perPage" />
   ```

4. Update current-page binding:
   ```vue
   <!-- Before -->
   <b-table :current-page.sync="currentPage" />

   <!-- After -->
   <BTable v-model:current-page="currentPage" />
   ```

5. Check each table component in components/tables/:
   - TablesEntities.vue
   - TablesGenes.vue
   - TablesPhenotypes.vue
   - TablesLogs.vue
  </action>
  <verify>
Run `grep -r "\\.sync" app/src --include="*.vue"` to find remaining .sync usages.
Test each table view: sorting, filtering, pagination should all work.
  </verify>
  <done>
All table components migrated to BTable with v-model:sort-by. No .sync modifiers on table props. Sorting, filtering, pagination functional.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Table functionality verification:
   - Navigate to Entities table - verify data loads
   - Click column header to sort - verify sort indicator changes and data reorders
   - Click again to reverse sort - verify desc sorting works
   - Type in filter/search - verify results filter
   - Navigate pagination - verify page changes work
   - Verify row selection (if applicable)

2. Code verification:
   ```bash
   # No .sync modifiers on table props
   grep -r ":sort-by.sync\|:sort-desc.sync\|:per-page.sync\|:current-page.sync" app/src --include="*.vue" | wc -l  # Should be 0

   # No filter-included-fields (deprecated)
   grep -r "filter-included-fields" app/src --include="*.vue" | wc -l  # Should be 0

   # sortBy is array format in mixins
   grep -r "sortBy:" app/src/assets/js/mixins/ | head -5  # Should show array initialization
   ```

3. Console check:
   - No "sortBy should be an array" warnings
   - No "Unknown prop: filter-included-fields" warnings
</verification>

<success_criteria>
- tableDataMixin uses array-based sortBy: `[{ key: 'column', order: 'asc' }]`
- tableMethodsMixin handles @update:sort-by event correctly
- All table components use v-model:sort-by instead of :sort-by.sync
- filter-included-fields removed from all tables
- Sorting, filtering, and pagination work in all table views
- No .sync modifier usage on table bindings
</success_criteria>

<output>
After completion, create `.planning/phases/11-bootstrap-vue-next/11-03-SUMMARY.md`
</output>
