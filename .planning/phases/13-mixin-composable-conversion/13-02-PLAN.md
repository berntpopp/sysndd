---
phase: 13-mixin-composable-conversion
plan: 02
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - app/src/composables/useToast.js
  - app/src/composables/index.js
  - app/src/components/analyses/AnalysesPhenotypeFunctionalCorrelation.vue
  - app/src/components/analyses/AnalysesVariantCounts.vue
  - app/src/components/analyses/AnalysesTimePlot.vue
  - app/src/components/analyses/PubtatorNDDStats.vue
  - app/src/components/analyses/PublicationsNDDStats.vue
  - app/src/components/analyses/AnalysesVariantCorrelogram.vue
  - app/src/components/analyses/AnalysesCurationUpset.vue
  - app/src/components/analyses/PublicationsNDDTimePlot.vue
  - app/src/components/analyses/AnalysesCurationMatrixPlot.vue
  - app/src/components/analyses/AnalysesPhenotypeCorrelogram.vue
  - app/src/components/analyses/AnalysesPhenotypeCounts.vue
  - app/src/components/analyses/AnalysesPhenotypeClusters.vue
  - app/src/components/small/LogoutCountdownBadge.vue
  - app/src/components/small/IconPairDropdownMenu.vue
  - app/src/components/HelperBadge.vue
  - app/src/components/Navbar.vue
  - app/src/views/PasswordReset.vue
  - app/src/views/Login.vue
  - app/src/views/Register.vue
  - app/src/views/analyses/VariantCorrelations.vue
  - app/src/views/analyses/PhenotypeCorrelations.vue
  - app/src/views/analyses/GeneNetworks.vue
  - app/src/views/analyses/EntriesOverTime.vue
  - app/src/views/analyses/CurationComparisons.vue
  - app/src/views/analyses/PhenotypeFunctionalCorrelation.vue
  - app/src/views/pages/Search.vue
  - app/src/views/admin/ManageOntology.vue
  - app/src/views/admin/ManageAnnotations.vue
  - app/src/views/admin/AdminStatistics.vue
  - app/src/views/admin/ManageUser.vue
  - app/src/views/curate/ManageReReview.vue
autonomous: true

must_haves:
  truths:
    - "useToast provides makeToast function matching toastMixin signature"
    - "Error toasts (danger variant) disable auto-hide per medical app requirement"
    - "Components using only toastMixin work without mixin import"
  artifacts:
    - path: "app/src/composables/useToast.js"
      provides: "Toast notification wrapper with medical app error handling"
      exports: ["useToast"]
    - path: "app/src/composables/index.js"
      provides: "Updated barrel export including useToast"
      contains: "export { default as useToast }"
  key_links:
    - from: "app/src/composables/useToast.js"
      to: "bootstrap-vue-next useToast"
      via: "import and delegation"
      pattern: "import.*useToast.*from.*bootstrap-vue-next"
    - from: "components using makeToast"
      to: "useToast composable"
      via: "setup() destructuring"
      pattern: "const \\{ makeToast \\} = useToast"
---

<objective>
Create useToast composable and update all toast-only components to use it.

Purpose: Convert the most widely-used mixin (toastMixin, 52+ components) by creating a composable that wraps Bootstrap-Vue-Next's useToast while maintaining the makeToast() API and medical app error handling (danger toasts don't auto-hide).

Output: useToast composable and ~30 updated components that ONLY use toastMixin (no other mixins)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-mixin-composable-conversion/13-CONTEXT.md
@.planning/phases/13-mixin-composable-conversion/13-RESEARCH.md

# Source mixin to convert
@app/src/assets/js/mixins/toastMixin.js

# Prior plan summary
@.planning/phases/13-mixin-composable-conversion/13-01-SUMMARY.md

# Reference existing useToastNotifications pattern
@app/src/composables/useToastNotifications.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useToast composable</name>
  <files>app/src/composables/useToast.js, app/src/composables/index.js</files>
  <action>
1. Create useToast.js composable with medical app error handling:

```javascript
import { useToast as useBootstrapToast } from 'bootstrap-vue-next';

/**
 * Composable for toast notifications with medical app error handling.
 * Error toasts (danger variant) force manual close to ensure critical messages are seen.
 * @returns {Object} Toast notification methods
 */
export default function useToast() {
  const toast = useBootstrapToast();

  /**
   * Show a toast notification
   * @param {string|object} message - Message to display (or object with message property)
   * @param {string|null} title - Toast title
   * @param {string|null} variant - Bootstrap variant (success, danger, warning, info)
   * @param {boolean} autoHide - Whether to auto-dismiss (default: true, but false for danger)
   * @param {number} autoHideDelay - Delay in ms before auto-hide (default: 3000)
   */
  const makeToast = (message, title = null, variant = null, autoHide = true, autoHideDelay = 3000) => {
    const body = typeof message === 'object' && message.message ? message.message : message;

    // For error toasts (danger variant), disable auto-hide per medical app requirements
    // This ensures users don't miss important error messages
    const shouldAutoHide = variant === 'danger' ? false : autoHide;

    toast.create({
      title,
      body,
      variant,
      pos: 'top-end',
      modelValue: shouldAutoHide ? autoHideDelay : 0, // 0 means no auto-hide
    });
  };

  return { makeToast };
}
```

2. Update index.js to include useToast export:
```javascript
export { default as useToast } from './useToast';
```

Note: useToast is DIFFERENT from useToastNotifications:
- useToast includes medical app error handling (danger doesn't auto-hide)
- useToastNotifications is the raw wrapper without special handling
- Components should migrate to useToast for consistency
  </action>
  <verify>
- useToast.js exists with makeToast function
- index.js exports useToast
- Signature matches: makeToast(message, title, variant, autoHide, autoHideDelay)
  </verify>
  <done>useToast composable created with medical app error handling, exported from index.js</done>
</task>

<task type="auto">
  <name>Task 2: Update toast-only components (batch 1)</name>
  <files>
app/src/components/analyses/AnalysesPhenotypeFunctionalCorrelation.vue
app/src/components/analyses/AnalysesVariantCounts.vue
app/src/components/analyses/AnalysesTimePlot.vue
app/src/components/analyses/PubtatorNDDStats.vue
app/src/components/analyses/PublicationsNDDStats.vue
app/src/components/analyses/AnalysesVariantCorrelogram.vue
app/src/components/analyses/AnalysesCurationUpset.vue
app/src/components/analyses/PublicationsNDDTimePlot.vue
app/src/components/analyses/AnalysesCurationMatrixPlot.vue
app/src/components/analyses/AnalysesPhenotypeCorrelogram.vue
app/src/components/analyses/AnalysesPhenotypeCounts.vue
app/src/components/analyses/AnalysesPhenotypeClusters.vue
  </files>
  <action>
For each component that ONLY uses toastMixin (no other mixins):

1. Remove toastMixin import and mixins array
2. Import useToast from composables
3. Add setup() function (or extend existing) with composable usage
4. Return makeToast from setup for template/methods access

Pattern for Options API component:
```javascript
// REMOVE:
import toastMixin from '@/assets/js/mixins/toastMixin';
// REMOVE: mixins: [toastMixin],

// ADD:
import useToast from '@/composables/useToast';

export default {
  // ... other options
  setup() {
    const { makeToast } = useToast();
    return { makeToast };
  },
  // methods can still use this.makeToast
};
```

Components in this batch (analyses components using only toastMixin):
- AnalysesPhenotypeFunctionalCorrelation.vue
- AnalysesVariantCounts.vue
- AnalysesTimePlot.vue (also uses textMixin - skip for now, will be handled later)
- PubtatorNDDStats.vue
- PublicationsNDDStats.vue
- AnalysesVariantCorrelogram.vue
- AnalysesCurationUpset.vue
- PublicationsNDDTimePlot.vue (also uses textMixin - skip for now)
- AnalysesCurationMatrixPlot.vue
- AnalysesPhenotypeCorrelogram.vue
- AnalysesPhenotypeCounts.vue
- AnalysesPhenotypeClusters.vue

Note: Skip components that use multiple mixins (textMixin, colorAndSymbolsMixin) - those will be updated when ALL their mixins are converted.
  </action>
  <verify>
For each updated component:
- No toastMixin import
- No mixins: [toastMixin] array
- Has setup() with useToast destructuring
- makeToast returned from setup
  </verify>
  <done>Analysis components using only toastMixin updated to use useToast composable</done>
</task>

<task type="auto">
  <name>Task 3: Update toast-only components (batch 2 - views and small components)</name>
  <files>
app/src/components/small/LogoutCountdownBadge.vue
app/src/components/small/IconPairDropdownMenu.vue
app/src/components/HelperBadge.vue
app/src/components/Navbar.vue
app/src/views/PasswordReset.vue
app/src/views/Login.vue
app/src/views/Register.vue
app/src/views/analyses/VariantCorrelations.vue
app/src/views/analyses/PhenotypeCorrelations.vue
app/src/views/analyses/GeneNetworks.vue
app/src/views/analyses/EntriesOverTime.vue
app/src/views/analyses/CurationComparisons.vue
app/src/views/analyses/PhenotypeFunctionalCorrelation.vue
app/src/views/pages/Search.vue
app/src/views/admin/ManageOntology.vue
app/src/views/admin/ManageAnnotations.vue
app/src/views/admin/AdminStatistics.vue
app/src/views/admin/ManageUser.vue
app/src/views/curate/ManageReReview.vue
  </files>
  <action>
Continue updating components that ONLY use toastMixin:

Same pattern as Task 2:
1. Remove toastMixin import and mixins array
2. Import useToast from composables
3. Add setup() with composable usage
4. Return makeToast from setup

Components in this batch (views and small components using only toastMixin):
- LogoutCountdownBadge.vue
- IconPairDropdownMenu.vue
- HelperBadge.vue
- Navbar.vue
- PasswordReset.vue
- Login.vue
- Register.vue
- VariantCorrelations.vue
- PhenotypeCorrelations.vue
- GeneNetworks.vue
- EntriesOverTime.vue
- CurationComparisons.vue
- PhenotypeFunctionalCorrelation.vue
- Search.vue
- ManageOntology.vue
- ManageAnnotations.vue
- AdminStatistics.vue
- ManageUser.vue
- ManageReReview.vue

Verify each component only uses toastMixin before updating. If a component uses additional mixins (colorAndSymbolsMixin, textMixin, etc.), skip it for now - it will be updated in a later plan when all its mixins are converted.
  </action>
  <verify>
For each updated component:
- No toastMixin import
- No mixins array with toastMixin
- Has setup() returning { makeToast }
- Build succeeds: `cd app && npm run build`
  </verify>
  <done>All toast-only components migrated to useToast composable</done>
</task>

</tasks>

<verification>
1. useToast.js exists and is exported from index.js

2. All toast-only components updated:
   - No toastMixin imports remain in components that ONLY used toastMixin
   - Components with multiple mixins still have their mixin imports

3. Build succeeds: `cd app && npm run build`

4. Functional test:
   - Start dev server: `cd app && npm run serve`
   - Navigate to Login page
   - Enter invalid credentials
   - Verify toast notification appears
   - Error toast should NOT auto-hide (danger variant handling)
</verification>

<success_criteria>
- useToast composable created with makeToast function
- Medical app error handling preserved (danger toasts don't auto-hide)
- All ~30 toast-only components migrated
- Build succeeds with no errors
- Toast notifications work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/13-mixin-composable-conversion/13-02-SUMMARY.md`
</output>
