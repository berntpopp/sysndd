---
phase: 04-makefile-automation
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - Makefile
autonomous: true

must_haves:
  truths:
    - "Running `make test-api` executes R API tests with testthat"
    - "Running `make lint-api` checks R code with lintr"
    - "Running `make lint-app` checks frontend code with ESLint"
    - "Running `make format-api` formats R code with styler"
    - "Running `make pre-commit` runs lint and test checks sequentially"
  artifacts:
    - path: "Makefile"
      provides: "Complete development automation with testing and quality targets"
      min_lines: 150
      contains: "pre-commit"
  key_links:
    - from: "Makefile:test-api"
      to: "api/tests/testthat/"
      via: "testthat::test_dir"
      pattern: "testthat::test_dir"
    - from: "Makefile:lint-api"
      to: "api/scripts/lint-check.R"
      via: "Rscript"
      pattern: "lint-check.R"
    - from: "Makefile:lint-app"
      to: "app/package.json"
      via: "npm run lint"
      pattern: "npm run lint"
---

<objective>
Add testing and code quality targets to complete the Makefile automation.

Purpose: Enable consistent testing and code quality enforcement across the codebase.
Output: Complete Makefile with test-api, lint-api, lint-app, format-api, format-app, and pre-commit targets.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-makefile-automation/04-CONTEXT.md
@.planning/phases/04-makefile-automation/04-RESEARCH.md
@.planning/phases/04-makefile-automation/04-01-SUMMARY.md
@api/scripts/lint-check.R
@api/scripts/style-code.R
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add testing and linting targets</name>
  <files>Makefile</files>
  <action>
Add the following targets to the existing Makefile:

**Testing targets (Testing section in help):**
- `test-api` - Run R API tests
  - Check R prerequisite
  - Run `cd api && Rscript -e "testthat::test_dir('tests/testthat')"`
  - Colorized success/failure messages
  - Note: testthat prints its own results; append status message after

**Linting targets (Linting section in help):**
- `lint-api` - Check R code with lintr
  - Check R prerequisite
  - Run existing `api/scripts/lint-check.R`
  - Success/failure status
- `lint-app` - Check frontend code with ESLint
  - Check npm prerequisite
  - Run `cd app && npm run lint`
  - Note: npm run lint already produces output

**Formatting targets (Linting section in help):**
- `format-api` - Format R code with styler
  - Check R prerequisite
  - Run existing `api/scripts/style-code.R`
- `format-app` - Format frontend code (Vue CLI lint with --fix)
  - Check npm prerequisite
  - Run `cd app && npm run lint -- --fix`
  - Note: Vue CLI's lint command with --fix auto-formats

Update .PHONY declaration to include all new targets.

Group help output into sections:
- Development: install-api, install-app, dev
- Testing: test-api
- Linting: lint-api, lint-app, format-api, format-app
- Docker: docker-build, docker-up, docker-down
  </action>
  <verify>
1. `make test-api` runs testthat tests
2. `make lint-api` runs lintr via lint-check.R
3. `make lint-app` runs ESLint via npm run lint
4. `make format-api` runs styler via style-code.R
5. `make help` shows new targets organized by section
  </verify>
  <done>
All testing and linting targets work correctly with appropriate output
  </done>
</task>

<task type="auto">
  <name>Task 2: Add pre-commit target and finalize help grouping</name>
  <files>Makefile</files>
  <action>
Add pre-commit workflow target:

**Pre-commit target (Quality section in help):**
- `pre-commit` - Run all quality checks before committing
  - Run targets in sequence: lint-api, lint-app, test-api
  - Use `$(MAKE)` to invoke sub-targets (proper Make recursion)
  - Print overall success message at end
  - Fail fast on any failure (default Make behavior)

Note: test-app is omitted because frontend has no test command (only lint).

Update the help target to display grouped output:
- Print "SysNDD Development Commands" header
- Print section headers: "Development:", "Testing:", "Linting:", "Docker:", "Quality:"
- Use grep filters to extract targets by pattern for each section
- Keep targets sorted within each section

Example help target implementation pattern from research:
```makefile
help:
	@echo "SysNDD Development Commands"
	@echo ""
	@echo "Development:"
	@grep -E '^(install|dev)-?[a-z]*:.*?## ' $(MAKEFILE_LIST) | awk ...
```

The exact implementation is at Claude's discretion per CONTEXT.md.
  </action>
  <verify>
1. `make pre-commit` runs lint-api, lint-app, test-api in sequence
2. `make pre-commit` fails if any check fails
3. `make help` shows grouped output with section headers
  </verify>
  <done>
pre-commit target chains all quality checks; help output is cleanly grouped by section
  </done>
</task>

</tasks>

<verification>
- [ ] `make test-api` runs testthat tests
- [ ] `make lint-api` checks R code style
- [ ] `make lint-app` checks frontend code style
- [ ] `make format-api` formats R code
- [ ] `make format-app` formats frontend code
- [ ] `make pre-commit` runs all quality checks in sequence
- [ ] `make help` shows targets grouped by section
- [ ] All targets have `##` description comments
- [ ] Colorized success/failure messages on all targets
</verification>

<success_criteria>
Running `make pre-commit` executes lint-api, lint-app, and test-api sequentially. Running `make help` displays all targets organized into Development, Testing, Linting, Docker, and Quality sections.
</success_criteria>

<output>
After completion, create `.planning/phases/04-makefile-automation/04-02-SUMMARY.md`
</output>
