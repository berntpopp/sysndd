---
phase: 10-vue3-core-migration
plan: 05
type: execute
wave: 2
depends_on: ["10-02"]
files_modified:
  - app/src/views/User.vue
  - app/src/components/small/LogoutCountdownBadge.vue
autonomous: true

must_haves:
  truths:
    - "No beforeDestroy or destroyed lifecycle hooks in codebase"
    - "Timer cleanup works correctly (no memory leaks)"
    - "User page and countdown badge function correctly"
  artifacts:
    - path: "app/src/views/User.vue"
      provides: "User profile view with correct lifecycle hooks"
      contains: "beforeUnmount"
    - path: "app/src/components/small/LogoutCountdownBadge.vue"
      provides: "Countdown timer with correct cleanup"
      contains: "beforeUnmount"
  key_links:
    - from: "app/src/views/User.vue"
      to: "setInterval/clearInterval"
      via: "lifecycle hook cleanup"
      pattern: "beforeUnmount.*clearInterval"
    - from: "app/src/components/small/LogoutCountdownBadge.vue"
      to: "setInterval/clearInterval"
      via: "lifecycle hook cleanup"
      pattern: "beforeUnmount.*clearInterval"
---

<objective>
Update Vue 2 lifecycle hooks to Vue 3 naming and ensure all reactivity patterns work correctly.

Purpose: Vue 3 renamed lifecycle hooks (beforeDestroy -> beforeUnmount). While @vue/compat handles these automatically, fixing them removes compat warnings and prepares for @vue/compat removal.

Output: All lifecycle hooks use Vue 3 naming, timers clean up correctly, no compat warnings for lifecycle hooks.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-vue3-core-migration/10-CONTEXT.md
@.planning/phases/10-vue3-core-migration/10-RESEARCH.md
@.planning/phases/10-vue3-core-migration/10-02-SUMMARY.md
@app/src/views/User.vue
@app/src/components/small/LogoutCountdownBadge.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update User.vue lifecycle hooks</name>
  <files>app/src/views/User.vue</files>
  <action>
Update the lifecycle hook in User.vue:

FIND (around line 249):
```javascript
beforeDestroy() {
  clearInterval(this.interval);
},
```

REPLACE WITH:
```javascript
beforeUnmount() {
  clearInterval(this.interval);
},
```

ALSO: While in this file, check for any other Vue 2-specific patterns:
- `destroyed` -> `unmounted` (if present)
- Keep all other code unchanged

The User.vue file uses setInterval in mounted() to update the logout timer.
The beforeUnmount hook properly clears this interval to prevent memory leaks.
  </action>
  <verify>
```bash
grep "beforeDestroy" app/src/views/User.vue || echo "No beforeDestroy"
grep "beforeUnmount" app/src/views/User.vue
grep "clearInterval" app/src/views/User.vue
```
Should show: No beforeDestroy, beforeUnmount present, clearInterval present
  </verify>
  <done>User.vue uses beforeUnmount for timer cleanup</done>
</task>

<task type="auto">
  <name>Task 2: Update LogoutCountdownBadge.vue lifecycle hooks</name>
  <files>app/src/components/small/LogoutCountdownBadge.vue</files>
  <action>
Update the lifecycle hook in LogoutCountdownBadge.vue:

FIND (around line 39):
```javascript
beforeDestroy() {
  clearInterval(this.interval);
},
```

REPLACE WITH:
```javascript
beforeUnmount() {
  clearInterval(this.interval);
},
```

ALSO: This file has a Vue 2 pattern at the top that should be cleaned:

FIND (lines 14-20):
```javascript
import Vue from 'vue';

import toastMixin from '@/assets/js/mixins/toastMixin';

import { BBadge } from 'bootstrap-vue';

Vue.component('b-badge', BBadge);
```

This local Vue.component registration is a Vue 2 pattern that works with @vue/compat
but will cause issues later. However, do NOT change it in this plan - Bootstrap-Vue
component registration will be addressed in Phase 11.

ONLY change the lifecycle hook for now.
  </action>
  <verify>
```bash
grep "beforeDestroy" app/src/components/small/LogoutCountdownBadge.vue || echo "No beforeDestroy"
grep "beforeUnmount" app/src/components/small/LogoutCountdownBadge.vue
grep "clearInterval" app/src/components/small/LogoutCountdownBadge.vue
```
Should show: No beforeDestroy, beforeUnmount present, clearInterval present
  </verify>
  <done>LogoutCountdownBadge.vue uses beforeUnmount for timer cleanup</done>
</task>

<task type="auto">
  <name>Task 3: Verify no other lifecycle hooks need updating</name>
  <files></files>
  <action>
Search the entire codebase for Vue 2 lifecycle hooks that need updating:

```bash
# Search for beforeDestroy
grep -r "beforeDestroy" app/src/ --include="*.vue" --include="*.js"

# Search for destroyed
grep -r "destroyed\s*(" app/src/ --include="*.vue" --include="*.js"
grep -r "destroyed:" app/src/ --include="*.vue" --include="*.js"
```

Based on the RESEARCH.md audit, only 3 files had beforeDestroy:
1. App.vue - handled in 10-04 (removed entirely when switching to Pinia)
2. User.vue - handled in Task 1
3. LogoutCountdownBadge.vue - handled in Task 2

If the grep commands find additional files, update them with the same pattern:
- `beforeDestroy` -> `beforeUnmount`
- `destroyed` -> `unmounted`

Document any additional files found and updated.
  </action>
  <verify>
```bash
# Verify no Vue 2 lifecycle hooks remain
grep -r "beforeDestroy" app/src/ --include="*.vue" || echo "No beforeDestroy"
grep -r "destroyed:" app/src/ --include="*.vue" || echo "No destroyed"

# Verify Vue 3 hooks are used
grep -r "beforeUnmount" app/src/ --include="*.vue" | wc -l
```
Should show: No beforeDestroy, no destroyed, 2+ beforeUnmount usages
  </verify>
  <done>All Vue 2 lifecycle hooks updated to Vue 3 equivalents</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. No Vue 2 lifecycle hooks:
```bash
grep -rE "beforeDestroy|destroyed:" app/src/ --include="*.vue" || echo "Clean"
```

2. Timer cleanup works:
- Start dev server
- Navigate to /User (requires login)
- The logout countdown timer should display and count down
- Navigate away from /User and back - no duplicate timers

3. @vue/compat warnings check:
- Open browser console
- Look for deprecation warnings about lifecycle hooks
- Should NOT see: "beforeDestroy has been renamed to beforeUnmount"
- Should NOT see: "destroyed has been renamed to unmounted"

4. Build check:
```bash
cd /home/bernt-popp/development/sysndd/app && npm run build 2>&1 | tail -10
```
</verification>

<success_criteria>
- No `beforeDestroy` in any .vue file
- No `destroyed` lifecycle hook in any .vue file
- User.vue uses `beforeUnmount` for clearInterval
- LogoutCountdownBadge.vue uses `beforeUnmount` for clearInterval
- Countdown timer works correctly on /User page
- No @vue/compat warnings about lifecycle hooks in console
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-vue3-core-migration/10-05-SUMMARY.md`
</output>
