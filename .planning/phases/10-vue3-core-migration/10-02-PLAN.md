---
phase: 10-vue3-core-migration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/package.json
  - app/vue.config.js
  - app/src/main.js
autonomous: true

must_haves:
  truths:
    - "App boots on Vue 3 with @vue/compat without crashing"
    - "Console shows @vue/compat deprecation warnings (not errors)"
    - "Existing pages render (Home, Entities, Genes)"
  artifacts:
    - path: "app/package.json"
      provides: "Vue 3 and @vue/compat dependencies"
      contains: '"vue": "^3.5'
    - path: "app/vue.config.js"
      provides: "@vue/compat webpack alias configuration"
      contains: "vue.*@vue/compat"
    - path: "app/src/main.js"
      provides: "Vue 3 createApp initialization"
      contains: "createApp"
  key_links:
    - from: "app/vue.config.js"
      to: "@vue/compat"
      via: "webpack alias"
      pattern: "resolve\\.alias\\.set\\('vue'.*@vue/compat"
    - from: "app/src/main.js"
      to: "app/src/App.vue"
      via: "createApp mount"
      pattern: "createApp\\(App\\)"
---

<objective>
Install Vue 3 with @vue/compat migration build and configure the application to boot in compatibility mode.

Purpose: This is the foundation for all Vue 3 migration work. The app must boot with @vue/compat before any other migration tasks can proceed.

Output: A working Vue 3 application running in MODE: 2 (Vue 2 compatibility mode), showing deprecation warnings in console but rendering all pages correctly.

Note on deferred items:
- **defineAsyncComponent (FR-01.8):** The 52 dynamic imports in routes.js use standard `() => import()` syntax which Vue CLI webpack and @vue/compat handle automatically. Explicit `defineAsyncComponent()` wrapping is only required for non-standard async patterns (e.g., with loading/error components). No action needed in Phase 10.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-vue3-core-migration/10-CONTEXT.md
@.planning/phases/10-vue3-core-migration/10-RESEARCH.md
@app/package.json
@app/vue.config.js
@app/src/main.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update dependencies for Vue 3</name>
  <files>app/package.json</files>
  <action>
Update package.json dependencies:

1. Change core Vue packages:
   - `"vue": "^2.7.8"` -> `"vue": "^3.5.25"`
   - Add `"@vue/compat": "^3.5.25"`
   - `"vue-router": "^3.5.3"` -> `"vue-router": "^4.6.0"` (prep for next plan)

2. Remove packages no longer needed with Vue 3:
   - Remove `"@vue/composition-api": "^1.7.0"` (built into Vue 3)
   - Remove `"vue-template-compiler": "^2.7.8"` from devDependencies

3. Add Vue 3 dev dependencies:
   - Add `"@vue/compiler-sfc": "^3.5.25"` to devDependencies

4. Keep vue-loader at `"^17.0.0"` (already Vue 3 compatible)

5. Run `npm install` from the app/ directory

WHY these specific versions:
- 3.5.25 is current stable Vue 3
- @vue/compat must match Vue version exactly
- vue-router@4.6 is latest stable for Vue 3
  </action>
  <verify>
Run from app/ directory:
```bash
npm ls vue @vue/compat vue-router
```
Should show vue@3.5.x, @vue/compat@3.5.x, vue-router@4.x
No npm ERR! messages about peer dependencies
  </verify>
  <done>package.json updated with Vue 3 dependencies, npm install completes without errors</done>
</task>

<task type="auto">
  <name>Task 2: Configure @vue/compat in webpack</name>
  <files>app/vue.config.js</files>
  <action>
Modify vue.config.js to use @vue/compat:

1. In the existing `chainWebpack` function (currently only deletes prefetch plugin):
   - Add webpack alias: `vue` -> `@vue/compat`
   - Configure vue-loader compilerOptions with compatConfig MODE: 2

Use this exact pattern from RESEARCH.md:
```javascript
chainWebpack: (config) => {
  // Existing prefetch deletion
  config.plugins.delete('prefetch');

  // Vue 3 compat mode configuration
  config.resolve.alias.set('vue', '@vue/compat')
  config.module
    .rule('vue')
    .use('vue-loader')
    .tap((options) => {
      return {
        ...options,
        compilerOptions: {
          compatConfig: {
            MODE: 2  // Vue 2 mode - maximum compatibility
          }
        }
      }
    })
}
```

WHY MODE: 2:
- MODE: 2 means full Vue 2 compatibility
- All Vue 2 APIs work but show deprecation warnings
- This allows the app to boot immediately
  </action>
  <verify>
The vue.config.js should contain both the alias and compilerOptions configuration.
Verify with grep:
```bash
grep -A5 "resolve.alias.set" app/vue.config.js
grep -A5 "compatConfig" app/vue.config.js
```
  </verify>
  <done>vue.config.js configured with @vue/compat alias and MODE: 2 compatibility</done>
</task>

<task type="auto">
  <name>Task 3: Migrate main.js to Vue 3 createApp</name>
  <files>app/src/main.js</files>
  <action>
Rewrite main.js for Vue 3 initialization pattern:

1. Change Vue import:
   - FROM: `import Vue from 'vue'`
   - TO: `import { createApp } from 'vue'`

2. Change Pinia initialization:
   - REMOVE: `import { createPinia, PiniaVuePlugin } from 'pinia'`
   - REMOVE: `Vue.use(PiniaVuePlugin)`
   - ADD: `import { createPinia } from 'pinia'`

3. Change app creation (at bottom of file):
   - FROM:
     ```javascript
     Vue.use(PiniaVuePlugin);
     const pinia = createPinia();

     new Vue({
       router,
       pinia,
       render: (h) => h(App),
     }).$mount('#app');
     ```
   - TO:
     ```javascript
     const pinia = createPinia();
     const app = createApp(App);

     app.use(pinia);
     app.use(router);
     app.mount('#app');
     ```

4. Keep ALL existing global component registrations and Vue.use() calls for now:
   - Bootstrap-Vue imports and Vue.component() calls stay unchanged
   - VueMeta Vue.use() stays unchanged
   - VeeValidate Vue.component() calls stay unchanged
   - PerfectScrollbar Vue.use() stays unchanged
   - VueAxios Vue.use() stays unchanged

   WHY: @vue/compat handles these Vue 2 patterns. We fix them in later phases.

5. Remove `Vue.config.productionTip = false` (not needed in Vue 3)

IMPORTANT: Do NOT change the global component registration pattern yet.
The Vue.use() and Vue.component() calls work with @vue/compat.
  </action>
  <verify>
1. Verify syntax is correct:
```bash
cd /home/bernt-popp/development/sysndd/app && npx vue-cli-service build --mode development 2>&1 | head -50
```

2. Check main.js has createApp pattern:
```bash
grep "createApp" app/src/main.js
grep "app.use" app/src/main.js
grep "app.mount" app/src/main.js
```
  </verify>
  <done>main.js uses Vue 3 createApp pattern while keeping Vue 2 compatibility layer for global components</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build check:
```bash
cd /home/bernt-popp/development/sysndd/app && npm run build 2>&1 | tail -20
```
Build should complete (warnings OK, errors NOT OK)

2. Dev server boot:
```bash
cd /home/bernt-popp/development/sysndd/app && timeout 30 npm run serve 2>&1 | grep -E "(Compiled|ERROR|error)" | head -10
```
Should show "Compiled successfully" or "Compiled with warnings"

3. Manual smoke test (use Playwright MCP):
- Navigate to http://localhost:8080
- Verify Home page renders
- Navigate to /Entities - verify table renders
- Check browser console - should see @vue/compat warnings, NOT errors
</verification>

<success_criteria>
- npm install completes without dependency errors
- npm run build completes (warnings acceptable)
- npm run serve starts and shows "Compiled" message
- App loads in browser at localhost:8080
- Console shows @vue/compat deprecation warnings (expected)
- No JavaScript errors that prevent rendering
- Home, Entities, and Genes pages all render
</success_criteria>

<output>
After completion, create `.planning/phases/10-vue3-core-migration/10-02-SUMMARY.md`
</output>
