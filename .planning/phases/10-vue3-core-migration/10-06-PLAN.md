---
phase: 10-vue3-core-migration
plan: 06
type: execute
wave: 3
depends_on: ["10-02", "10-04"]
files_modified:
  - app/package.json
  - app/src/main.js
autonomous: false

must_haves:
  truths:
    - "App runs without @vue/composition-api dependency"
    - "All Pinia stores work correctly (user store, UI store)"
    - "Store state persists across route navigation"
  artifacts:
    - path: "app/package.json"
      provides: "Clean dependencies without @vue/composition-api"
      contains: '"pinia"'
    - path: "app/src/main.js"
      provides: "Pinia initialization without composition-api shim"
      contains: "createPinia"
  key_links:
    - from: "app/src/main.js"
      to: "app/src/stores/ui.js"
      via: "Pinia plugin registration"
      pattern: "app\\.use\\(.*pinia"
---

<objective>
Verify Pinia works correctly with Vue 3 native Composition API and remove the @vue/composition-api polyfill.

Purpose: The @vue/composition-api package was a polyfill for Vue 2 that brought Composition API features. Vue 3 has these built-in, so the polyfill is no longer needed and can cause conflicts.

Output: Clean Pinia setup working with Vue 3 native Composition API, no composition-api polyfill.

Note on deferred items:
- **v-model syntax (FR-01.4):** Vue 3 changed v-model from `v-model="value"` + `@input` to `v-model:modelValue` + `@update:modelValue` for custom components. However, @vue/compat MODE: 2 handles Vue 2 v-model syntax automatically. V-model migration will be addressed in Phase 17 when removing @vue/compat, as the compat layer makes this safe to defer.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-vue3-core-migration/10-CONTEXT.md
@.planning/phases/10-vue3-core-migration/10-RESEARCH.md
@.planning/phases/10-vue3-core-migration/10-02-SUMMARY.md
@.planning/phases/10-vue3-core-migration/10-04-SUMMARY.md
@app/package.json
@app/src/main.js
@app/src/stores/ui.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify @vue/composition-api is removed</name>
  <files>app/package.json</files>
  <action>
Check that @vue/composition-api was removed in plan 10-02:

```bash
grep "composition-api" app/package.json || echo "Already removed"
```

If it's still present (shouldn't be), remove it:
```bash
cd app && npm uninstall @vue/composition-api
```

Also verify there are no imports of @vue/composition-api anywhere:
```bash
grep -r "@vue/composition-api" app/src/ || echo "No imports"
```

If any imports exist, they need to be removed - Vue 3 Composition API is built-in.

EXPECTED STATE after 10-02:
- No @vue/composition-api in package.json
- No imports from @vue/composition-api
- Pinia 2.0.14 still present (compatible with Vue 3)
  </action>
  <verify>
```bash
grep "composition-api" app/package.json || echo "Not in package.json"
grep -r "@vue/composition-api" app/src/ || echo "Not in source"
```
Both should show "Not found" messages
  </verify>
  <done>@vue/composition-api removed from dependencies and no imports remain</done>
</task>

<task type="auto">
  <name>Task 2: Verify Pinia store functionality</name>
  <files></files>
  <action>
Test that Pinia stores work correctly with Vue 3:

1. Verify the UI store from plan 10-04 works:
   - The store should be importable
   - The action should trigger state changes
   - Watchers should react to state changes

2. Check for any existing stores that might need verification:
```bash
ls -la app/src/stores/
```

3. Run the development server and test store functionality:
```bash
cd app && npm run serve
```

4. In the browser console (with Vue DevTools if available):
   - Navigate to a page with data tables (/Entities)
   - The scrollbar update should trigger when data loads
   - No errors in console about Pinia or store access

5. Verify mapState works in Options API components:
   - App.vue uses mapState to watch scrollbarUpdateTrigger
   - This should work without errors
  </action>
  <verify>
```bash
# Verify store file exists and has correct structure
grep "defineStore" app/src/stores/ui.js
grep "requestScrollbarUpdate" app/src/stores/ui.js

# Verify App.vue uses the store correctly
grep "mapState" app/src/App.vue
grep "useUiStore" app/src/App.vue
```
All should show matches
  </verify>
  <done>Pinia stores verified working with Vue 3 Composition API</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Vue 3 core migration with @vue/compat:
- Vue 3.5+ with @vue/compat in MODE: 2
- Vue Router 4 with all routes working
- Pinia stores replacing EventBus
- All lifecycle hooks updated to Vue 3 naming
- Array watchers updated with deep: true where needed
- No @vue/composition-api polyfill

Deferred to Phase 17 (removal of @vue/compat):
- v-model syntax migration (FR-01.4) - compat mode handles Vue 2 v-model automatically
- defineAsyncComponent wrapping (FR-01.8) - Vue CLI handles dynamic imports automatically
  </what-built>
  <how-to-verify>
1. Start the dev server: `cd app && npm run serve`

2. Open http://localhost:8080 in browser

3. Check the browser console for warnings:
   - You SHOULD see @vue/compat deprecation warnings (this is expected)
   - You should NOT see JavaScript errors
   - Note the types of warnings shown (we need to track these)

4. Test navigation:
   - Home page loads
   - /Entities page shows table with data
   - /Genes page shows table with data
   - /About page loads
   - /Login page loads

5. Test scrollbar functionality:
   - On /Entities page, scroll down in the table
   - The scrollbar should work correctly
   - Data loading should trigger scrollbar updates (no freezing)

6. Test authentication flow (if you have test credentials):
   - Log in
   - Navigate to /User
   - Logout countdown timer should display and count down
   - Navigate away and back - no timer issues

7. Test 404 handling:
   - Navigate to /nonexistent-route
   - Should show 404 page

8. Document the @vue/compat warnings you see in console:
   - List the warning categories (e.g., GLOBAL_MOUNT, INSTANCE_EVENT_EMITTER, etc.)
   - These will guide Phase 11+ work
  </how-to-verify>
  <resume-signal>Type "approved" with a brief note of any issues found, or describe problems to fix</resume-signal>
</task>

</tasks>

<verification>
Final verification for Phase 10 completion:

1. Package state:
```bash
cd app && npm ls vue @vue/compat vue-router pinia
```
Should show: vue@3.5.x, @vue/compat@3.5.x, vue-router@4.x, pinia@2.x

2. No Vue 2 dependencies:
```bash
grep "vue-template-compiler\|@vue/composition-api" app/package.json || echo "Clean"
```

3. Build succeeds:
```bash
cd app && npm run build
```

4. Production build size check:
```bash
ls -lh app/dist/js/*.js | head -5
```
Note: @vue/compat adds ~40-50KB. This will be removed in Phase 17.

5. @vue/compat warnings documented for Phase 11+ planning
</verification>

<success_criteria>
- App runs on Vue 3 + @vue/compat without JavaScript errors
- All routes navigate correctly
- Scrollbar updates work (Pinia store functioning)
- Timer cleanup works (no memory leaks)
- @vue/compat warnings visible in console (expected and documented)
- No @vue/composition-api in dependencies
- Production build completes
- User confirms app functions correctly
</success_criteria>

<output>
After completion, create `.planning/phases/10-vue3-core-migration/10-06-SUMMARY.md`

Include in the summary:
- List of @vue/compat warnings observed (for Phase 11+ tracking)
- Any third-party library warnings (Bootstrap-Vue, vue-treeselect, etc.)
- Performance observations (if any)
- Note that v-model and defineAsyncComponent are deferred to Phase 17
</output>
