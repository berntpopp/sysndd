---
phase: 10-vue3-core-migration
plan: 03
type: execute
wave: 2
depends_on: ["10-02"]
files_modified:
  - app/src/router/index.js
  - app/src/router/routes.js
autonomous: true

must_haves:
  truths:
    - "All routes navigate correctly"
    - "Route parameters work (e.g., /Entities/:entity_id)"
    - "Route guards (beforeEnter) still protect admin pages"
    - "Catch-all route shows 404 page"
  artifacts:
    - path: "app/src/router/index.js"
      provides: "Vue Router 4 initialization"
      contains: "createRouter"
    - path: "app/src/router/routes.js"
      provides: "Route definitions with Vue Router 4 syntax"
      contains: "pathMatch"
  key_links:
    - from: "app/src/router/index.js"
      to: "app/src/router/routes.js"
      via: "ES module import"
      pattern: "import.*routes.*from.*routes"
    - from: "app/src/main.js"
      to: "app/src/router/index.js"
      via: "app.use(router)"
      pattern: "app\\.use\\(router\\)"
---

<objective>
Migrate Vue Router from v3 to v4 API while maintaining all existing route behavior.

Purpose: Vue Router 4 is required for Vue 3. The migration is mostly API changes (constructor syntax), not behavior changes.

Output: Working navigation with Vue Router 4, all routes functional, all guards working.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-vue3-core-migration/10-CONTEXT.md
@.planning/phases/10-vue3-core-migration/10-RESEARCH.md
@.planning/phases/10-vue3-core-migration/10-02-SUMMARY.md
@app/src/router/index.js
@app/src/router/routes.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate router/index.js to Vue Router 4</name>
  <files>app/src/router/index.js</files>
  <action>
Rewrite router/index.js for Vue Router 4:

FROM (current Vue Router 3 pattern):
```javascript
import Vue from 'vue';
import VueRouter from 'vue-router';

Vue.use(VueRouter);

const { routes } = require('./routes');

const router = new VueRouter({
  mode: 'history',
  base: process.env.BASE_URL,
  routes,
});

export default router;
```

TO (Vue Router 4 pattern):
```javascript
import { createRouter, createWebHistory } from 'vue-router';
import { routes } from './routes';

const router = createRouter({
  history: createWebHistory(process.env.BASE_URL),
  routes,
});

export default router;
```

KEY CHANGES:
1. No more `Vue.use(VueRouter)` - handled by app.use(router) in main.js
2. `new VueRouter()` -> `createRouter()`
3. `mode: 'history'` -> `history: createWebHistory()`
4. ES import instead of require for routes
5. Remove Vue import entirely

WHY ES import for routes:
- The require('./routes') was used for sitemap plugin compatibility
- The routes.js file already exports with ES syntax
- Vue CLI 5 handles the sitemap plugin correctly with ES imports
  </action>
  <verify>
```bash
grep "createRouter" app/src/router/index.js
grep "createWebHistory" app/src/router/index.js
grep -v "VueRouter" app/src/router/index.js | grep -c "Router" || echo "VueRouter removed"
```
Should show createRouter and createWebHistory, no VueRouter
  </verify>
  <done>router/index.js uses Vue Router 4 createRouter and createWebHistory APIs</done>
</task>

<task type="auto">
  <name>Task 2: Update routes.js for Vue Router 4</name>
  <files>app/src/router/routes.js</files>
  <action>
Update routes.js for Vue Router 4 compatibility:

1. REMOVE the Vue.use() calls at the top:
```javascript
// DELETE these lines:
import Vue from 'vue';
import VueAxios from 'vue-axios';
import axios from 'axios';

Vue.use(VueAxios, axios);
```
WHY: Vue.use() no longer works in Vue 3 this way, and these imports aren't actually needed in the routes file (axios is already configured in main.js)

2. UPDATE the catch-all 404 route (currently at line ~694):

FROM:
```javascript
{
  path: '*',
  component: () => import(/* webpackChunkName: "Pages" */ '@/views/PageNotFound.vue'),
},
```

TO:
```javascript
{
  path: '/:pathMatch(.*)*',
  name: 'NotFound',
  component: () => import(/* webpackChunkName: "Pages" */ '@/views/PageNotFound.vue'),
},
```

WHY:
- Vue Router 4 removed wildcard `*` syntax
- `/:pathMatch(.*)*` captures all segments
- Adding `name: 'NotFound'` is best practice for programmatic navigation

3. KEEP all other routes unchanged:
- beforeEnter guards work the same in Vue Router 4
- Props functions work the same
- Nested routes work the same
- Dynamic imports work the same
  </action>
  <verify>
```bash
grep "pathMatch" app/src/router/routes.js
grep -c "Vue.use" app/src/router/routes.js || echo "No Vue.use calls"
grep "path: '\*'" app/src/router/routes.js || echo "No wildcard routes"
```
Should show pathMatch route, no Vue.use calls, no wildcard routes
  </verify>
  <done>routes.js updated with Vue Router 4 catch-all syntax, removed unnecessary Vue.use() calls</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build check:
```bash
cd /home/bernt-popp/development/sysndd/app && npm run build 2>&1 | tail -10
```

2. Route navigation smoke test (use Playwright MCP or manual):
- Navigate to http://localhost:8080/ (Home)
- Navigate to http://localhost:8080/Entities (table view)
- Navigate to http://localhost:8080/Genes (table view)
- Navigate to http://localhost:8080/Entities/1 (detail page with param)
- Navigate to http://localhost:8080/nonexistent-route (should show 404 page)
- Navigate to http://localhost:8080/User (should redirect to Login if not authenticated)

3. Verify route guards still work:
- Try accessing /User without login -> should redirect to /Login
- Try accessing /ManageUser without admin role -> should redirect to /Login
</verification>

<success_criteria>
- No import errors or syntax errors
- All navigation works: Home, Entities, Genes, About, Documentation
- Dynamic routes work: /Entities/:entity_id, /Genes/:symbol
- 404 page shows for non-existent routes
- beforeEnter guards redirect unauthenticated users to Login
- Query parameter routes work: /Entities?filter=xxx
</success_criteria>

<output>
After completion, create `.planning/phases/10-vue3-core-migration/10-03-SUMMARY.md`
</output>
