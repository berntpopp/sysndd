# Plan 10-01: Pre-Migration Audit

**Phase:** 10 - Vue 3 Core Migration
**Plan:** 10-01 Pre-Migration Audit
**Status:** Complete
**Created:** 2026-01-22

---

## Objective

Run audit commands to identify all Vue 3 breaking change locations and document findings for migration planning.

---

## Audit Results

### Summary

| Category | Count | Severity |
|----------|-------|----------|
| Total Vue Components | 77 | — |
| Event Bus (EventBus) | 14 usages in 13 files | Critical |
| Event Bus ($root.$emit) | 15 usages in 6 files | Critical |
| $bvModal | 1 usage | Critical |
| $bvToast | 6 usages in 3 files | Critical |
| beforeDestroy hooks | 3 files | Minor |
| b-table components | 30 | High |
| b-modal components | 20 | Medium |
| filter-included-fields | 6 | High |
| @sort-changed | 2 | High |
| text-left/text-right classes | 282 | Medium |
| ml-*/mr-* classes | 65 | Medium |
| Mixins | 7 files | High |
| Watchers to review | 21 | Low |
| @vue/composition-api | 1 (in package.json) | High |

---

## Detailed Findings

### 1. Event Bus Pattern (CRITICAL)

**Custom EventBus (new Vue())**
File: `src/assets/js/eventBus.js`

Usage: Single event `update-scrollbar` used for scrollbar refresh
- 13 files emit the event
- 1 file (App.vue) listens with $on/$off

**Files emitting EventBus.$emit('update-scrollbar'):**
1. src/views/curate/ManageReReview.vue:261
2. src/views/curate/ApproveReview.vue:1305
3. src/views/curate/ApproveStatus.vue:769
4. src/views/curate/ApproveUser.vue:238
5. src/views/tables/Panels.vue:513
6. src/views/admin/ManageUser.vue:208
7. src/views/admin/ManageOntology.vue:237
8. src/components/analyses/PublicationsNDDTable.vue:405
9. src/components/analyses/PubtatorNDDTable.vue:485
10. src/components/analyses/PubtatorNDDGenes.vue:377
11. src/components/tables/TablesPhenotypes.vue:723
12. src/components/tables/TablesEntities.vue:493
13. src/components/tables/TablesLogs.vue:398
14. src/components/tables/TablesGenes.vue:610

**File listening:**
- src/App.vue:57-60 ($on in beforeDestroy, $off in destroyed)

**Migration strategy:** Replace EventBus with:
- Provide/inject pattern from App.vue
- Or use Pinia store with action
- Or use mitt library (minimal change)

---

### 2. Bootstrap-Vue Modal Show/Hide via $root.$emit (CRITICAL)

**Files using $root.$emit for modal control:**

| File | Line | Usage |
|------|------|-------|
| ApproveReview.vue | 1554, 1560, 1657 | bv::show::modal |
| ApproveStatus.vue | 865, 871 | bv::show::modal |
| ApproveUser.vue | 279 | bv::show::modal |
| ManageUser.vue | 237, 255, 261 | bv::show::modal, bv::hide::modal |
| ManageOntology.vue | 255 | bv::show::modal |
| Review.vue | 1406, 1412, 1418, 1424, 1860 | bv::show::modal, bv::hide::modal |

**Migration strategy:** Replace with Bootstrap-Vue-Next v-model or ref-based control:
```vue
<!-- OLD -->
this.$root.$emit('bv::show::modal', 'modal-id')

<!-- NEW -->
const modalVisible = ref(false)
modalVisible.value = true
```

---

### 3. $bvModal and $bvToast (CRITICAL)

**$bvModal usage:**
- src/views/admin/ManageOntology.vue:286 — `this.$bvModal.hide()`

**$bvToast usage:**
- src/views/admin/AdminStatistics.vue:186 — error toast
- src/views/admin/ManageAnnotations.vue:99, 105 — success/error toasts
- src/views/admin/ManageAnnotations.vue:122, 128 — success/error toasts
- src/assets/js/mixins/toastMixin.js:28 — wrapper

**Migration strategy:** Create useToast composable wrapping Bootstrap-Vue-Next toast

---

### 4. Lifecycle Hook Renames (MINOR)

**beforeDestroy → beforeUnmount:**
| File | Line |
|------|------|
| src/views/User.vue | 249 |
| src/App.vue | 59 |
| src/components/small/LogoutCountdownBadge.vue | 39 |

**No `destroyed` hooks found** (all use beforeDestroy)

---

### 5. Bootstrap-Vue Table Components (HIGH)

**30 b-table components** across the codebase

**filter-included-fields prop (needs update to filterable):**
1. src/views/curate/ApproveReview.vue:109
2. src/views/curate/ApproveStatus.vue:108
3. src/views/tables/Panels.vue:206
4. src/views/review/Review.vue:146
5. src/components/tables/TablesPhenotypes.vue:190
6. src/components/tables/TablesGenes.vue:89

**@sort-changed event (needs update to @update:sort-by):**
1. src/views/curate/ManageReReview.vue:111
2. src/components/small/GenericTable.vue:20

---

### 6. Bootstrap 5 CSS Class Updates (MEDIUM)

**text-left/text-right classes:** 282 occurrences
- Need to change to text-start/text-end

**ml-*/mr-* margin classes:** 65 occurrences
- Need to change to ms-*/me-*

**No data-toggle/data-dismiss found** (good!)

---

### 7. Mixins to Convert (HIGH)

7 mixin files in `src/assets/js/mixins/`:
1. colorAndSymbolsMixin.js (4.1 KB)
2. scrollbarMixin.js (276 B)
3. tableDataMixin.js (1.3 KB)
4. tableMethodsMixin.js (4.3 KB)
5. textMixin.js (2.9 KB)
6. toastMixin.js (1.6 KB)
7. urlParsingMixin.js (5.5 KB)

**Note:** These will be converted in Phase 13, but need to remain functional during Vue 3 migration.

---

### 8. Other Findings

**@vue/composition-api in package.json:**
- Must be removed (functionality built into Vue 3)

**No Vue filters found** (good!)

**No Vue.set/$set found** (good!)

**No .v-enter/.v-leave transition classes found** (good!)

**21 watchers to review** for deep: true requirements

---

## Risk Assessment

| Item | Risk | Impact | Mitigation |
|------|------|--------|------------|
| EventBus removal | Medium | 14 usages, single event type | Simple replacement pattern |
| $root.$emit modal control | High | 15 usages in critical workflows | v-model replacement |
| $bvToast | Medium | 6 usages | Create composable wrapper |
| filter-included-fields | Medium | 6 tables | Direct prop rename |
| CSS class renames | Low | 347 occurrences | Find-replace with testing |

---

## Migration Checklist

### Phase 10 (Vue 3 Core)
- [ ] Install Vue 3 with @vue/compat
- [ ] Replace EventBus with provide/inject or mitt
- [ ] Rename beforeDestroy → beforeUnmount (3 files)
- [ ] Remove @vue/composition-api dependency
- [ ] Update Vue Router to v4
- [ ] Review 21 watchers for deep: true

### Phase 11 (Bootstrap-Vue-Next)
- [ ] Replace $root.$emit modal control with v-model (15 usages)
- [ ] Replace $bvModal.hide() (1 usage)
- [ ] Replace $bvToast (6 usages)
- [ ] Update filter-included-fields → filterable (6 tables)
- [ ] Update @sort-changed → @update:sort-by (2 tables)
- [ ] Update Bootstrap 5 text-* classes (282)
- [ ] Update Bootstrap 5 m[lr]-* classes (65)

### Phase 13 (Composables)
- [ ] Convert 7 mixins to composables

---

## Files by Priority

### Critical (Must fix for Vue 3 to work)
1. src/assets/js/eventBus.js — Delete and replace pattern
2. src/App.vue — EventBus listener, beforeDestroy
3. src/main.js — Vue 3 initialization

### High (Core functionality)
4. src/views/review/Review.vue — 5 modal emits
5. src/views/curate/ApproveReview.vue — 3 modal emits, EventBus
6. src/views/curate/ApproveStatus.vue — 2 modal emits, EventBus
7. src/views/admin/ManageUser.vue — 3 modal emits, EventBus

### Medium (Feature functionality)
8-20. Table components with filter/sort changes
21-77. Remaining components

---

## Next Steps

1. **10-02:** Install Vue 3 with @vue/compat
2. **10-03:** Vue Router 4 migration
3. **10-04:** Event bus pattern removal
4. **10-05:** Lifecycle and reactivity updates
5. **10-06:** Pinia verification

---

*Audit completed: 2026-01-22*
