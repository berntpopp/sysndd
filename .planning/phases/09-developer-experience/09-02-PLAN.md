---
phase: 09-developer-experience
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docker-compose.override.yml
autonomous: true

must_haves:
  truths:
    - "docker compose up uses Dockerfile.dev for app service automatically"
    - "MySQL is accessible at localhost:7654 for DBeaver/MySQL Workbench"
    - "API runs in development mode with ENVIRONMENT=development"
    - "Frontend source changes are reflected via volume mount"
  artifacts:
    - path: "docker-compose.override.yml"
      provides: "Auto-loaded development overrides"
      min_lines: 25
      contains: "Dockerfile.dev"
  key_links:
    - from: "docker-compose.override.yml"
      to: "app/Dockerfile.dev"
      via: "dockerfile: Dockerfile.dev"
      pattern: "dockerfile:\\s*Dockerfile\\.dev"
    - from: "docker-compose.override.yml"
      to: "docker-compose.yml mysql service"
      via: "mysql ports override"
      pattern: "127\\.0\\.0\\.1:7654:3306"
---

<objective>
Create docker-compose.override.yml with development-specific configurations: Dockerfile.dev for app, volume mounts for live code changes, and MySQL port exposure for local database tools.

Purpose: Enable zero-config development mode that auto-loads when running docker compose up (without -f flag).
Output: docker-compose.override.yml with app build override, volume mounts, and MySQL port 7654
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-developer-experience/09-RESEARCH.md

@docker-compose.yml
@docker-compose.dev.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docker-compose.override.yml</name>
  <files>docker-compose.override.yml</files>
  <action>
Create docker-compose.override.yml that auto-merges with docker-compose.yml on `docker compose up`.

Structure:
1. Header comment explaining:
   - Purpose: Development overrides auto-loaded by Docker Compose
   - Skip for production: docker compose -f docker-compose.yml up
   - This enables hot-reload, database access, and dev settings

2. mysql service override (DEV-03):
   - Expose port to localhost only for security: "127.0.0.1:7654:3306"
   - Comment explaining: DBeaver, MySQL Workbench, DataGrip access

3. api service override (part of DEV-02):
   - Set ENVIRONMENT: development
   - Note: Compose Watch for API is already configured in docker-compose.yml

4. app service override (FRONT-04, DEV-01, DEV-02):
   - Override build to use Dockerfile.dev:
     ```yaml
     build:
       context: ./app
       dockerfile: Dockerfile.dev
     ```
   - Volume mounts for live code changes:
     ```yaml
     volumes:
       - ./app:/app:cached
       - /app/node_modules  # Anonymous volume - CRITICAL for cross-platform
     ```
   - Environment:
     - NODE_ENV=development
   - develop.watch configuration for Compose Watch (DEV-05):
     ```yaml
     develop:
       watch:
         - action: sync
           path: ./app/src
           target: /app/src
           ignore:
             - node_modules/
         - action: sync
           path: ./app/public
           target: /app/public
         - action: rebuild
           path: ./app/package.json
         - action: rebuild
           path: ./app/vue.config.js
     ```

Key points:
- Use "127.0.0.1:" prefix for MySQL port (localhost only, not network-accessible)
- Anonymous volume /app/node_modules prevents platform incompatibility (native binaries)
- :cached flag on volume mount for better macOS/Windows performance
- develop.watch in override, NOT in main docker-compose.yml (keeps production clean)
  </action>
  <verify>
Validate compose syntax:
```bash
docker compose config > /dev/null && echo "Valid compose config"
```
Check override merges correctly:
```bash
docker compose config | grep -A5 "app:" | grep "Dockerfile.dev"
```
Check MySQL port binding:
```bash
docker compose config | grep -E "127.0.0.1:7654:3306"
```
  </verify>
  <done>docker-compose.override.yml exists and merges with docker-compose.yml, app uses Dockerfile.dev, MySQL accessible at localhost:7654</done>
</task>

<task type="auto">
  <name>Task 2: Remove develop.watch from docker-compose.yml api service (if app watch is there)</name>
  <files>docker-compose.yml</files>
  <action>
Check if docker-compose.yml has develop.watch configuration for the api service.

If api service already has develop.watch (it does based on context):
- KEEP IT - this is correct, API watch stays in main compose
- The API Compose Watch syncs endpoints/ and functions/ without needing Dockerfile.dev

If app service has develop.watch in docker-compose.yml:
- REMOVE IT - app watch belongs in docker-compose.override.yml only
- Production docker-compose.yml should not have develop.watch for app

Rationale:
- docker-compose.yml = production configuration
- docker-compose.override.yml = development additions
- API watch in main compose is fine (API Dockerfile serves both dev and prod)
- App watch in override because it references Dockerfile.dev (dev only)
  </action>
  <verify>
Check api still has watch in main compose:
```bash
grep -A10 "^  api:" docker-compose.yml | grep -q "develop:" && echo "API watch present"
```
Check app does NOT have watch in main compose:
```bash
grep -A10 "^  app:" docker-compose.yml | grep "develop:" || echo "App watch not in main compose (correct)"
```
  </verify>
  <done>docker-compose.yml keeps API develop.watch, app develop.watch only in override file</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `docker compose config` shows merged configuration
2. App service uses Dockerfile.dev: `docker compose config | grep "dockerfile: Dockerfile.dev"`
3. MySQL port 7654 bound to localhost: `docker compose config | grep "127.0.0.1:7654"`
4. App has develop.watch with sync actions
5. Production mode works: `docker compose -f docker-compose.yml config` (no Dockerfile.dev)
</verification>

<success_criteria>
1. docker compose up (default) uses development configuration automatically
2. docker compose -f docker-compose.yml up uses production configuration
3. MySQL accessible at localhost:7654 but not on network (127.0.0.1 binding)
4. App service builds from Dockerfile.dev with volume mounts and Compose Watch
5. No manual -f flag needed for development workflow
</success_criteria>

<output>
After completion, create `.planning/phases/09-developer-experience/09-02-SUMMARY.md`
</output>
