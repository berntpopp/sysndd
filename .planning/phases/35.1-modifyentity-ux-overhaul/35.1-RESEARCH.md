# Phase 35.1: ModifyEntity UX Overhaul - Research

**Researched:** 2026-01-26
**Domain:** Vue 3 entity preview UX, Bootstrap-Vue-Next form controls, modal header patterns
**Confidence:** HIGH

## Summary

Research focused on modernizing ModifyEntity.vue UX patterns: enhanced entity preview cards, contextual modal headers with rich entity information, and modernizing form controls to use Bootstrap-Vue-Next components exclusively.

**Current State:** ModifyEntity.vue has a basic entity preview card (lines 62-103) showing only text fields. Modal headers use simple BBadge with entity IDs (lines 185-190, 221-226, 305-310, 521-526). Form controls use deprecated custom-control-switch CSS classes (lines 235-249, 257-271, 565-577) instead of Bootstrap-Vue-Next components.

**Key findings:**
1. **Badge Components Available:** GeneBadge, DiseaseBadge, EntityBadge components exist with rich styling and icon support
2. **colorAndSymbols Composable:** Provides stoplights_style for category, ndd_icon_style for NDD status
3. **BFormCheckbox Switch Prop:** Use `switch` prop to create toggle switches (Bootstrap-Vue-Next native)
4. **Modal Title Slot Pattern:** Use `#modal-title` slot for rich contextual headers
5. **Entity Loading State:** Track with entity_loaded boolean, disable actions until true

**Primary recommendation:** Enhance entity preview with badge components and colorAndSymbols icons, upgrade all modal headers to show Gene | Disease | Inheritance | Category context, replace custom-control-switch with BFormCheckbox switch prop, and gate action buttons on entity_loaded state.

## Standard Stack

### Core (Already in Codebase)

| Component | Version | Purpose | Why Standard |
|-----------|---------|---------|--------------|
| GeneBadge | current | Gene symbol display with HGNC link | Already used in Entity.vue (line 45-49), styled 3D badge with icon |
| DiseaseBadge | current | Disease name with ontology link | Already used in Entity.vue (line 54-60), truncation support |
| EntityBadge | current | Entity ID badge with link | Already used in Entity.vue (line 28-32), variant colors |
| BFormCheckbox | 0.42.0 | Checkbox with switch prop | Bootstrap-Vue-Next native, replaces custom-control-switch CSS |
| BSpinner | 0.42.0 | Loading indicator | Bootstrap-Vue-Next native, accessible loading states |
| BBadge | 0.42.0 | Status/category badges | Bootstrap-Vue-Next native, colorAndSymbols integration |
| BModal | 0.42.0 | Modal dialogs with title slot | Bootstrap-Vue-Next native, #modal-title slot for rich headers |

### Supporting

| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| useColorAndSymbols | current | Style/icon mappings (stoplights, NDD, inheritance) | Already imported in ModifyEntity.vue line 619 |
| Bootstrap Icons | 1.13.1 | Icons for inheritance, category, NDD status | Already in stack, used throughout codebase |
| Vue 3 Composition API | 3.5.25 | Computed properties for icon selection | Already in stack, setup() pattern used |

### Alternatives Considered

| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| Badge components | Plain text with BBadge | Loses visual hierarchy, no icons, less professional |
| BFormCheckbox switch | Custom CSS custom-control-switch | Deprecated Bootstrap 4 pattern, not Bootstrap-Vue-Next native |
| colorAndSymbols | Hardcoded styles | Loses centralized definitions, inconsistent across views |
| entity_loaded guard | Always enabled buttons | Poor UX, allows actions before data ready |

**Installation:**
```bash
# No new dependencies needed
# All components available in existing stack
```

## Architecture Patterns

### Recommended Component Structure
```
ModifyEntity.vue
├── Entity Selection (AutocompleteInput) [existing]
├── Enhanced Entity Preview Card [upgrade]
│   ├── GeneBadge with HGNC link
│   ├── DiseaseBadge with ontology link
│   ├── Inheritance icon (colorAndSymbols)
│   ├── Category badge (colorAndSymbols stoplights_style)
│   └── NDD status icon (colorAndSymbols ndd_icon)
├── Action Buttons [guarded by entity_loaded]
└── 4 Modals with Rich Headers [upgrade]
    ├── Rename Modal
    ├── Deactivate Modal (switches upgrade)
    ├── Modify Review Modal
    └── Modify Status Modal (switch upgrade)
```

### Pattern 1: Enhanced Entity Preview Card

**What:** Rich preview showing gene, disease, inheritance, category, and NDD status with badge components and icons
**When to use:** After entity is selected and entity_loaded is true
**Example:**
```vue
<!-- Enhanced Entity Preview Card -->
<BCard
  v-if="entity_loaded && entity_info.entity_id"
  class="my-2"
  body-class="p-3"
  header-class="p-2"
  border-variant="info"
>
  <template #header>
    <h6 class="mb-0 text-start font-weight-bold d-flex align-items-center">
      <i class="bi bi-info-circle me-2" />
      Selected Entity
      <EntityBadge
        :entity-id="entity_info.entity_id"
        variant="primary"
        size="md"
        class="ms-2"
      />
    </h6>
  </template>

  <BRow class="g-3">
    <BCol md="6">
      <!-- Gene with badge and HGNC link -->
      <div class="mb-2">
        <strong class="text-muted small d-block mb-1">Gene:</strong>
        <GeneBadge
          :symbol="entity_info.symbol || 'N/A'"
          :hgnc-id="entity_info.hgnc_id"
          :link-to="entity_info.hgnc_id ? `https://www.genenames.org/data/gene-symbol-report/#!/hgnc_id/${entity_info.hgnc_id}` : null"
          size="md"
        />
      </div>

      <!-- Disease with badge and ontology link -->
      <div class="mb-2">
        <strong class="text-muted small d-block mb-1">Disease:</strong>
        <DiseaseBadge
          :name="entity_info.disease_ontology_name || 'N/A'"
          :ontology-id="entity_info.disease_ontology_id_version"
          :link-to="entity_info.disease_ontology_id_version ? `/Ontology/${entity_info.disease_ontology_id_version.replace(/_.+/g, '')}` : null"
          size="md"
          :max-length="40"
        />
      </div>
    </BCol>

    <BCol md="6">
      <!-- Inheritance with icon from colorAndSymbols -->
      <div class="mb-2">
        <strong class="text-muted small d-block mb-1">Inheritance:</strong>
        <BBadge variant="info" class="d-inline-flex align-items-center">
          <i class="bi bi-diagram-3 me-1" />
          {{ entity_info.hpo_mode_of_inheritance_term || 'N/A' }}
        </BBadge>
      </div>

      <!-- Category with stoplight style from colorAndSymbols -->
      <div class="mb-2">
        <strong class="text-muted small d-block mb-1">Category:</strong>
        <BBadge
          :variant="stoplights_style[entity_info.category] || 'secondary'"
          class="d-inline-flex align-items-center"
        >
          <i class="bi bi-stoplights me-1" />
          {{ entity_info.category || 'N/A' }}
        </BBadge>
      </div>

      <!-- NDD Status with icon from colorAndSymbols -->
      <div class="mb-2">
        <strong class="text-muted small d-block mb-1">NDD Status:</strong>
        <BBadge
          :variant="ndd_icon_style[entity_info.ndd_phenotype] || 'secondary'"
          class="d-inline-flex align-items-center"
        >
          <i :class="`bi bi-${ndd_icon[entity_info.ndd_phenotype] || 'question'} me-1`" />
          {{ entity_info.ndd_phenotype || 'N/A' }}
        </BBadge>
      </div>
    </BCol>
  </BRow>
</BCard>
```

**Source:** GeneBadge.vue, DiseaseBadge.vue, EntityBadge.vue, useColorAndSymbols.ts

### Pattern 2: Rich Contextual Modal Headers

**What:** Modal headers showing Gene | Disease | Inheritance | Category with colorAndSymbols icons
**When to use:** All 4 modals (rename, deactivate, modify review, modify status)
**Example:**
```vue
<!-- Rename Modal with Rich Header -->
<BModal
  id="renameModal"
  ref="renameModal"
  size="lg"
  centered
  ok-title="Submit"
  no-close-on-esc
  no-close-on-backdrop
  header-bg-variant="dark"
  header-text-variant="light"
  @ok="submitEntityRename"
>
  <template #modal-title>
    <div class="d-flex flex-column gap-2">
      <h4 class="mb-0">
        Rename Entity Disease
        <EntityBadge
          :entity-id="entity_info.entity_id"
          variant="primary"
          size="md"
          class="ms-2"
        />
      </h4>
      <div class="d-flex flex-wrap gap-2 small">
        <!-- Gene -->
        <span class="d-flex align-items-center">
          <i class="bi bi-file-earmark-medical me-1" />
          <strong>{{ entity_info.symbol || 'N/A' }}</strong>
        </span>
        <span class="text-muted">|</span>

        <!-- Disease -->
        <span class="d-flex align-items-center text-truncate" style="max-width: 200px;">
          <i class="bi bi-clipboard2-pulse me-1" />
          {{ entity_info.disease_ontology_name || 'N/A' }}
        </span>
        <span class="text-muted">|</span>

        <!-- Inheritance -->
        <span class="d-flex align-items-center">
          <i class="bi bi-diagram-3 me-1" />
          {{ entity_info.hpo_mode_of_inheritance_term || 'N/A' }}
        </span>
        <span class="text-muted">|</span>

        <!-- Category -->
        <BBadge
          :variant="stoplights_style[entity_info.category] || 'secondary'"
          class="d-inline-flex align-items-center"
        >
          <i class="bi bi-stoplights me-1" />
          {{ entity_info.category || 'N/A' }}
        </BBadge>
      </div>
    </div>
  </template>

  <!-- Modal content -->
  <p class="my-4">Select a new disease name:</p>
  <BFormInput
    id="ontology-select"
    v-model="ontology_input"
    size="sm"
    placeholder="Enter Ontology ID (e.g., OMIM:123456)"
    required
  />
</BModal>
```

**Source:** BModal documentation, existing modal patterns in Review.vue, colorAndSymbols composable

### Pattern 3: BFormCheckbox with Switch Prop

**What:** Replace custom-control-switch CSS with BFormCheckbox switch prop
**When to use:** All checkbox toggles (deactivate modal, status modal)
**Example:**
```vue
<!-- BEFORE: Custom CSS (deprecated) -->
<div class="custom-control custom-switch">
  <input
    id="deactivateSwitch"
    v-model="deactivate_check"
    type="checkbox"
    button-variant="info"
    class="custom-control-input"
  >
  <label class="custom-control-label" for="deactivateSwitch">
    {{ deactivate_check ? "Yes" : "No" }}
  </label>
</div>

<!-- AFTER: BFormCheckbox with switch prop -->
<BFormCheckbox
  id="deactivateSwitch"
  v-model="deactivate_check"
  switch
  size="md"
>
  <strong>{{ deactivate_check ? "Yes" : "No" }}</strong>
</BFormCheckbox>
```

**Source:** Bootstrap-Vue-Next BFormCheckbox documentation, switch prop verified

### Pattern 4: Action Button Gating with Loading State

**What:** Disable action buttons until entity_loaded is true, show spinner during submission
**When to use:** All action buttons that depend on entity data
**Example:**
```vue
<!-- Action Buttons Card -->
<BCard
  v-if="entity_loaded && entity_info.entity_id"
  class="my-2"
  body-class="p-2"
  header-class="p-1"
  border-variant="dark"
>
  <template #header>
    <h6 class="mb-1 text-start font-weight-bold">
      2. Options to modify the selected entity
    </h6>
  </template>

  <BRow>
    <BCol class="my-1">
      <BButton
        size="sm"
        variant="dark"
        :disabled="!entity_loaded || submitting"
        @click="showEntityRename()"
      >
        <BSpinner v-if="submitting === 'rename'" small class="me-1" />
        <i v-else class="bi bi-pen" />
        <i class="bi bi-link" />
        Rename disease
      </BButton>
    </BCol>

    <BCol class="my-1">
      <BButton
        size="sm"
        variant="dark"
        :disabled="!entity_loaded || submitting"
        @click="showEntityDeactivate()"
      >
        <BSpinner v-if="submitting === 'deactivate'" small class="me-1" />
        <i v-else class="bi bi-x" />
        <i class="bi bi-link" />
        Deactivate entity
      </BButton>
    </BCol>

    <BCol class="my-1">
      <BButton
        size="sm"
        variant="dark"
        :disabled="!entity_loaded || submitting"
        @click="showReviewModify()"
      >
        <BSpinner v-if="submitting === 'review'" small class="me-1" />
        <i v-else class="bi bi-pen" />
        <i class="bi bi-clipboard-plus" />
        Modify review
      </BButton>
    </BCol>

    <BCol class="my-1">
      <BButton
        size="sm"
        variant="dark"
        :disabled="!entity_loaded || submitting"
        @click="showStatusModify()"
      >
        <BSpinner v-if="submitting === 'status'" small class="me-1" />
        <i v-else class="bi bi-pen" />
        <i class="bi bi-stoplights" />
        Modify status
      </BButton>
    </BCol>
  </BRow>
</BCard>

<script>
export default {
  data() {
    return {
      entity_loaded: false,
      submitting: null, // null | 'rename' | 'deactivate' | 'review' | 'status'
      // ... other data
    }
  },
  methods: {
    async submitEntityRename() {
      this.submitting = 'rename';
      try {
        // ... submission logic
      } finally {
        this.submitting = null;
      }
    }
  }
}
</script>
```

**Source:** BSpinner documentation, existing entity_loaded pattern in ModifyEntity.vue

### Anti-Patterns to Avoid

- **Using custom-control-switch CSS:** Deprecated Bootstrap 4 pattern, use BFormCheckbox with switch prop
- **Plain text entity display:** Loses visual hierarchy, use badge components for professional UX
- **Missing entity_loaded guards:** Allows actions before data ready, causes errors
- **Hardcoding category/status styles:** Use colorAndSymbols composable for consistency
- **Simple modal headers:** Missing context forces users to remember entity details

## Don't Hand-Roll

Problems that look simple but have existing solutions:

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Gene symbol display | Span with italic text | GeneBadge component | Consistent styling, 3D effects, hover states, HGNC link support, icon integration |
| Disease name display | Span with truncation | DiseaseBadge component | Truncation logic, tooltip with full name, ontology link support, consistent styling |
| Entity ID display | BBadge with text | EntityBadge component | Professional styling, color variants, link support, consistent formatting |
| Toggle switches | Custom CSS custom-control-switch | BFormCheckbox switch prop | Bootstrap-Vue-Next native, accessible, size variants, no deprecated CSS |
| Category/status styles | Inline style objects | colorAndSymbols composable | Centralized definitions, consistent across app, icon mappings included |
| Loading states | Disabled buttons only | BSpinner + disabled state | Visual feedback, accessible loading announcement, professional UX |

**Key insight:** Badge components handle visual hierarchy, hover effects, link generation, and accessibility that's tedious to implement consistently. Using them ensures professional UX across all entity displays. The colorAndSymbols composable centralizes style definitions used in 34+ files, maintaining consistency.

## Common Pitfalls

### Pitfall 1: BFormCheckbox Switch Prop Confusion

**What goes wrong:** Using `switches` prop instead of `switch` prop on individual BFormCheckbox, or forgetting size prop

**Why it happens:** Bootstrap-Vue-Next has both `switch` (singular, for BFormCheckbox) and `switches` (plural, for BFormCheckboxGroup)

**How to avoid:** Use `switch` prop on individual BFormCheckbox, `switches` prop only on BFormCheckboxGroup

**Warning signs:**
- Switch doesn't render with toggle styling
- Console warning about unknown prop
- Switch appears as regular checkbox

```vue
<!-- BAD: Wrong prop name -->
<BFormCheckbox switches>Toggle</BFormCheckbox>

<!-- BAD: Right prop, wrong component -->
<BFormCheckboxGroup switch>
  <BFormCheckbox>Option</BFormCheckbox>
</BFormCheckboxGroup>

<!-- GOOD: Correct usage -->
<BFormCheckbox switch size="md">
  Toggle Option
</BFormCheckbox>
```

**Source:** Bootstrap-Vue-Next BFormCheckbox documentation

### Pitfall 2: Entity Data Not Loaded Before Modal Opens

**What goes wrong:** Modal opens before entity_info is populated, shows "N/A" or null values in headers

**Why it happens:** showEntityRename() etc. call modal.show() before getEntity() promise resolves

**How to avoid:** Guard modal show calls with entity_loaded check, or await getEntity() before showing

**Warning signs:**
- Modal headers show "N/A" briefly then update
- Modal shows stale data from previous entity
- Test: Click action button immediately after selecting entity

```vue
<!-- BAD: No guard, opens immediately -->
<BButton @click="showEntityRename()">
  Rename
</BButton>

<script>
methods: {
  showEntityRename() {
    this.getEntity(); // Async, no await
    this.$refs.renameModal.show(); // Opens immediately
  }
}
</script>

<!-- GOOD: Guards with entity_loaded -->
<BButton
  :disabled="!entity_loaded"
  @click="showEntityRename()"
>
  Rename
</BButton>

<script>
methods: {
  async showEntityRename() {
    await this.getEntity(); // Wait for data
    if (!this.entity_info?.entity_id) {
      return; // Guard against missing data
    }
    this.$refs.renameModal.show();
  }
}
</script>
```

**Source:** Existing ModifyEntity.vue patterns (lines 977-989)

### Pitfall 3: Missing colorAndSymbols Destructuring

**What goes wrong:** Templates try to use `stoplights_style[category]` but it's undefined, badges show wrong colors

**Why it happens:** colorAndSymbols is returned as object from setup(), but properties not destructured

**How to avoid:** Destructure colorAndSymbols in setup() return or use `colorAndSymbols.stoplights_style` in template

**Warning signs:**
- Console error: "Cannot read property 'stoplights_style' of undefined"
- Badges show default variant instead of stoplight colors
- Category colors inconsistent with rest of app

```vue
<!-- BAD: colorAndSymbols not destructured -->
<script>
export default {
  setup() {
    const colorAndSymbols = useColorAndSymbols();
    return {
      // Not spreading colorAndSymbols properties
    };
  }
}
</script>

<template>
  <!-- This won't work -->
  <BBadge :variant="stoplights_style[category]">
</template>

<!-- GOOD: Destructured in return -->
<script>
export default {
  setup() {
    const colorAndSymbols = useColorAndSymbols();
    return {
      ...colorAndSymbols, // Spreads all properties
    };
  }
}
</script>

<template>
  <!-- Now stoplights_style is available -->
  <BBadge :variant="stoplights_style[category]">
</template>
```

**Source:** Existing ModifyEntity.vue setup() pattern (lines 617-624)

### Pitfall 4: Badge Component Link Props Not Set

**What goes wrong:** Badge components show as plain spans instead of clickable links, no hover effect

**Why it happens:** `link-to` prop not provided, or HGNC/ontology IDs missing from entity_info

**How to avoid:** Always provide link-to prop conditionally, check for ID existence

**Warning signs:**
- Badges don't change cursor on hover
- Clicking badge does nothing
- Missing 3D hover effect

```vue
<!-- BAD: No link-to prop -->
<GeneBadge
  :symbol="entity_info.symbol"
  :hgnc-id="entity_info.hgnc_id"
/>

<!-- BAD: link-to without ID check -->
<GeneBadge
  :symbol="entity_info.symbol"
  :hgnc-id="entity_info.hgnc_id"
  :link-to="`https://www.genenames.org/data/gene-symbol-report/#!/hgnc_id/${entity_info.hgnc_id}`"
/>
<!-- ^ Breaks if hgnc_id is null -->

<!-- GOOD: Conditional link-to -->
<GeneBadge
  :symbol="entity_info.symbol || 'N/A'"
  :hgnc-id="entity_info.hgnc_id"
  :link-to="entity_info.hgnc_id ? `https://www.genenames.org/data/gene-symbol-report/#!/hgnc_id/${entity_info.hgnc_id}` : null"
  size="md"
/>
```

**Source:** GeneBadge.vue, DiseaseBadge.vue prop definitions

### Pitfall 5: Modal Header Overflow with Long Disease Names

**What goes wrong:** Long disease names break modal header layout, cause horizontal scrolling

**Why it happens:** Disease names can be 50+ characters, modal header has fixed width

**How to avoid:** Use text-truncate with max-width, or let DiseaseBadge handle truncation

**Warning signs:**
- Modal header wraps awkwardly
- Horizontal scrollbar appears in modal header
- Layout breaks on mobile

```vue
<!-- BAD: No truncation -->
<template #modal-title>
  <div class="d-flex gap-2">
    <span>{{ entity_info.disease_ontology_name }}</span>
  </div>
</template>

<!-- GOOD: Truncated with max-width -->
<template #modal-title>
  <div class="d-flex flex-column gap-2">
    <h4>...</h4>
    <div class="d-flex flex-wrap gap-2 small">
      <span class="d-flex align-items-center text-truncate" style="max-width: 200px;">
        <i class="bi bi-clipboard2-pulse me-1" />
        {{ entity_info.disease_ontology_name || 'N/A' }}
      </span>
    </div>
  </div>
</template>

<!-- BEST: Use DiseaseBadge with maxLength -->
<template #modal-title>
  <div class="d-flex flex-column gap-2">
    <h4>...</h4>
    <div class="d-flex flex-wrap gap-2">
      <DiseaseBadge
        :name="entity_info.disease_ontology_name || 'N/A'"
        :ontology-id="entity_info.disease_ontology_id_version"
        :max-length="30"
        size="sm"
      />
    </div>
  </div>
</template>
```

**Source:** DiseaseBadge.vue maxLength prop, CSS text-truncate utility

## Code Examples

Verified patterns from official sources and codebase:

### Complete Enhanced Entity Preview Card (from Entity.vue pattern)
```vue
<!-- Source: Entity.vue lines 18-92, adapted for ModifyEntity -->
<BCard
  v-if="entity_loaded && entity_info.entity_id"
  class="my-2"
  body-class="p-3"
  header-class="p-2"
  border-variant="info"
>
  <template #header>
    <h6 class="mb-0 text-start font-weight-bold d-flex align-items-center">
      <i class="bi bi-info-circle me-2" />
      Selected Entity
      <EntityBadge
        :entity-id="entity_info.entity_id"
        variant="primary"
        size="md"
        class="ms-2"
      />
    </h6>
  </template>

  <BRow class="g-3">
    <BCol md="6">
      <div class="mb-2">
        <strong class="text-muted small d-block mb-1">Gene:</strong>
        <GeneBadge
          :symbol="entity_info.symbol || 'N/A'"
          :hgnc-id="entity_info.hgnc_id"
          :link-to="entity_info.hgnc_id ? `https://www.genenames.org/data/gene-symbol-report/#!/hgnc_id/${entity_info.hgnc_id}` : null"
          size="md"
        />
      </div>

      <div class="mb-2">
        <strong class="text-muted small d-block mb-1">Disease:</strong>
        <DiseaseBadge
          :name="entity_info.disease_ontology_name || 'N/A'"
          :ontology-id="entity_info.disease_ontology_id_version"
          :link-to="entity_info.disease_ontology_id_version ? `/Ontology/${entity_info.disease_ontology_id_version.replace(/_.+/g, '')}` : null"
          size="md"
          :max-length="40"
        />
      </div>
    </BCol>

    <BCol md="6">
      <div class="mb-2">
        <strong class="text-muted small d-block mb-1">Inheritance:</strong>
        <BBadge variant="info" class="d-inline-flex align-items-center">
          <i class="bi bi-diagram-3 me-1" />
          {{ entity_info.hpo_mode_of_inheritance_term || 'N/A' }}
        </BBadge>
      </div>

      <div class="mb-2">
        <strong class="text-muted small d-block mb-1">Category:</strong>
        <BBadge
          :variant="stoplights_style[entity_info.category] || 'secondary'"
          class="d-inline-flex align-items-center"
        >
          <i class="bi bi-stoplights me-1" />
          {{ entity_info.category || 'N/A' }}
        </BBadge>
      </div>

      <div class="mb-2">
        <strong class="text-muted small d-block mb-1">NDD Status:</strong>
        <BBadge
          :variant="ndd_icon_style[entity_info.ndd_phenotype] || 'secondary'"
          class="d-inline-flex align-items-center"
        >
          <i :class="`bi bi-${ndd_icon[entity_info.ndd_phenotype] || 'question'} me-1`" />
          {{ entity_info.ndd_phenotype || 'N/A' }}
        </BBadge>
      </div>
    </BCol>
  </BRow>
</BCard>
```

### BFormCheckbox with Switch Prop (from Bootstrap-Vue-Next docs)
```vue
<!-- Source: Bootstrap-Vue-Next BFormCheckbox documentation -->
<!-- Replace custom-control-switch CSS -->

<!-- Deactivate Modal Example -->
<div>
  <p class="my-2">1. Are you sure that you want to deactivate this entity?</p>

  <BFormCheckbox
    id="deactivateSwitch"
    v-model="deactivate_check"
    switch
    size="md"
  >
    <strong>{{ deactivate_check ? "Yes" : "No" }}</strong>
  </BFormCheckbox>
</div>

<div v-if="deactivate_check">
  <p class="my-2">2. Was this entity replaced by another one?</p>

  <BFormCheckbox
    id="replaceSwitch"
    v-model="replace_check"
    switch
    size="md"
  >
    <strong>{{ replace_check ? "Yes" : "No" }}</strong>
  </BFormCheckbox>
</div>

<!-- Status Modal Example -->
<BFormCheckbox
  id="removeSwitch"
  v-model="status_info.problematic"
  switch
  size="md"
>
  Suggest removal
</BFormCheckbox>
```

### Rich Modal Header Pattern (from Review.vue pattern)
```vue
<!-- Source: Review.vue lines 354-360, enhanced with colorAndSymbols -->
<BModal
  id="renameModal"
  ref="renameModal"
  size="lg"
  centered
  ok-title="Submit"
  no-close-on-esc
  no-close-on-backdrop
  header-bg-variant="dark"
  header-text-variant="light"
  @ok="submitEntityRename"
>
  <template #modal-title>
    <div class="d-flex flex-column gap-2">
      <h4 class="mb-0">
        Rename Entity Disease
        <EntityBadge
          :entity-id="entity_info.entity_id"
          variant="primary"
          size="md"
          class="ms-2"
        />
      </h4>
      <div class="d-flex flex-wrap gap-2 small">
        <!-- Gene -->
        <span class="d-flex align-items-center">
          <i class="bi bi-file-earmark-medical me-1" />
          <strong>{{ entity_info.symbol || 'N/A' }}</strong>
        </span>
        <span class="text-muted">|</span>

        <!-- Disease (truncated) -->
        <span class="d-flex align-items-center text-truncate" style="max-width: 200px;" :title="entity_info.disease_ontology_name">
          <i class="bi bi-clipboard2-pulse me-1" />
          {{ entity_info.disease_ontology_name || 'N/A' }}
        </span>
        <span class="text-muted">|</span>

        <!-- Inheritance -->
        <span class="d-flex align-items-center">
          <i class="bi bi-diagram-3 me-1" />
          {{ entity_info.hpo_mode_of_inheritance_term || 'N/A' }}
        </span>
        <span class="text-muted">|</span>

        <!-- Category with stoplight styling -->
        <BBadge
          :variant="stoplights_style[entity_info.category] || 'secondary'"
          class="d-inline-flex align-items-center"
        >
          <i class="bi bi-stoplights me-1" />
          {{ entity_info.category || 'N/A' }}
        </BBadge>
      </div>
    </div>
  </template>

  <p class="my-4">Select a new disease name:</p>
  <BFormInput
    id="ontology-select"
    v-model="ontology_input"
    size="sm"
    placeholder="Enter Ontology ID (e.g., OMIM:123456)"
    required
  />
</BModal>
```

### Action Button Gating with BSpinner
```vue
<!-- Source: BSpinner documentation + existing entity_loaded pattern -->
<BCard
  v-if="entity_loaded && entity_info.entity_id"
  class="my-2"
  body-class="p-2"
  header-class="p-1"
  border-variant="dark"
>
  <template #header>
    <h6 class="mb-1 text-start font-weight-bold">
      2. Options to modify the selected entity
    </h6>
  </template>

  <BRow>
    <BCol class="my-1">
      <BButton
        size="sm"
        variant="dark"
        :disabled="!entity_loaded || submitting"
        @click="showEntityRename()"
      >
        <BSpinner v-if="submitting === 'rename'" small class="me-1" />
        <i v-else class="bi bi-pen" />
        <i class="bi bi-link" />
        Rename disease
      </BButton>
    </BCol>

    <BCol class="my-1">
      <BButton
        size="sm"
        variant="dark"
        :disabled="!entity_loaded || submitting"
        @click="showEntityDeactivate()"
      >
        <BSpinner v-if="submitting === 'deactivate'" small class="me-1" />
        <i v-else class="bi bi-x" />
        <i class="bi bi-link" />
        Deactivate entity
      </BButton>
    </BCol>

    <BCol class="my-1">
      <BButton
        size="sm"
        variant="dark"
        :disabled="!entity_loaded || submitting"
        @click="showReviewModify()"
      >
        <BSpinner v-if="submitting === 'review'" small class="me-1" />
        <i v-else class="bi bi-pen" />
        <i class="bi bi-clipboard-plus" />
        Modify review
      </BButton>
    </BCol>

    <BCol class="my-1">
      <BButton
        size="sm"
        variant="dark"
        :disabled="!entity_loaded || submitting"
        @click="showStatusModify()"
      >
        <BSpinner v-if="submitting === 'status'" small class="me-1" />
        <i v-else class="bi bi-pen" />
        <i class="bi bi-stoplights" />
        Modify status
      </BButton>
    </BCol>
  </BRow>
</BCard>

<script>
export default {
  data() {
    return {
      entity_loaded: false,
      submitting: null, // null | 'rename' | 'deactivate' | 'review' | 'status'
    }
  },
  methods: {
    async submitEntityRename() {
      this.submitting = 'rename';
      try {
        const apiUrl = `${import.meta.env.VITE_API_URL}/api/entity/rename`;
        const response = await this.axios.post(apiUrl, { rename_json: submission });
        this.makeToast('Entity renamed successfully', 'Success', 'success');
      } catch (e) {
        this.makeToast(e, 'Error', 'danger');
      } finally {
        this.submitting = null;
      }
    }
  }
}
</script>
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| Plain text entity display | Badge components (GeneBadge, DiseaseBadge) | Phase 13 (Mixin to Composable) | Professional styling, consistent UX |
| custom-control-switch CSS | BFormCheckbox switch prop | Bootstrap-Vue-Next 0.42.0 | Native Bootstrap-Vue-Next, no deprecated CSS |
| Simple modal titles | Rich contextual headers with entity info | Phase 35.1 (this phase) | Better context, less cognitive load |
| Hardcoded category/status styles | colorAndSymbols composable | Phase 13 (Mixin to Composable) | Centralized, consistent across 34+ files |
| Always-enabled action buttons | entity_loaded gating + BSpinner | Phase 35.1 (this phase) | Better UX, prevents errors |

**Deprecated/outdated:**
- **custom-control-switch CSS:** Bootstrap 4 pattern, replaced by BFormCheckbox switch prop in Bootstrap-Vue-Next
- **Inline style objects for badges:** Replaced by colorAndSymbols composable for consistency
- **Plain text entity display:** Replaced by badge components for professional UX

**Current state (2026):**
- Bootstrap-Vue-Next v0.42.0 fully supports switch prop on BFormCheckbox
- Badge components (GeneBadge, DiseaseBadge, EntityBadge) provide consistent entity display across app
- colorAndSymbols composable used in 34+ files for centralized style definitions
- BSpinner is Bootstrap-Vue-Next native loading indicator with accessible announcements

## Open Questions

1. **Entity API Response Fields**
   - What we know: entity_info has entity_id, hgnc_id, disease_ontology_id_version, hpo_mode_of_inheritance_term, is_active
   - What's unclear: Does entity API include symbol, disease_ontology_name, category, ndd_phenotype fields?
   - Recommendation: Check API response structure, may need to fetch gene/disease details separately or join in API

2. **Category Field Mapping**
   - What we know: colorAndSymbols.stoplights_style maps 1→success, 2→primary, 3→warning, 4→danger
   - What's unclear: What field in entity_info contains category? Is it numeric or string?
   - Recommendation: Check API response for category_id or category field, map to stoplights_style

3. **NDD Phenotype Field Format**
   - What we know: colorAndSymbols.ndd_icon maps "Yes"→check, "No"→x
   - What's unclear: Is entity_info.ndd_phenotype "Yes"/"No" or 0/1 or boolean?
   - Recommendation: Check API response format, may need to convert numeric to string for icon lookup

4. **Submission Loading States**
   - What we know: Modals have :busy prop for loading overlay
   - What's unclear: Should action buttons also show loading during modal operations?
   - Recommendation: Use submitting state for action buttons, :busy prop for modal overlays (dual indication)

## Sources

### Primary (HIGH confidence)
- Codebase: `/app/src/components/ui/GeneBadge.vue` - Gene badge component with HGNC link
- Codebase: `/app/src/components/ui/DiseaseBadge.vue` - Disease badge component with ontology link
- Codebase: `/app/src/components/ui/EntityBadge.vue` - Entity ID badge component
- Codebase: `/app/src/composables/useColorAndSymbols.ts` - Style/icon mappings (stoplights, NDD, inheritance)
- Codebase: `/app/src/views/curate/ModifyEntity.vue` - Current implementation patterns
- Codebase: `/app/src/views/pages/Entity.vue` - Badge component usage examples
- [Bootstrap-Vue-Next BFormCheckbox](https://bootstrap-vue-next.github.io/bootstrap-vue-next/docs/components/form-checkbox) - switch prop documentation
- [Bootstrap-Vue-Next BModal](https://bootstrap-vue-next.github.io/bootstrap-vue-next/docs/components/modal) - modal-title slot pattern
- [Bootstrap-Vue-Next BSpinner](https://bootstrap-vue-next.github.io/bootstrap-vue-next/docs/components/spinner) - Loading indicator component

### Secondary (MEDIUM confidence)
- [Form Checkbox | BootstrapVueNext](https://bootstrap-vue-next.github.io/bootstrap-vue-next/docs/components/form-checkbox) - Switch prop verified
- [Medium: Vue 3 Best Practices](https://medium.com/@ignatovich.dm/vue-3-best-practices-cb0a6e281ef4) - Component design principles
- [DEV: Vue 3 Best Practices](https://dev.to/adnanbabakan/vue-3-best-practices-write-a-better-code-2abc) - Best practices guidance
- Codebase: `/app/package.json` - Bootstrap-Vue-Next version 0.42.0 confirmed

### Tertiary (LOW confidence)
- [Medium: BootstrapVue Switch Style Checkboxes](https://medium.com/javascript-in-plain-english/bootstrapvue-switch-style-checkboxes-6a931bc57aa4) - Bootstrap-Vue (Vue 2) pattern, outdated but conceptually relevant

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - All components verified in codebase and Bootstrap-Vue-Next docs v0.42.0
- Architecture: HIGH - Patterns based on existing badge components, colorAndSymbols composable, and modal patterns in Review.vue
- Pitfalls: HIGH - Based on existing ModifyEntity.vue implementation, BFormCheckbox documentation, and common Vue 3 patterns

**Research date:** 2026-01-26
**Valid until:** ~2026-03-26 (60 days - stable stack, unlikely breaking changes)

**Bootstrap-Vue-Next specifics:**
- Version in codebase: 0.42.0
- Last checked: 2026-01-26
- switch prop confirmed available on BFormCheckbox
- Badge components already implemented in codebase
- colorAndSymbols composable already used in 34+ files
