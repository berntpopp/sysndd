---
phase: 35.1-modifyentity-ux-overhaul
plan: 02
type: execute
wave: 2
depends_on:
  - 35.1-01
files_modified:
  - app/src/views/curate/ModifyEntity.vue
autonomous: true

must_haves:
  truths:
    - "All 4 modal headers show Gene | Disease | Inheritance | Category context"
    - "Deactivate modal uses BFormCheckbox with switch prop"
    - "Status modal uses BFormCheckbox with switch prop"
    - "No custom-control-switch CSS classes in file"
    - "Action buttons disabled until entity_loaded is true"
    - "Action buttons show BSpinner during submission"
  artifacts:
    - path: "app/src/views/curate/ModifyEntity.vue"
      provides: "Rich modal headers, modernized switches, loading states"
      contains: "BFormCheckbox"
  key_links:
    - from: "app/src/views/curate/ModifyEntity.vue modal headers"
      to: "entity_info"
      via: "template interpolation"
      pattern: "entity_info\\.symbol|entity_info\\.disease_ontology_name"
    - from: "action buttons"
      to: "submitting state"
      via: "disabled binding and BSpinner conditional"
      pattern: ":disabled=\"!entity_loaded \\|\\| submitting\""
---

<objective>
Modernize ModifyEntity.vue modal headers, form switches, and action button loading states

Purpose: Complete the UX overhaul by upgrading all 4 modal headers to show rich entity context (Gene | Disease | Inheritance | Category), replacing deprecated custom-control-switch CSS with BFormCheckbox switch prop, and adding proper loading states to action buttons.

Output: ModifyEntity.vue with rich contextual modal headers, Bootstrap-Vue-Next native switches, and professional loading indicators during submission.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35.1-modifyentity-ux-overhaul/35.1-RESEARCH.md
@.planning/phases/35.1-modifyentity-ux-overhaul/35.1-01-SUMMARY.md

# Current implementation (after Plan 01)
@app/src/views/curate/ModifyEntity.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add submitting state and update action buttons with loading indicators</name>
  <files>app/src/views/curate/ModifyEntity.vue</files>
  <action>
  1. Add submitting state to data():
     ```javascript
     submitting: null, // null | 'rename' | 'deactivate' | 'review' | 'status'
     ```

  2. Update the 4 action buttons in the "Options to modify" card to:
     - Add `:disabled="!entity_loaded || submitting"` binding
     - Add BSpinner when submitting matches the action type
     - Use conditional icon display

     Replace the BRow with action buttons (around lines 118-166) with:

     ```vue
     <BRow>
       <BCol class="my-1">
         <BButton
           size="sm"
           variant="dark"
           :disabled="!entity_loaded || submitting"
           @click="showEntityRename()"
         >
           <BSpinner v-if="submitting === 'rename'" small class="me-1" />
           <template v-else>
             <i class="bi bi-pen" />
             <i class="bi bi-link" />
           </template>
           Rename disease
         </BButton>
       </BCol>

       <BCol class="my-1">
         <BButton
           size="sm"
           variant="dark"
           :disabled="!entity_loaded || submitting"
           @click="showEntityDeactivate()"
         >
           <BSpinner v-if="submitting === 'deactivate'" small class="me-1" />
           <template v-else>
             <i class="bi bi-x" />
             <i class="bi bi-link" />
           </template>
           Deactivate entity
         </BButton>
       </BCol>

       <BCol class="my-1">
         <BButton
           size="sm"
           variant="dark"
           :disabled="!entity_loaded || submitting"
           @click="showReviewModify()"
         >
           <BSpinner v-if="submitting === 'review'" small class="me-1" />
           <template v-else>
             <i class="bi bi-pen" />
             <i class="bi bi-clipboard-plus" />
           </template>
           Modify review
         </BButton>
       </BCol>

       <BCol class="my-1">
         <BButton
           size="sm"
           variant="dark"
           :disabled="!entity_loaded || submitting"
           @click="showStatusModify()"
         >
           <BSpinner v-if="submitting === 'status'" small class="me-1" />
           <template v-else>
             <i class="bi bi-pen" />
             <i class="bi bi-stoplights" />
           </template>
           Modify status
         </BButton>
       </BCol>
     </BRow>
     ```

  3. Update submit methods to set/clear submitting state:

     In submitEntityRename():
     ```javascript
     async submitEntityRename() {
       this.submitting = 'rename';
       // ... existing try/catch/finally
       // Add finally block to clear submitting:
       this.submitting = null;
     }
     ```

     Similarly update:
     - submitEntityDeactivation(): set 'deactivate', clear in finally
     - submitReviewChange(): set 'review', clear in finally
     - submitStatusChange(): set 'status', clear in finally

     Each submit method should have this pattern:
     ```javascript
     async submitXxx() {
       this.submitting = 'xxx';
       try {
         // existing submission logic
       } catch (e) {
         this.makeToast(e, 'Error', 'danger');
       } finally {
         this.submitting = null;
       }
     }
     ```
  </action>
  <verify>
  1. Search for "submitting:" in data() section
  2. Search for ":disabled=\"!entity_loaded" in template
  3. Search for 'BSpinner v-if="submitting' in template
  4. Search for "this.submitting = null" in methods
  </verify>
  <done>Action buttons disabled until entity_loaded, show BSpinner during submission, submitting state cleared after completion</done>
</task>

<task type="auto">
  <name>Task 2: Replace custom-control-switch CSS with BFormCheckbox switch prop</name>
  <files>app/src/views/curate/ModifyEntity.vue</files>
  <action>
  Replace all 3 instances of custom-control-switch CSS pattern with BFormCheckbox switch prop.

  1. In Deactivate Modal - first switch (lines ~235-249):
     Replace:
     ```vue
     <div class="custom-control custom-switch">
       <input
         id="deactivateSwitch"
         v-model="deactivate_check"
         type="checkbox"
         button-variant="info"
         class="custom-control-input"
       >
       <label
         class="custom-control-label"
         for="deactivateSwitch"
       >
         {{ deactivate_check ? "Yes" : "No" }}
       </label>
     </div>
     ```
     With:
     ```vue
     <BFormCheckbox
       id="deactivateSwitch"
       v-model="deactivate_check"
       switch
       size="md"
     >
       <strong>{{ deactivate_check ? "Yes" : "No" }}</strong>
     </BFormCheckbox>
     ```

  2. In Deactivate Modal - second switch (lines ~257-271):
     Replace:
     ```vue
     <div class="custom-control custom-switch">
       <input
         id="replaceSwitch"
         v-model="replace_check"
         type="checkbox"
         button-variant="info"
         class="custom-control-input"
       >
       <label
         class="custom-control-label"
         for="replaceSwitch"
       >
         {{ replace_check ? "Yes" : "No" }}
       </label>
     </div>
     ```
     With:
     ```vue
     <BFormCheckbox
       id="replaceSwitch"
       v-model="replace_check"
       switch
       size="md"
     >
       <strong>{{ replace_check ? "Yes" : "No" }}</strong>
     </BFormCheckbox>
     ```

  3. In Status Modal - problematic switch (lines ~565-577):
     Replace:
     ```vue
     <div class="custom-control custom-switch">
       <input
         id="removeSwitch"
         v-model="status_info.problematic"
         type="checkbox"
         button-variant="info"
         class="custom-control-input"
       >
       <label
         class="custom-control-label"
         for="removeSwitch"
       >Suggest removal</label>
     </div>
     ```
     With:
     ```vue
     <BFormCheckbox
       id="removeSwitch"
       v-model="status_info.problematic"
       switch
       size="md"
     >
       Suggest removal
     </BFormCheckbox>
     ```
  </action>
  <verify>
  1. Run: `grep -c "custom-control-switch" app/src/views/curate/ModifyEntity.vue` - should return 0
  2. Run: `grep -c "BFormCheckbox" app/src/views/curate/ModifyEntity.vue` - should return 3 or more
  3. Run: `grep "switch" app/src/views/curate/ModifyEntity.vue | grep BFormCheckbox` - should show switch prop usage
  </verify>
  <done>All 3 toggle switches use BFormCheckbox with switch prop, no custom-control-switch CSS remains</done>
</task>

<task type="auto">
  <name>Task 3: Upgrade all 4 modal headers to rich contextual format</name>
  <files>app/src/views/curate/ModifyEntity.vue</files>
  <action>
  Update all 4 modal #modal-title slots to show Gene | Disease | Inheritance | Category context.

  Create a reusable modal header pattern and apply to all 4 modals.

  1. Rename Modal (around line 185-191):
     Replace:
     ```vue
     <template #modal-title>
       <h4>
         Rename entity disease:
         <BBadge variant="primary">
           sysndd:{{ entity_info.entity_id }}
         </BBadge>
       </h4>
     </template>
     ```
     With:
     ```vue
     <template #modal-title>
       <div class="d-flex flex-column gap-2">
         <h4 class="mb-0">
           Rename Entity Disease
           <EntityBadge
             :entity-id="entity_info.entity_id"
             variant="primary"
             size="md"
             class="ms-2"
           />
         </h4>
         <div class="d-flex flex-wrap gap-2 small">
           <span class="d-flex align-items-center">
             <i class="bi bi-file-earmark-medical me-1" />
             <strong>{{ entity_info.symbol || 'N/A' }}</strong>
           </span>
           <span class="text-muted">|</span>
           <span class="d-flex align-items-center text-truncate" style="max-width: 200px;" :title="entity_info.disease_ontology_name">
             <i class="bi bi-clipboard2-pulse me-1" />
             {{ entity_info.disease_ontology_name || 'N/A' }}
           </span>
           <span class="text-muted">|</span>
           <span class="d-flex align-items-center">
             <i class="bi bi-diagram-3 me-1" />
             {{ entity_info.hpo_mode_of_inheritance_term_name || entity_info.hpo_mode_of_inheritance_term || 'N/A' }}
           </span>
           <span class="text-muted">|</span>
           <BBadge
             :variant="stoplights_style[entity_info.category] || 'secondary'"
             class="d-inline-flex align-items-center"
           >
             <i class="bi bi-stoplights me-1" />
             {{ entity_info.category || 'N/A' }}
           </BBadge>
         </div>
       </div>
     </template>
     ```

  2. Deactivate Modal (around line 221-227):
     Apply same pattern with title "Deactivate Entity"

  3. Modify Review Modal (around line 305-312):
     Apply same pattern with title "Modify Review"

  4. Modify Status Modal (around line 521-527):
     Apply same pattern with title "Modify Status"

  Each modal header should have:
  - Title with EntityBadge showing entity ID
  - Context row with: Gene icon + symbol | Disease icon + name (truncated) | Inheritance icon + term | Category badge with stoplight color
  </action>
  <verify>
  1. Count EntityBadge in modal headers: `grep -c "EntityBadge" app/src/views/curate/ModifyEntity.vue` - should be 5 (1 in preview + 4 in modals)
  2. Search for Gene|Disease pattern: `grep "text-muted.*|" app/src/views/curate/ModifyEntity.vue` - should find separator patterns
  3. Verify stoplights_style in modal headers: `grep -c "stoplights_style\[entity_info.category\]" app/src/views/curate/ModifyEntity.vue` - should be 5 (1 preview + 4 modals)
  </verify>
  <done>All 4 modal headers show rich context: Gene | Disease | Inheritance | Category with appropriate icons and stoplight colors</done>
</task>

</tasks>

<verification>
1. Run linter: `npm run lint --prefix /home/bernt-popp/development/sysndd/app`
2. Verify no custom-control-switch: `grep -c "custom-control-switch" app/src/views/curate/ModifyEntity.vue` - should be 0
3. Verify BFormCheckbox switch usage: `grep "BFormCheckbox" app/src/views/curate/ModifyEntity.vue | grep -c "switch"` - should be 3
4. Verify submitting state: `grep "submitting" app/src/views/curate/ModifyEntity.vue | head -5`
5. Verify modal header pattern: `grep -c "d-flex flex-column gap-2" app/src/views/curate/ModifyEntity.vue` - should be 4 (one per modal)
6. Verify action button disabling: `grep ":disabled=\"!entity_loaded" app/src/views/curate/ModifyEntity.vue` - should find 4 buttons
</verification>

<success_criteria>
- All 4 modal headers display Gene | Disease | Inheritance | Category context
- Category badges in headers use stoplights_style coloring
- All toggle switches use BFormCheckbox with switch prop
- No custom-control-switch CSS classes remain in file
- Action buttons disabled when entity not loaded or submission in progress
- BSpinner shows in action button during its respective submission
- No linting errors
</success_criteria>

<output>
After completion, create `.planning/phases/35.1-modifyentity-ux-overhaul/35.1-02-SUMMARY.md`
</output>
