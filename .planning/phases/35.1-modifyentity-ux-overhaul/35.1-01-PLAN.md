---
phase: 35.1-modifyentity-ux-overhaul
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/src/views/curate/ModifyEntity.vue
autonomous: true

must_haves:
  truths:
    - "Entity preview card shows gene symbol with HGNC link"
    - "Entity preview card shows disease name with ontology link"
    - "Entity preview card shows inheritance mode with icon"
    - "Entity preview card shows category with stoplight color"
    - "Entity preview card shows NDD status with icon"
  artifacts:
    - path: "app/src/views/curate/ModifyEntity.vue"
      provides: "Enhanced entity preview with badge components"
      contains: "GeneBadge"
  key_links:
    - from: "app/src/views/curate/ModifyEntity.vue"
      to: "GeneBadge, DiseaseBadge, EntityBadge"
      via: "component import and usage"
      pattern: "GeneBadge|DiseaseBadge|EntityBadge"
    - from: "app/src/views/curate/ModifyEntity.vue"
      to: "colorAndSymbols"
      via: "composable destructuring"
      pattern: "stoplights_style|ndd_icon"
---

<objective>
Enhance ModifyEntity.vue entity preview card with professional badge components and colorAndSymbols icons

Purpose: The current entity preview shows only plain text. Users need rich visual context showing gene symbol (with HGNC link), disease name (with ontology link), inheritance mode, category stoplight, and NDD status to quickly understand the entity they're modifying.

Output: ModifyEntity.vue entity preview card using GeneBadge, DiseaseBadge, EntityBadge components with colorAndSymbols integration for category and NDD status display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35.1-modifyentity-ux-overhaul/35.1-RESEARCH.md

# Existing badge components and patterns
@app/src/components/ui/GeneBadge.vue
@app/src/components/ui/DiseaseBadge.vue
@app/src/components/ui/EntityBadge.vue
@app/src/composables/useColorAndSymbols.ts

# Current implementation
@app/src/views/curate/ModifyEntity.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Store full API response for enhanced preview data</name>
  <files>app/src/views/curate/ModifyEntity.vue</files>
  <action>
  Update getEntity() method to store the full API response object instead of only the Entity class fields.

  The API response includes: symbol, disease_ontology_name, category, ndd_phenotype_word, hpo_mode_of_inheritance_term_name - all needed for the enhanced preview.

  Changes:
  1. In data(), change entity_info initialization to just empty object: `entity_info: {}`
  2. In getEntity() method, store the full entity object from response:
     ```javascript
     const entity = entityData[0];
     this.entity_info = entity; // Store full object, not just Entity class
     ```
  3. Keep the existing error handling that sets entity_info to new Entity() on failure

  NOTE: The Entity class is still needed for submission (rename, deactivate). The submission methods will use the relevant fields from entity_info as needed.
  </action>
  <verify>Search ModifyEntity.vue for "this.entity_info = entity" to confirm full object storage</verify>
  <done>getEntity() stores full API response with symbol, disease_ontology_name, category, ndd_phenotype_word fields accessible</done>
</task>

<task type="auto">
  <name>Task 2: Import badge components and enhance entity preview card</name>
  <files>app/src/views/curate/ModifyEntity.vue</files>
  <action>
  1. Add imports for badge components at top of script section:
     ```javascript
     import GeneBadge from '@/components/ui/GeneBadge.vue';
     import DiseaseBadge from '@/components/ui/DiseaseBadge.vue';
     import EntityBadge from '@/components/ui/EntityBadge.vue';
     ```

  2. Register components:
     ```javascript
     components: {
       TreeMultiSelect,
       AutocompleteInput,
       GeneBadge,
       DiseaseBadge,
       EntityBadge,
     },
     ```

  3. Destructure ndd_icon from colorAndSymbols in setup() return (stoplights_style and ndd_icon_style already available):
     - Already spreads colorAndSymbols with `...colorAndSymbols` so ndd_icon, ndd_icon_style, stoplights_style are available

  4. Replace the Entity Preview Card (lines 62-103) with enhanced version:

     ```vue
     <!-- Entity Preview Card -->
     <BCard
       v-if="entity_loaded && entity_info.entity_id"
       class="my-2"
       body-class="p-3"
       header-class="p-2"
       border-variant="info"
     >
       <template #header>
         <h6 class="mb-0 text-start font-weight-bold d-flex align-items-center">
           <i class="bi bi-info-circle me-2" />
           Selected Entity
           <EntityBadge
             :entity-id="entity_info.entity_id"
             variant="primary"
             size="md"
             class="ms-2"
           />
         </h6>
       </template>

       <BRow class="g-3">
         <BCol md="6">
           <!-- Gene with badge and HGNC link -->
           <div class="mb-2">
             <strong class="text-muted small d-block mb-1">Gene:</strong>
             <GeneBadge
               :symbol="entity_info.symbol || 'N/A'"
               :hgnc-id="entity_info.hgnc_id"
               :link-to="entity_info.hgnc_id ? `https://www.genenames.org/data/gene-symbol-report/#!/hgnc_id/${entity_info.hgnc_id}` : null"
               size="md"
             />
           </div>

           <!-- Disease with badge and ontology link -->
           <div class="mb-2">
             <strong class="text-muted small d-block mb-1">Disease:</strong>
             <DiseaseBadge
               :name="entity_info.disease_ontology_name || 'N/A'"
               :ontology-id="entity_info.disease_ontology_id_version"
               :link-to="entity_info.disease_ontology_id_version ? `/Ontology/${entity_info.disease_ontology_id_version.replace(/_.+/g, '')}` : null"
               size="md"
               :max-length="40"
             />
           </div>
         </BCol>

         <BCol md="6">
           <!-- Inheritance with icon -->
           <div class="mb-2">
             <strong class="text-muted small d-block mb-1">Inheritance:</strong>
             <BBadge variant="info" class="d-inline-flex align-items-center">
               <i class="bi bi-diagram-3 me-1" />
               {{ entity_info.hpo_mode_of_inheritance_term_name || entity_info.hpo_mode_of_inheritance_term || 'N/A' }}
             </BBadge>
           </div>

           <!-- Category with stoplight style -->
           <div class="mb-2">
             <strong class="text-muted small d-block mb-1">Category:</strong>
             <BBadge
               :variant="stoplights_style[entity_info.category] || 'secondary'"
               class="d-inline-flex align-items-center"
             >
               <i class="bi bi-stoplights me-1" />
               {{ entity_info.category || 'N/A' }}
             </BBadge>
           </div>

           <!-- NDD Status with icon -->
           <div class="mb-2">
             <strong class="text-muted small d-block mb-1">NDD Status:</strong>
             <BBadge
               :variant="ndd_icon_style[entity_info.ndd_phenotype_word] || 'secondary'"
               class="d-inline-flex align-items-center"
             >
               <i :class="`bi bi-${ndd_icon[entity_info.ndd_phenotype_word] || 'question'} me-1`" />
               {{ entity_info.ndd_phenotype_word || 'N/A' }}
             </BBadge>
           </div>
         </BCol>
       </BRow>
     </BCard>
     ```
  </action>
  <verify>
  1. Run `npm run lint --prefix /home/bernt-popp/development/sysndd/app` - no errors
  2. Search for "GeneBadge" in ModifyEntity.vue - should find import and usage
  3. Search for "stoplights_style" in template - should find category badge usage
  </verify>
  <done>Entity preview card displays GeneBadge with HGNC link, DiseaseBadge with ontology link, inheritance icon, category stoplight, and NDD status icon</done>
</task>

</tasks>

<verification>
1. Run linter: `npm run lint --prefix /home/bernt-popp/development/sysndd/app`
2. Verify badge component imports: `grep -n "GeneBadge\|DiseaseBadge\|EntityBadge" app/src/views/curate/ModifyEntity.vue`
3. Verify colorAndSymbols usage: `grep -n "stoplights_style\|ndd_icon" app/src/views/curate/ModifyEntity.vue`
4. Verify full entity storage: `grep -n "this.entity_info = entity" app/src/views/curate/ModifyEntity.vue`
</verification>

<success_criteria>
- Entity preview card visible when entity is loaded
- Gene symbol displays with GeneBadge component and clickable HGNC link
- Disease name displays with DiseaseBadge component and clickable ontology link
- Inheritance mode displays with diagram icon
- Category displays with stoplight-colored badge
- NDD status displays with check/x icon
- No linting errors
</success_criteria>

<output>
After completion, create `.planning/phases/35.1-modifyentity-ux-overhaul/35.1-01-SUMMARY.md`
</output>
