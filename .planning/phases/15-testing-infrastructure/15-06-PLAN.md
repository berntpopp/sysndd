---
phase: 15-testing-infrastructure
plan: 06
type: execute
wave: 2
depends_on: ["15-01", "15-02"]
files_modified:
  - app/package.json
  - app/vitest.setup.ts
  - app/src/test-utils/a11y-helpers.ts
  - app/src/test-utils/index.ts
  - app/src/components/small/FooterNavItem.a11y.spec.ts
  - app/src/components/small/Banner.a11y.spec.ts
  - app/src/components/Footer.a11y.spec.ts
autonomous: true

must_haves:
  truths:
    - "Accessibility tests pass with npm run test:unit"
    - "vitest-axe toHaveNoViolations matcher works"
    - "Helper function simplifies accessibility testing"
  artifacts:
    - path: "app/src/test-utils/a11y-helpers.ts"
      provides: "expectNoA11yViolations helper function"
      contains: "axe"
    - path: "app/src/components/small/Banner.a11y.spec.ts"
      provides: "Example accessibility test for interactive component"
      contains: "toHaveNoViolations"
  key_links:
    - from: "app/vitest.setup.ts"
      to: "vitest-axe"
      via: "expect.extend"
      pattern: "toHaveNoViolations"
---

<objective>
Set up accessibility testing with vitest-axe and create example accessibility tests.

Purpose: Enable automated WCAG 2.2 accessibility validation for interactive components.
Output: vitest-axe configured, a11y helper created, 3 accessibility test examples.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-testing-infrastructure/15-CONTEXT.md
@.planning/phases/15-testing-infrastructure/15-RESEARCH.md
@app/package.json
@app/vitest.setup.ts
@app/src/test-utils/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install vitest-axe</name>
  <files>app/package.json</files>
  <action>
Install vitest-axe for accessibility testing:

```bash
cd app && npm install --save-dev vitest-axe
```

vitest-axe is a fork of jest-axe adapted for Vitest. It uses axe-core under the hood,
which can automatically detect approximately 57% of WCAG issues.

CRITICAL: vitest-axe requires jsdom environment (not happy-dom). This was already
configured in 15-01-PLAN.md.
  </action>
  <verify>
Run `npm list vitest-axe` to confirm installation.
  </verify>
  <done>vitest-axe installed in devDependencies</done>
</task>

<task type="auto">
  <name>Task 2: Configure vitest-axe in Setup File</name>
  <files>app/vitest.setup.ts</files>
  <action>
Update `app/vitest.setup.ts` to extend expect with vitest-axe matchers.

Add at the top of the file (after existing imports):

```typescript
// Accessibility testing matchers
import { toHaveNoViolations } from 'vitest-axe';

// Extend Vitest expect with accessibility matchers
expect.extend(toHaveNoViolations);
```

Remove the placeholder comment that was added in 15-01 about vitest-axe.

The complete vitest.setup.ts should now have:
1. vitest-axe expect extension
2. Browser API mocks (matchMedia, localStorage)
3. Per-test cleanup
4. MSW server lifecycle
  </action>
  <verify>
Run `npx tsc --noEmit -p tsconfig.json` - no TypeScript errors.
Run `npm run test:unit` - should complete without vitest-axe errors.
  </verify>
  <done>vitest-axe matchers added to vitest.setup.ts</done>
</task>

<task type="auto">
  <name>Task 3: Create Accessibility Helper</name>
  <files>app/src/test-utils/a11y-helpers.ts, app/src/test-utils/index.ts</files>
  <action>
Create `app/src/test-utils/a11y-helpers.ts`:

```typescript
// test-utils/a11y-helpers.ts
/**
 * Accessibility testing helpers for WCAG 2.2 compliance.
 *
 * Uses axe-core via vitest-axe to detect accessibility violations.
 * axe-core can automatically detect ~57% of WCAG issues.
 *
 * @example
 * import { expectNoA11yViolations } from '@/test-utils';
 * import { mount } from '@vue/test-utils';
 *
 * it('has no accessibility violations', async () => {
 *   const wrapper = mount(MyComponent);
 *   await expectNoA11yViolations(wrapper.element);
 * });
 */

import { axe, toHaveNoViolations } from 'vitest-axe';
import { expect } from 'vitest';
import type { AxeResults, RunOptions, ElementContext } from 'axe-core';

// Ensure matchers are extended (also done in vitest.setup.ts)
expect.extend(toHaveNoViolations);

/**
 * Default axe configuration for WCAG 2.2 AA testing
 */
export const defaultAxeConfig: RunOptions = {
  rules: {
    // WCAG 2.2 AA rules
    // Some rules may need adjustment based on project needs
  },
};

/**
 * Run accessibility checks and assert no violations.
 *
 * @param element - DOM element to test
 * @param options - Optional axe configuration
 * @throws If accessibility violations are found
 *
 * @example
 * // Basic usage
 * await expectNoA11yViolations(wrapper.element);
 *
 * // With custom options
 * await expectNoA11yViolations(wrapper.element, {
 *   rules: { 'color-contrast': { enabled: false } }
 * });
 */
export async function expectNoA11yViolations(
  element: Element,
  options?: RunOptions
): Promise<void> {
  const config = { ...defaultAxeConfig, ...options };
  const results = await axe(element, config);
  expect(results).toHaveNoViolations();
}

/**
 * Run accessibility checks and return detailed results.
 * Use when you need to inspect violations without asserting.
 *
 * @param element - DOM element to test
 * @param options - Optional axe configuration
 * @returns axe-core results object
 */
export async function runAxe(
  element: Element,
  options?: RunOptions
): Promise<AxeResults> {
  const config = { ...defaultAxeConfig, ...options };
  return axe(element, config);
}

/**
 * Log accessibility violations in a readable format.
 * Useful for debugging failing accessibility tests.
 *
 * @param results - axe-core results object
 */
export function logViolations(results: AxeResults): void {
  if (results.violations.length === 0) {
    console.log('No accessibility violations found');
    return;
  }

  console.log(`Found ${results.violations.length} accessibility violations:`);
  results.violations.forEach((violation, index) => {
    console.log(`\n${index + 1}. ${violation.id}: ${violation.description}`);
    console.log(`   Impact: ${violation.impact}`);
    console.log(`   WCAG: ${violation.tags.filter(t => t.startsWith('wcag')).join(', ')}`);
    console.log(`   Help: ${violation.helpUrl}`);
    console.log(`   Affected elements:`);
    violation.nodes.forEach(node => {
      console.log(`     - ${node.target}`);
    });
  });
}

export default {
  expectNoA11yViolations,
  runAxe,
  logViolations,
  defaultAxeConfig,
};
```

Update `app/src/test-utils/index.ts` to export the accessibility helpers:

Add to the exports:

```typescript
export {
  expectNoA11yViolations,
  runAxe,
  logViolations,
  defaultAxeConfig,
} from './a11y-helpers';
```
  </action>
  <verify>
Run `npx tsc --noEmit -p tsconfig.json` - no TypeScript errors.
  </verify>
  <done>Accessibility helper created and exported from test-utils</done>
</task>

<task type="auto">
  <name>Task 4: Create Accessibility Test Examples</name>
  <files>app/src/components/small/FooterNavItem.a11y.spec.ts, app/src/components/small/Banner.a11y.spec.ts, app/src/components/Footer.a11y.spec.ts</files>
  <action>
Create accessibility tests for the example components.

Create `app/src/components/small/FooterNavItem.a11y.spec.ts`:

```typescript
// FooterNavItem.a11y.spec.ts
/**
 * Accessibility tests for FooterNavItem component
 *
 * Pattern: Basic accessibility testing
 * Tests WCAG 2.2 compliance using axe-core via vitest-axe.
 */

import { describe, it } from 'vitest';
import { mount } from '@vue/test-utils';
import FooterNavItem from './FooterNavItem.vue';
import { expectNoA11yViolations, bootstrapStubs } from '@/test-utils';

describe('FooterNavItem accessibility', () => {
  const defaultItem = {
    id: 'test-item',
    link: 'https://example.com',
    linkAttr: { 'aria-label': 'Example Link' },
    imgSrc: '/test-image.png',
    alt: 'Test Image Alt Text',
    width: 100,
    target: '_blank',
  };

  it('has no accessibility violations', async () => {
    const wrapper = mount(FooterNavItem, {
      props: { item: defaultItem },
      global: {
        stubs: bootstrapStubs,
      },
    });

    await expectNoA11yViolations(wrapper.element);
  });

  it('image has descriptive alt text', async () => {
    const wrapper = mount(FooterNavItem, {
      props: {
        item: {
          ...defaultItem,
          alt: 'Partner organization logo linking to their website',
        },
      },
      global: {
        stubs: bootstrapStubs,
      },
    });

    await expectNoA11yViolations(wrapper.element);
  });

  it('external links have appropriate rel attribute', async () => {
    const wrapper = mount(FooterNavItem, {
      props: {
        item: {
          ...defaultItem,
          target: '_blank',
        },
      },
      global: {
        stubs: bootstrapStubs,
      },
    });

    // The component adds rel="noopener" for security
    await expectNoA11yViolations(wrapper.element);
  });
});
```

Create `app/src/components/small/Banner.a11y.spec.ts`:

```typescript
// Banner.a11y.spec.ts
/**
 * Accessibility tests for Banner component
 *
 * Pattern: Interactive component accessibility testing
 * Tests alert/banner accessibility patterns per WCAG 2.2.
 */

import { describe, it, beforeEach } from 'vitest';
import { mount } from '@vue/test-utils';
import Banner from './Banner.vue';
import { expectNoA11yViolations, bootstrapStubs } from '@/test-utils';

describe('Banner accessibility', () => {
  beforeEach(() => {
    window.localStorage.clear();
  });

  it('has no accessibility violations when visible', async () => {
    const wrapper = mount(Banner, {
      global: {
        stubs: bootstrapStubs,
      },
    });

    await expectNoA11yViolations(wrapper.element);
  });

  it('alert role is present for screen readers', async () => {
    const wrapper = mount(Banner, {
      global: {
        stubs: bootstrapStubs,
      },
    });

    // The BAlert stub includes role="alert"
    await expectNoA11yViolations(wrapper.element);
  });

  it('dismiss button is keyboard accessible', async () => {
    const wrapper = mount(Banner, {
      global: {
        stubs: bootstrapStubs,
      },
    });

    // Button should be focusable and activatable
    const button = wrapper.find('button');

    // Keyboard accessibility check - button exists and is not hidden
    await expectNoA11yViolations(wrapper.element);
  });

  it('links are accessible', async () => {
    const wrapper = mount(Banner, {
      global: {
        stubs: bootstrapStubs,
      },
    });

    // External links should have appropriate attributes
    await expectNoA11yViolations(wrapper.element);
  });
});
```

Create `app/src/components/Footer.a11y.spec.ts`:

```typescript
// Footer.a11y.spec.ts
/**
 * Accessibility tests for Footer component
 *
 * Pattern: Navigation component accessibility testing
 * Tests navigation landmark and list structure per WCAG 2.2.
 */

import { describe, it, vi } from 'vitest';
import { mount, flushPromises } from '@vue/test-utils';
import Footer from './Footer.vue';
import { expectNoA11yViolations, bootstrapStubs } from '@/test-utils';

// Mock the constants
vi.mock('@/assets/js/constants/footer_nav_constants', () => ({
  default: {
    NAV_ITEMS: [
      {
        id: 'item1',
        link: 'https://example1.com',
        linkAttr: { 'aria-label': 'Partner 1' },
        imgSrc: '/image1.png',
        alt: 'Partner 1 Logo',
        width: 80,
        target: '_blank',
      },
      {
        id: 'item2',
        link: 'https://example2.com',
        linkAttr: { 'aria-label': 'Partner 2' },
        imgSrc: '/image2.png',
        alt: 'Partner 2 Logo',
        width: 80,
        target: '_blank',
      },
    ],
  },
}));

describe('Footer accessibility', () => {
  const mountComponent = async () => {
    const wrapper = mount(Footer, {
      global: {
        stubs: {
          ...bootstrapStubs,
          FooterNavItem: {
            name: 'FooterNavItem',
            props: ['item'],
            template: `
              <li>
                <a :href="item.link" :aria-label="item.linkAttr['aria-label']">
                  <img :src="item.imgSrc" :alt="item.alt" height="34" :width="item.width" />
                </a>
              </li>
            `,
          },
        },
      },
    });

    await flushPromises();
    return wrapper;
  };

  it('has no accessibility violations', async () => {
    const wrapper = await mountComponent();

    await expectNoA11yViolations(wrapper.element);
  });

  it('navigation landmark is properly structured', async () => {
    const wrapper = await mountComponent();

    // Footer should use proper navigation landmarks
    await expectNoA11yViolations(wrapper.element);
  });

  it('all images have alt text', async () => {
    const wrapper = await mountComponent();

    // Images should have descriptive alt text
    await expectNoA11yViolations(wrapper.element);
  });

  it('responsive toggle is accessible', async () => {
    const wrapper = await mountComponent();

    // Mobile toggle should be keyboard accessible
    await expectNoA11yViolations(wrapper.element);
  });
});
```
  </action>
  <verify>
Run `npm run test:unit -- --filter=a11y` - all accessibility tests pass.
  </verify>
  <done>Accessibility test examples created for 3 components</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run test:unit` - all tests including a11y tests pass
2. vitest-axe matchers work: toHaveNoViolations doesn't throw type errors
3. a11y-helpers.ts is exported from test-utils
4. 3 accessibility test files created (*.a11y.spec.ts)
</verification>

<success_criteria>
- vitest-axe installed and configured in vitest.setup.ts
- a11y-helpers.ts created with expectNoA11yViolations helper
- 3 accessibility test examples created:
  - FooterNavItem.a11y.spec.ts (basic)
  - Banner.a11y.spec.ts (interactive)
  - Footer.a11y.spec.ts (navigation)
- All tests pass with `npm run test:unit`
</success_criteria>

<output>
After completion, create `.planning/phases/15-testing-infrastructure/15-06-SUMMARY.md`
</output>
