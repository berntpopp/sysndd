---
phase: 15-testing-infrastructure
plan: 05
type: execute
wave: 2
depends_on: ["15-01", "15-02", "15-03"]
files_modified:
  - app/src/components/small/FooterNavItem.spec.ts
  - app/src/components/small/Banner.spec.ts
  - app/src/components/Footer.spec.ts
autonomous: true

must_haves:
  truths:
    - "Component tests pass with npm run test:unit"
    - "Tests demonstrate mounting, props, events, and async patterns"
    - "Tests use bootstrap stubs for isolation"
  artifacts:
    - path: "app/src/components/small/FooterNavItem.spec.ts"
      provides: "Example test for simple props-based component"
      contains: "mount"
    - path: "app/src/components/small/Banner.spec.ts"
      provides: "Example test for interactive component with localStorage"
      contains: "trigger"
    - path: "app/src/components/Footer.spec.ts"
      provides: "Example test for component with async children"
      contains: "describe"
  key_links:
    - from: "app/src/components/small/FooterNavItem.spec.ts"
      to: "app/src/components/small/FooterNavItem.vue"
      via: "import and mount"
      pattern: "import.*FooterNavItem"
---

<objective>
Create example component tests demonstrating different testing patterns.

Purpose: Provide learning examples for testing components with varying complexity.
Output: 3 component test files showing props, events, async, and localStorage patterns.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-testing-infrastructure/15-CONTEXT.md
@.planning/phases/15-testing-infrastructure/15-RESEARCH.md
@app/src/components/small/FooterNavItem.vue
@app/src/components/small/Banner.vue
@app/src/components/Footer.vue
@app/src/test-utils/mount-helpers.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Test Simple Props Component (FooterNavItem)</name>
  <files>app/src/components/small/FooterNavItem.spec.ts</files>
  <action>
Create test for FooterNavItem - a simple component that receives props.

Create `app/src/components/small/FooterNavItem.spec.ts`:

```typescript
// FooterNavItem.spec.ts
/**
 * Tests for FooterNavItem component
 *
 * Pattern: Props-based component testing
 * This component receives an item prop and renders a nav link with image.
 * Demonstrates:
 * - Testing prop handling
 * - Testing computed properties
 * - Testing error handling (image fallback)
 */

import { describe, it, expect, vi } from 'vitest';
import { mount } from '@vue/test-utils';
import FooterNavItem from './FooterNavItem.vue';
import { bootstrapStubs } from '@/test-utils';

describe('FooterNavItem', () => {
  const defaultItem = {
    id: 'test-item',
    link: 'https://example.com',
    linkAttr: { 'aria-label': 'Example Link' },
    imgSrc: '/test-image.png',
    alt: 'Test Image',
    width: 100,
    target: '_blank',
  };

  const mountComponent = (item = defaultItem) => {
    return mount(FooterNavItem, {
      props: { item },
      global: {
        stubs: bootstrapStubs,
      },
    });
  };

  describe('rendering', () => {
    it('renders an image with correct attributes', () => {
      const wrapper = mountComponent();

      const img = wrapper.find('img');
      expect(img.exists()).toBe(true);
      expect(img.attributes('src')).toBe('/test-image.png');
      expect(img.attributes('alt')).toBe('Test Image');
      expect(img.attributes('width')).toBe('100');
      expect(img.attributes('height')).toBe('34');
    });

    it('passes link to BNavItem', () => {
      const wrapper = mountComponent();

      // With stubs, BNavItem becomes <li>
      const navItem = wrapper.find('li');
      expect(navItem.exists()).toBe(true);
    });
  });

  describe('relAttribute computed property', () => {
    it('returns "noopener" for external links (target="_blank")', () => {
      const wrapper = mountComponent({
        ...defaultItem,
        target: '_blank',
      });

      const img = wrapper.find('img');
      expect(img.attributes('rel')).toBe('noopener');
    });

    it('returns empty string for internal links (no target)', () => {
      const wrapper = mountComponent({
        ...defaultItem,
        target: '',
      });

      const img = wrapper.find('img');
      expect(img.attributes('rel')).toBe('');
    });

    it('returns empty string for self target', () => {
      const wrapper = mountComponent({
        ...defaultItem,
        target: '_self',
      });

      const img = wrapper.find('img');
      expect(img.attributes('rel')).toBe('');
    });
  });

  describe('image error handling', () => {
    it('sets fallback image on error', async () => {
      const wrapper = mountComponent();
      const img = wrapper.find('img');

      // Simulate image load error
      await img.trigger('error');

      expect(img.attributes('src')).toBe('/brain-neurodevelopmental-disorders-sysndd-logo.png');
    });
  });

  describe('props validation', () => {
    it('requires item prop', () => {
      // Vue 3 prop validation - component should work with valid props
      const wrapper = mountComponent();
      expect(wrapper.vm.item).toEqual(defaultItem);
    });
  });
});
```
  </action>
  <verify>
Run `npm run test:unit -- --filter=FooterNavItem` - all tests pass.
  </verify>
  <done>Tests created for FooterNavItem demonstrating props and computed testing</done>
</task>

<task type="auto">
  <name>Task 2: Test Interactive Component (Banner)</name>
  <files>app/src/components/small/Banner.spec.ts</files>
  <action>
Create test for Banner - a component with user interaction and localStorage.

Create `app/src/components/small/Banner.spec.ts`:

```typescript
// Banner.spec.ts
/**
 * Tests for Banner component
 *
 * Pattern: Interactive component testing with localStorage
 * This component shows a dismissible banner that remembers user's choice.
 * Demonstrates:
 * - Testing visibility conditions
 * - Testing user interactions (click events)
 * - Testing localStorage integration (mocked in vitest.setup.ts)
 */

import { describe, it, expect, beforeEach } from 'vitest';
import { mount } from '@vue/test-utils';
import Banner from './Banner.vue';
import { bootstrapStubs } from '@/test-utils';

describe('Banner', () => {
  beforeEach(() => {
    // localStorage is mocked in vitest.setup.ts and cleared between tests
    window.localStorage.clear();
  });

  const mountComponent = () => {
    return mount(Banner, {
      global: {
        stubs: bootstrapStubs,
      },
    });
  };

  describe('visibility', () => {
    it('shows banner when not previously acknowledged', () => {
      const wrapper = mountComponent();

      // Should be visible
      expect(wrapper.find('[role="alert"]').exists()).toBe(true);
    });

    it('hides banner when previously acknowledged', () => {
      // Acknowledge banner before mounting
      window.localStorage.setItem('banner_acknowledged', 'true');

      const wrapper = mountComponent();

      // Should be hidden (the outer div is empty)
      expect(wrapper.find('[role="alert"]').exists()).toBe(false);
    });
  });

  describe('content', () => {
    it('displays usage policy heading', () => {
      const wrapper = mountComponent();

      expect(wrapper.text()).toContain('Usage policy');
    });

    it('displays data privacy heading', () => {
      const wrapper = mountComponent();

      expect(wrapper.text()).toContain('Data privacy');
    });

    it('displays medical disclaimer text', () => {
      const wrapper = mountComponent();

      expect(wrapper.text()).toContain('not intended for direct diagnostic use');
    });

    it('contains dismiss button', () => {
      const wrapper = mountComponent();

      const button = wrapper.find('button');
      expect(button.exists()).toBe(true);
      expect(button.text()).toContain('Dismiss');
    });
  });

  describe('acknowledgeBanner', () => {
    it('hides banner when dismiss button is clicked', async () => {
      const wrapper = mountComponent();

      // Initially visible
      expect(wrapper.find('[role="alert"]').exists()).toBe(true);

      // Click dismiss
      await wrapper.find('button').trigger('click');

      // Should be hidden
      expect(wrapper.find('[role="alert"]').exists()).toBe(false);
    });

    it('persists acknowledgment to localStorage', async () => {
      const wrapper = mountComponent();

      await wrapper.find('button').trigger('click');

      expect(window.localStorage.setItem).toHaveBeenCalledWith('banner_acknowledged', true);
    });

    it('remembers acknowledgment across component remounts', async () => {
      // First mount - acknowledge
      const wrapper1 = mountComponent();
      await wrapper1.find('button').trigger('click');
      wrapper1.unmount();

      // Second mount - should be hidden
      // Need to set localStorage value since mock clears between tests
      // In real scenario, localStorage persists
      window.localStorage.setItem('banner_acknowledged', 'true');
      const wrapper2 = mountComponent();

      expect(wrapper2.find('[role="alert"]').exists()).toBe(false);
    });
  });

  describe('external links', () => {
    it('contains link to university legal notice', () => {
      const wrapper = mountComponent();

      const link = wrapper.find('a[href="https://www.unibe.ch/legal_notice/index_eng.html"]');
      expect(link.exists()).toBe(true);
      expect(link.attributes('target')).toBe('_blank');
    });
  });
});
```
  </action>
  <verify>
Run `npm run test:unit -- --filter=Banner` - all tests pass.
  </verify>
  <done>Tests created for Banner demonstrating interaction and localStorage testing</done>
</task>

<task type="auto">
  <name>Task 3: Test Component with Async Children (Footer)</name>
  <files>app/src/components/Footer.spec.ts</files>
  <action>
Create test for Footer - a component using defineAsyncComponent.

Create `app/src/components/Footer.spec.ts`:

```typescript
// Footer.spec.ts
/**
 * Tests for Footer component
 *
 * Pattern: Component with async/lazy-loaded children
 * This component uses defineAsyncComponent for FooterNavItem.
 * Demonstrates:
 * - Testing components with async children
 * - Stubbing async components
 * - Testing data from constants
 */

import { describe, it, expect, vi } from 'vitest';
import { mount, flushPromises } from '@vue/test-utils';
import Footer from './Footer.vue';
import { bootstrapStubs } from '@/test-utils';

// Mock the constants
vi.mock('@/assets/js/constants/footer_nav_constants', () => ({
  default: {
    NAV_ITEMS: [
      {
        id: 'item1',
        link: 'https://example1.com',
        linkAttr: {},
        imgSrc: '/image1.png',
        alt: 'Image 1',
        width: 80,
        target: '_blank',
      },
      {
        id: 'item2',
        link: 'https://example2.com',
        linkAttr: {},
        imgSrc: '/image2.png',
        alt: 'Image 2',
        width: 80,
        target: '_blank',
      },
    ],
  },
}));

describe('Footer', () => {
  const mountComponent = async () => {
    const wrapper = mount(Footer, {
      global: {
        stubs: {
          ...bootstrapStubs,
          // Stub the async component
          FooterNavItem: {
            name: 'FooterNavItem',
            props: ['item'],
            template: '<div class="footer-nav-item" :data-id="item.id">{{ item.alt }}</div>',
          },
        },
      },
    });

    // Wait for async components to resolve
    await flushPromises();

    return wrapper;
  };

  describe('structure', () => {
    it('renders footer container', async () => {
      const wrapper = await mountComponent();

      expect(wrapper.find('.footer').exists()).toBe(true);
    });

    it('renders navigation bar', async () => {
      const wrapper = await mountComponent();

      expect(wrapper.find('nav').exists()).toBe(true);
    });

    it('renders navbar toggle for mobile', async () => {
      const wrapper = await mountComponent();

      expect(wrapper.find('button').exists()).toBe(true);
    });
  });

  describe('footer items', () => {
    it('renders FooterNavItem for each item in constants', async () => {
      const wrapper = await mountComponent();

      const items = wrapper.findAll('.footer-nav-item');
      expect(items).toHaveLength(2);
    });

    it('passes item prop to FooterNavItem', async () => {
      const wrapper = await mountComponent();

      const items = wrapper.findAll('.footer-nav-item');
      expect(items[0].attributes('data-id')).toBe('item1');
      expect(items[1].attributes('data-id')).toBe('item2');
    });

    it('displays item alt text', async () => {
      const wrapper = await mountComponent();

      expect(wrapper.text()).toContain('Image 1');
      expect(wrapper.text()).toContain('Image 2');
    });
  });

  describe('data', () => {
    it('loads footerItems from constants', async () => {
      const wrapper = await mountComponent();

      // Access component data
      expect(wrapper.vm.footerItems).toHaveLength(2);
      expect(wrapper.vm.footerItems[0].id).toBe('item1');
    });
  });

  describe('styling', () => {
    it('applies bg-footer class', async () => {
      const wrapper = await mountComponent();

      expect(wrapper.find('.bg-footer').exists()).toBe(true);
    });

    it('is fixed to bottom', async () => {
      const wrapper = await mountComponent();

      // BNavbar stub doesn't preserve the fixed="bottom" prop
      // In a real test, you might check computed styles or the actual component
      expect(wrapper.html()).toContain('nav');
    });
  });
});
```
  </action>
  <verify>
Run `npm run test:unit -- --filter=Footer` - all tests pass.
  </verify>
  <done>Tests created for Footer demonstrating async component and constant mocking</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run test:unit` - all component tests pass
2. Coverage includes components: `npm run test:coverage` shows component files
3. Each test file demonstrates its pattern clearly with comments
4. No TypeScript errors in test files
</verification>

<success_criteria>
- 3 component test files created (co-located with source)
- Tests demonstrate:
  - Props-based testing (FooterNavItem)
  - Interactive testing with localStorage (Banner)
  - Async component testing with stubs (Footer)
- All tests pass with `npm run test:unit`
- Bootstrap components properly stubbed for isolation
</success_criteria>

<output>
After completion, create `.planning/phases/15-testing-infrastructure/15-05-SUMMARY.md`
</output>
