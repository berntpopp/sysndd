---
phase: 14-typescript-introduction
plan: 07
type: execute
wave: 3
depends_on: ["14-06"]
files_modified:
  - app/package.json
  - app/.husky/pre-commit
autonomous: true

must_haves:
  truths:
    - "Husky pre-commit hooks installed"
    - "lint-staged runs on git commit"
    - "TypeScript files are linted on commit"
    - "Prettier formats on commit"
  artifacts:
    - path: "app/.husky/pre-commit"
      provides: "Pre-commit hook"
      contains: "lint-staged"
    - path: "app/package.json"
      provides: "lint-staged configuration"
      contains: "lint-staged"
  key_links:
    - from: "app/.husky/pre-commit"
      to: "lint-staged"
      via: "npx execution"
      pattern: "npx lint-staged"
---

<objective>
Set up Husky pre-commit hooks with lint-staged for automated code quality

Purpose: Enforce code quality on every commit by running ESLint and Prettier on staged files only. This catches issues early without slowing down development (only staged files are processed).

Output: Husky hooks installed, lint-staged configured to run ESLint and Prettier on commit
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/14-typescript-introduction/14-CONTEXT.md
@.planning/phases/14-typescript-introduction/14-RESEARCH.md
@app/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Husky and lint-staged</name>
  <files>app/package.json</files>
  <action>
Install husky and lint-staged:

```bash
cd app && npm install --save-dev husky@^9.0.0 lint-staged
```

Initialize husky in the app directory:

```bash
cd app && npx husky init
```

This creates:
- .husky/ directory
- .husky/pre-commit file (template)
- Updates package.json with "prepare": "husky" script

Add lint-staged configuration to package.json. Edit package.json to add a "lint-staged" section:

```json
{
  "lint-staged": {
    "*.{ts,tsx,vue}": [
      "eslint --fix --max-warnings=50",
      "prettier --write"
    ],
    "*.{js}": [
      "eslint --fix --max-warnings=50",
      "prettier --write"
    ],
    "*.{json,md,yml,yaml,css,scss}": [
      "prettier --write"
    ]
  }
}
```

Key decisions:
- --max-warnings=50 allows commits during migration (won't block on warnings)
- Separate rules for .ts/.vue (strict) vs .js (lenient during migration)
- JSON/MD/CSS only get prettier (no lint)
- eslint --fix auto-fixes what it can
- prettier --write formats the file
  </action>
  <verify>
```bash
cd app && npm list husky lint-staged
ls app/.husky/
```
Should show husky@9.x, lint-staged, and .husky directory with pre-commit.
  </verify>
  <done>Husky 9 and lint-staged installed; lint-staged config in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Configure pre-commit hook</name>
  <files>app/.husky/pre-commit</files>
  <action>
Update the pre-commit hook to run lint-staged:

```bash
cd app && echo "npx lint-staged" > .husky/pre-commit
```

Make sure it's executable:

```bash
chmod +x app/.husky/pre-commit
```

The pre-commit file should contain just:
```
npx lint-staged
```

Note: Husky 9 no longer needs the shebang line - it's handled automatically.

Verify the hook is set up correctly by checking .husky/pre-commit:

```bash
cat app/.husky/pre-commit
```

Should show: `npx lint-staged`
  </action>
  <verify>
```bash
cat app/.husky/pre-commit
test -x app/.husky/pre-commit && echo "Executable: yes"
```
Should show "npx lint-staged" and "Executable: yes".
  </verify>
  <done>Pre-commit hook configured to run lint-staged</done>
</task>

<task type="auto">
  <name>Task 3: Test pre-commit hook</name>
  <files>None (verification only)</files>
  <action>
Test the pre-commit hook by making a small change and attempting to commit:

1. Make a test change to a TypeScript file:
```bash
cd app && echo "// test comment" >> src/types/utils.ts
```

2. Stage the change:
```bash
cd app && git add src/types/utils.ts
```

3. Attempt to commit (this will trigger lint-staged):
```bash
cd app && git commit -m "test: verify pre-commit hooks" --dry-run
```

The --dry-run flag shows what would happen without actually committing.

Expected output:
- lint-staged runs
- ESLint checks the file
- Prettier formats the file
- Shows success or warnings (not blocking errors)

4. Clean up the test change:
```bash
cd app && git checkout src/types/utils.ts
```

5. Verify husky is properly integrated:
```bash
cd app && cat package.json | grep -A 2 '"prepare"'
```
Should show: `"prepare": "husky"`

Note: If the test commit fails with lint errors, that's expected during migration. The --max-warnings=50 setting allows reasonable number of warnings to pass.
  </action>
  <verify>
```bash
cd app && git status
echo "---"
cd app && npm run lint -- src/types/utils.ts 2>&1 | tail -5
```
Should show clean git status and lint output for test file.
  </verify>
  <done>Pre-commit hook tested and working; lint-staged processes TypeScript files</done>
</task>

</tasks>

<verification>
1. Husky installed and initialized:
   ```bash
   ls app/.husky/
   cat app/.husky/pre-commit
   ```

2. lint-staged configured:
   ```bash
   cd app && cat package.json | grep -A 10 '"lint-staged"'
   ```

3. prepare script added:
   ```bash
   cd app && cat package.json | grep '"prepare"'
   ```

4. Pre-commit hook runs:
   ```bash
   cd app && npx lint-staged --version
   ```

5. Test hook (optional, requires staged file):
   ```bash
   cd app && echo "// test" >> src/types/utils.ts && git add src/types/utils.ts && git commit --dry-run -m "test"
   cd app && git checkout src/types/utils.ts
   ```
</verification>

<success_criteria>
- Husky 9.x installed
- lint-staged installed
- .husky/pre-commit exists with "npx lint-staged"
- package.json has lint-staged configuration
- package.json has "prepare": "husky" script
- Pre-commit hook triggers lint-staged on commit
- TypeScript files are processed by ESLint and Prettier
- Warnings allowed (--max-warnings=50) during migration
</success_criteria>

<output>
After completion, create `.planning/phases/14-typescript-introduction/14-07-SUMMARY.md`
</output>
