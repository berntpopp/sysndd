---
phase: 14-typescript-introduction
plan: 05
type: execute
wave: 2
depends_on: ["14-01", "14-02"]
files_modified:
  - app/src/stores/ui.ts
  - app/src/composables/useModalControls.ts
  - app/src/composables/useToastNotifications.ts
autonomous: true

must_haves:
  truths:
    - "Pinia store has TypeScript typing"
    - "Composables have typed return values"
    - "Modal and toast methods are type-safe"
    - "Existing functionality preserved"
  artifacts:
    - path: "app/src/stores/ui.ts"
      provides: "Typed Pinia store"
      contains: "defineStore"
    - path: "app/src/composables/useModalControls.ts"
      provides: "Typed modal composable"
      exports: ["useModalControls"]
    - path: "app/src/composables/useToastNotifications.ts"
      provides: "Typed toast composable"
      exports: ["useToastNotifications"]
  key_links:
    - from: "app/src/stores/ui.ts"
      to: "pinia"
      via: "defineStore import"
      pattern: "import.*defineStore.*from 'pinia'"
    - from: "app/src/composables/useToastNotifications.ts"
      to: "app/src/types/components.ts"
      via: "ToastVariant import"
      pattern: "import type.*ToastVariant"
---

<objective>
Convert Pinia store and composables to TypeScript

Purpose: Add type safety to state management (Pinia store) and reusable composition functions (composables). This enables type inference when components use these utilities.

Output: ui.ts store with typed state/actions, useModalControls.ts and useToastNotifications.ts with typed parameters and return values
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/14-typescript-introduction/14-CONTEXT.md
@.planning/phases/14-typescript-introduction/14-RESEARCH.md
@app/src/stores/ui.js
@app/src/composables/useModalControls.js
@app/src/composables/useToastNotifications.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert Pinia store to TypeScript</name>
  <files>app/src/stores/ui.ts</files>
  <action>
Convert stores/ui.js to stores/ui.ts:

```bash
cd app && git mv src/stores/ui.js src/stores/ui.ts
```

Update with TypeScript types using setup syntax pattern from RESEARCH.md:

```typescript
// src/stores/ui.ts
/**
 * Pinia store for UI state and cross-component communication
 * Replaces EventBus for 'update-scrollbar' event
 */

import { defineStore } from 'pinia';
import { ref } from 'vue';
import type { Ref } from 'vue';

/**
 * State interface for documentation
 */
interface UIState {
  scrollbarUpdateTrigger: Ref<number>;
}

/**
 * Actions interface for documentation
 */
interface UIActions {
  requestScrollbarUpdate(): void;
}

/**
 * UI Store using setup syntax for better TypeScript inference
 */
export const useUiStore = defineStore('ui', () => {
  // State - using ref for reactivity
  const scrollbarUpdateTrigger = ref<number>(0);

  /**
   * Request scrollbar update across the application
   * Call this from any component that loads data and needs scrollbar refresh
   * Replaces: EventBus.$emit('update-scrollbar')
   */
  function requestScrollbarUpdate(): void {
    scrollbarUpdateTrigger.value++;
  }

  // Return all state and actions
  // CRITICAL: Must return all properties for Pinia to track them
  return {
    scrollbarUpdateTrigger,
    requestScrollbarUpdate,
  };
});

// Export store type for use in components
export type UIStoreType = ReturnType<typeof useUiStore>;
```

Key changes:
- Changed from Options API to Setup syntax (better TS inference)
- Added explicit types for state (Ref<number>)
- Added void return type to action
- Export store type for component usage
- Kept all existing functionality
  </action>
  <verify>
```bash
test -f app/src/stores/ui.ts && echo "File exists"
grep "ref<number>" app/src/stores/ui.ts
```
Should show file exists and typed ref usage.
  </verify>
  <done>stores/ui.ts converted with setup syntax and typed state/actions</done>
</task>

<task type="auto">
  <name>Task 2: Convert composables to TypeScript</name>
  <files>app/src/composables/useModalControls.ts, app/src/composables/useToastNotifications.ts</files>
  <action>
Convert useModalControls.js to useModalControls.ts:

```bash
cd app && git mv src/composables/useModalControls.js src/composables/useModalControls.ts
```

Update with TypeScript types:

```typescript
// composables/useModalControls.ts
/**
 * Composable for modal controls using Bootstrap-Vue-Next
 */

import { useModal } from 'bootstrap-vue-next';
import type { ModalControls } from '@/types';

/**
 * Modal control options for confirm dialog
 */
interface ConfirmOptions {
  title?: string;
  body?: string;
  okTitle?: string;
  cancelTitle?: string;
  okVariant?: string;
  centered?: boolean;
}

/**
 * Composable for modal controls using Bootstrap-Vue-Next
 * @returns Modal control methods
 */
export default function useModalControls(): ModalControls {
  const modal = useModal();

  /**
   * Show a modal by ID
   * @param id - Modal ID to show
   */
  const showModal = (id: string): void => {
    modal.show(id);
  };

  /**
   * Hide a modal by ID
   * @param id - Modal ID to hide
   */
  const hideModal = (id: string): void => {
    modal.hide(id);
  };

  /**
   * Create a confirmation modal
   * @param options - Modal options
   * @returns Promise resolving with user's choice
   */
  const confirm = async (options: ConfirmOptions): Promise<boolean> => {
    return modal.confirm(options);
  };

  return { showModal, hideModal, confirm };
}
```

Convert useToastNotifications.js to useToastNotifications.ts:

```bash
cd app && git mv src/composables/useToastNotifications.js src/composables/useToastNotifications.ts
```

Update with TypeScript types:

```typescript
// composables/useToastNotifications.ts
/**
 * Composable for toast notifications using Bootstrap-Vue-Next
 * Must be called within setup() context
 */

import { useToast } from 'bootstrap-vue-next';
import type { ToastVariant, ToastNotifications } from '@/types';

/**
 * Message input type - can be string or object with message property
 */
type ToastMessage = string | { message: string };

/**
 * Composable for toast notifications using Bootstrap-Vue-Next
 * Must be called within setup() context
 * @returns Toast notification methods
 */
export default function useToastNotifications(): ToastNotifications {
  const toast = useToast();

  /**
   * Show a toast notification
   * @param message - Message to display (or object with message property)
   * @param title - Toast title
   * @param variant - Bootstrap variant (success, danger, warning, info)
   * @param autoHide - Whether to auto-dismiss (default: true)
   * @param autoHideDelay - Delay in ms before auto-hide (default: 3000)
   */
  const makeToast = (
    message: ToastMessage,
    title: string | null = null,
    variant: ToastVariant | null = null,
    autoHide: boolean = true,
    autoHideDelay: number = 3000
  ): void => {
    const body = typeof message === 'object' && message.message
      ? message.message
      : message as string;

    toast.create({
      title: title ?? undefined,
      body,
      variant: variant ?? undefined,
      pos: 'top-end',
      modelValue: autoHide ? autoHideDelay : 0, // 0 means no auto-hide
    });
  };

  return { makeToast };
}
```

Key changes to both:
- Added explicit return types (ModalControls, ToastNotifications)
- Added parameter types
- Added void return types to methods
- Import types from @/types
- Kept all existing functionality
  </action>
  <verify>
```bash
ls app/src/composables/*.ts
grep "export default function" app/src/composables/*.ts
```
Should show both .ts files and typed function exports.
  </verify>
  <done>useModalControls.ts and useToastNotifications.ts converted with typed parameters and return values</done>
</task>

<task type="auto">
  <name>Task 3: Verify store and composables work</name>
  <files>None (verification only)</files>
  <action>
Run type check on the converted files:

```bash
cd app && npx vue-tsc --noEmit
```

Check that there are no errors specifically from:
- stores/ui.ts
- composables/useModalControls.ts
- composables/useToastNotifications.ts

If errors occur, fix them. Common issues:
1. bootstrap-vue-next types might need adjustment
2. Type imports might need path fixes

Verify no .js files remain in stores/ and composables/:

```bash
ls app/src/stores/*.js 2>/dev/null || echo "stores: Clean"
ls app/src/composables/*.js 2>/dev/null || echo "composables: Clean"
```

Test the app still runs:

```bash
cd app && npm run dev -- --port 5175 &
sleep 5
curl -s http://localhost:5175 | head -10
pkill -f "vite.*5175"
```
  </action>
  <verify>
```bash
cd app && npx vue-tsc --noEmit 2>&1 | grep -E "(stores|composables)" | head -5
echo "---"
ls app/src/stores/ app/src/composables/
```
Should show no errors and only .ts files in both directories.
  </verify>
  <done>Store and composables compile without errors; no .js files remain</done>
</task>

</tasks>

<verification>
1. All store/composable files are TypeScript:
   ```bash
   ls app/src/stores/*.ts app/src/composables/*.ts
   ```

2. No JavaScript files remain:
   ```bash
   ls app/src/stores/*.js 2>/dev/null || echo "Clean"
   ls app/src/composables/*.js 2>/dev/null || echo "Clean"
   ```

3. Type exports present:
   ```bash
   grep "export type" app/src/stores/ui.ts
   grep "import type" app/src/composables/*.ts
   ```

4. App runs correctly:
   ```bash
   cd app && npm run dev
   ```
</verification>

<success_criteria>
- stores/ui.ts converted with setup syntax
- Store exports UIStoreType for component usage
- useModalControls.ts has typed ModalControls return
- useToastNotifications.ts has typed ToastNotifications return
- All parameters and return types annotated
- No .js files remain in stores/ or composables/
- Type check passes for converted files
- App starts and runs correctly
</success_criteria>

<output>
After completion, create `.planning/phases/14-typescript-introduction/14-05-SUMMARY.md`
</output>
