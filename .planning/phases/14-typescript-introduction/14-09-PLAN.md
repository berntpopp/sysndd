---
phase: 14-typescript-introduction
plan: 09
type: execute
wave: 4
depends_on: ["14-07"]
files_modified:
  - app/src/composables/index.ts
  - app/src/composables/useColorAndSymbols.ts
  - app/src/composables/useScrollbar.ts
  - app/src/composables/useTableData.ts
  - app/src/composables/useTableMethods.ts
  - app/src/composables/useText.ts
  - app/src/composables/useToast.ts
  - app/src/composables/useUrlParsing.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All composables are TypeScript files (.ts extension)"
    - "Composables export typed functions with explicit return types"
    - "No .js files remain in composables directory"
  artifacts:
    - path: "app/src/composables/index.ts"
      provides: "Barrel export for all composables"
      exports: ["useToastNotifications", "useToast", "useModalControls", "useColorAndSymbols", "useText", "useScrollbar", "useUrlParsing", "useTableData", "useTableMethods"]
    - path: "app/src/composables/useColorAndSymbols.ts"
      provides: "Color and symbol style mappings"
      min_lines: 50
    - path: "app/src/composables/useText.ts"
      provides: "Text label mappings"
      min_lines: 30
    - path: "app/src/composables/useScrollbar.ts"
      provides: "Scrollbar update utility"
      min_lines: 15
    - path: "app/src/composables/useToast.ts"
      provides: "Toast notifications with medical error handling"
      min_lines: 30
    - path: "app/src/composables/useUrlParsing.ts"
      provides: "URL filter/sort parsing utilities"
      min_lines: 80
    - path: "app/src/composables/useTableData.ts"
      provides: "Table state management"
      min_lines: 60
    - path: "app/src/composables/useTableMethods.ts"
      provides: "Table action methods"
      min_lines: 120
  key_links:
    - from: "app/src/composables/useTableMethods.ts"
      to: "app/src/composables/useToast.ts"
      via: "import"
      pattern: "import.*useToast.*from"
    - from: "app/src/composables/index.ts"
      to: "all composables"
      via: "barrel export"
      pattern: "export.*from"
---

<objective>
Convert remaining 8 JavaScript composables to TypeScript to satisfy FR-05.7.

Purpose: Complete the "All infrastructure files converted" success criterion for Phase 14 by converting the 8 remaining .js composables to .ts with proper type annotations.

Output: All 10 composables are TypeScript files with explicit types, barrel export updated.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-typescript-introduction/14-VERIFICATION.md

# Existing TypeScript composables for reference
@app/src/composables/useToastNotifications.ts
@app/src/composables/useModalControls.ts

# Type definitions
@app/src/types/index.ts
@app/src/types/components.ts
@app/src/types/models.ts

# Source files to convert
@app/src/composables/index.js
@app/src/composables/useColorAndSymbols.js
@app/src/composables/useScrollbar.js
@app/src/composables/useText.js
@app/src/composables/useToast.js
@app/src/composables/useUrlParsing.js
@app/src/composables/useTableData.js
@app/src/composables/useTableMethods.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert stateless composables (useColorAndSymbols, useText, useScrollbar, useToast)</name>
  <files>
    app/src/composables/useColorAndSymbols.ts
    app/src/composables/useText.ts
    app/src/composables/useScrollbar.ts
    app/src/composables/useToast.ts
  </files>
  <action>
Convert four simpler composables that return constant data or simple utilities.

**useColorAndSymbols.ts:**
- Rename useColorAndSymbols.js to useColorAndSymbols.ts
- Define interface for return type with all style/icon mappings
- Add explicit return type annotation
- Use Record types for string/number keyed objects

```typescript
// Example structure
interface ColorAndSymbolMappings {
  stoplights_style: Record<string | number, string>;
  saved_style: Record<number, string>;
  review_style: Record<number, string>;
  status_style: Record<number, string>;
  header_style: Record<string, string>;
  ndd_icon: Record<string, string>;
  ndd_icon_style: Record<string, string>;
  problematic_style: Record<number, string>;
  problematic_symbol: Record<number, string>;
  user_approval_style: Record<number, string>;
  yn_icon: Record<string, string>;
  yn_icon_style: Record<string, string>;
  publication_style: Record<string, string>;
  modifier_style: Record<number, string>;
  user_icon: Record<string, string>;
  user_style: Record<string, string>;
  data_age_style: Record<number, string>;
  category_style: Record<string, string>;
}

export default function useColorAndSymbols(): ColorAndSymbolMappings { ... }
```

**useText.ts:**
- Rename useText.js to useText.ts
- Define interface for return type with all text mappings
- Add explicit return type annotation

```typescript
interface TextMappings {
  ndd_icon_text: Record<string, string>;
  publication_hover_text: Record<string, string>;
  modifier_text: Record<number, string>;
  inheritance_short_text: Record<string, string>;
  inheritance_overview_text: Record<string, string>;
  inheritance_link: Record<string, string[]>;
  empty_table_text: Record<string, string>;
  data_age_text: Record<number, string>;
}

export default function useText(): TextMappings { ... }
```

**useScrollbar.ts:**
- Rename useScrollbar.js to useScrollbar.ts
- Import Ref type from vue
- Type the scrollRef parameter

```typescript
import { nextTick, type Ref } from 'vue';

interface ScrollableElement {
  update: () => void;
}

interface ScrollbarUtils {
  updateScrollbar: (scrollRef?: Ref<ScrollableElement | null> | null) => void;
}

export default function useScrollbar(): ScrollbarUtils { ... }
```

**useToast.ts:**
- Rename useToast.js to useToast.ts
- Import ToastVariant type from @/types/components
- Match signature pattern from useToastNotifications.ts

```typescript
import { useToast as useBootstrapToast } from 'bootstrap-vue-next';
import type { ToastVariant } from '@/types/components';

interface ToastMethods {
  makeToast: (
    message: string | { message: string },
    title?: string | null,
    variant?: ToastVariant | null,
    autoHide?: boolean,
    autoHideDelay?: number
  ) => void;
}

export default function useToast(): ToastMethods { ... }
```

**Delete original .js files after each conversion using git mv or rm.**
  </action>
  <verify>
Run `ls app/src/composables/*.js` - should show only index.js, useUrlParsing.js, useTableData.js, useTableMethods.js remaining.
Run `cd /home/bernt-popp/development/sysndd/app && npx vue-tsc --noEmit 2>&1 | grep -c error` - count should not increase.
  </verify>
  <done>
useColorAndSymbols.ts, useText.ts, useScrollbar.ts, useToast.ts exist with proper TypeScript types. Original .js files deleted.
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert useUrlParsing composable</name>
  <files>app/src/composables/useUrlParsing.ts</files>
  <action>
Convert useUrlParsing.js to TypeScript. This composable handles URL filter/sort parsing with complex logic.

**useUrlParsing.ts:**
- Rename useUrlParsing.js to useUrlParsing.ts
- Define interfaces for filter objects and sort results
- Import SortBy type from @/types/components
- Type all function parameters and return values

```typescript
import type { SortBy } from '@/types/components';

/** Filter field structure used in table components */
interface FilterField {
  content: string | string[] | null;
  operator: string;
  join_char: string | null;
}

/** Filter object - maps column names to filter configurations */
type FilterObject = Record<string, FilterField>;

/** Sort parsing result matching Bootstrap-Vue-Next format */
interface SortResult {
  sortBy: SortBy[];
  sortDesc: boolean;
  sortColumn: string;
}

interface UrlParsingMethods {
  filterObjToStr: (filter_object: FilterObject) => string;
  filterStrToObj: (
    filter_string: string | null,
    standard_object: FilterObject,
    split_content?: string[],
    join_char_allow?: string[]
  ) => FilterObject;
  sortStringToVariables: (sort_string: string) => SortResult;
}

export default function useUrlParsing(): UrlParsingMethods {
  const filterObjToStr = (filter_object: FilterObject): string => {
    // Type the internal isObject helper
    const isObject = (obj: unknown): obj is Record<string, unknown> =>
      obj === Object(obj);

    // ... rest of implementation with typed variables
  };

  const filterStrToObj = (
    filter_string: string | null,
    standard_object: FilterObject,
    split_content: string[] = [',(?! )'],
    join_char_allow: string[] = [',']
  ): FilterObject => {
    // ... implementation
  };

  const sortStringToVariables = (sort_string: string): SortResult => {
    // ... implementation
  };

  return { filterObjToStr, filterStrToObj, sortStringToVariables };
}
```

**Key typing considerations:**
- Inner helper functions need explicit types
- Use type guards (is) for runtime checks
- Return types must match interface definitions

**Delete original .js file after conversion.**
  </action>
  <verify>
File `app/src/composables/useUrlParsing.ts` exists.
Run `cd /home/bernt-popp/development/sysndd/app && npx vue-tsc --noEmit 2>&1 | grep useUrlParsing` - should show no errors.
  </verify>
  <done>
useUrlParsing.ts exists with FilterField, FilterObject, and SortResult interfaces. Original .js deleted.
  </done>
</task>

<task type="auto">
  <name>Task 3: Convert useTableData and useTableMethods composables</name>
  <files>
    app/src/composables/useTableData.ts
    app/src/composables/useTableMethods.ts
  </files>
  <action>
Convert the table composables to TypeScript. These are the most complex with state management and dependency injection.

**useTableData.ts:**
- Rename useTableData.js to useTableData.ts
- Import Vue reactivity types (Ref, ComputedRef)
- Import SortBy from @/types/components
- Define interface for options and return type

```typescript
import { ref, computed, type Ref, type ComputedRef, type WritableComputedRef } from 'vue';
import type { SortBy } from '@/types/components';

/** Options for initializing table data state */
interface TableDataOptions {
  pageAfterInput?: string | number;
  pageSizeInput?: number;
  sortInput?: string;
}

/** Table data state returned by useTableData */
interface TableDataState {
  items: Ref<unknown[]>;
  totalRows: Ref<number>;
  currentPage: Ref<number>;
  currentItemID: Ref<number | string>;
  prevItemID: Ref<number | string | null>;
  nextItemID: Ref<number | string | null>;
  lastItemID: Ref<number | string | null>;
  executionTime: Ref<number>;
  perPage: Ref<number>;
  pageOptions: Ref<number[]>;
  sortBy: Ref<SortBy[]>;
  sort: Ref<string>;
  filter_string: Ref<string>;
  filterOn: Ref<string[]>;
  downloading: Ref<boolean>;
  loading: Ref<boolean>;
  isBusy: Ref<boolean>;
  sortDesc: WritableComputedRef<boolean>;
  sortColumn: ComputedRef<string>;
  removeFiltersButtonVariant: ComputedRef<string>;
  removeFiltersButtonTitle: ComputedRef<string>;
}

export default function useTableData(options: TableDataOptions = {}): TableDataState { ... }
```

**useTableMethods.ts:**
- Rename useTableMethods.js to useTableMethods.ts
- Import AxiosInstance type
- Import RouteLocationNormalized from vue-router
- Define interfaces for options and return type
- Type the tableData parameter using TableDataState (or use generic)

```typescript
import useToast from './useToast';
import type { Ref } from 'vue';
import type { AxiosInstance } from 'axios';
import type { RouteLocationNormalized } from 'vue-router';
import type { SortBy } from '@/types/components';

/** Filter field for table methods */
interface FilterField {
  content: string | string[] | null;
  operator?: string;
  join_char?: string | null;
}

/** Filter object type */
type FilterObject = Record<string, FilterField>;

/** Table data state (minimal interface for dependency) */
interface TableDataRefs {
  sort: Ref<string>;
  filter_string: Ref<string>;
  currentItemID: Ref<number | string>;
  perPage: Ref<number>;
  totalRows: Ref<number>;
  currentPage: Ref<number>;
  prevItemID: Ref<number | string | null>;
  nextItemID: Ref<number | string | null>;
  lastItemID: Ref<number | string | null>;
  sortBy: Ref<SortBy[]>;
  downloading: Ref<boolean>;
}

/** Options for useTableMethods */
interface TableMethodsOptions {
  filter?: FilterObject;
  filterObjToStr?: (filter: FilterObject) => string;
  loadData?: () => void;
  apiEndpoint?: string;
  axios?: AxiosInstance;
  route?: RouteLocationNormalized;
}

/** Return type for useTableMethods */
interface TableMethods {
  copyLinkToClipboard: () => void;
  handleSortByOrDescChange: () => void;
  handlePerPageChange: (newPerPage: number | string) => void;
  handlePageChange: (value: number) => void;
  filtered: () => void;
  removeFilters: () => void;
  removeSearch: () => void;
  requestExcel: () => Promise<void>;
  truncate: (str: string, n: number) => string;
  normalizer: (node: string) => { id: string; label: string };
  handleSortUpdate: (payload: { sortBy: string; sortDesc: boolean }) => void;
  handleSortByUpdate: (newSortBy: SortBy[]) => void;
}

export default function useTableMethods(
  tableData: TableDataRefs,
  options: TableMethodsOptions = {}
): TableMethods { ... }
```

**Delete original .js files after conversion.**
  </action>
  <verify>
Files `app/src/composables/useTableData.ts` and `app/src/composables/useTableMethods.ts` exist.
Run `cd /home/bernt-popp/development/sysndd/app && npx vue-tsc --noEmit 2>&1 | grep -E "(useTableData|useTableMethods)"` - should show no errors.
  </verify>
  <done>
useTableData.ts and useTableMethods.ts exist with full type annotations. TableDataState and TableMethods interfaces defined. Original .js files deleted.
  </done>
</task>

<task type="auto">
  <name>Task 4: Convert index.js barrel export and final verification</name>
  <files>app/src/composables/index.ts</files>
  <action>
Convert the barrel export file and verify all composables are TypeScript.

**index.ts:**
- Rename index.js to index.ts
- Update all import paths (extensions are optional in TypeScript)
- Ensure eslint-disable comment is preserved for circular dependency

```typescript
// composables/index.ts

/**
 * Barrel export for all composables
 *
 * Provides a single import point for all composables used throughout the application.
 * This pattern simplifies imports and makes it easier to manage composable dependencies.
 *
 * Usage:
 *   import { useToastNotifications, useColorAndSymbols } from '@/composables'
 */

// Toast notifications
export { default as useToastNotifications } from './useToastNotifications';
export { default as useToast } from './useToast';

// Modal controls
export { default as useModalControls } from './useModalControls';

// Style and symbol mappings
export { default as useColorAndSymbols } from './useColorAndSymbols';

// Text label mappings
export { default as useText } from './useText';

// Scrollbar utilities
export { default as useScrollbar } from './useScrollbar';

// URL parsing utilities
export { default as useUrlParsing } from './useUrlParsing';

// Table state management
export { default as useTableData } from './useTableData';
// eslint-disable-next-line import/no-cycle
export { default as useTableMethods } from './useTableMethods';
```

**Final verification:**
1. Verify no .js files remain: `ls app/src/composables/*.js` should return nothing
2. Verify all .ts files exist: `ls app/src/composables/*.ts` should list all 10 files
3. Run vue-tsc to check for type errors
4. Run dev server to verify runtime behavior

**Delete original index.js after conversion.**
  </action>
  <verify>
Run `ls app/src/composables/*.js 2>/dev/null | wc -l` - should be 0.
Run `ls app/src/composables/*.ts | wc -l` - should be 10.
Run `cd /home/bernt-popp/development/sysndd/app && npx vue-tsc --noEmit` - should pass (or only show pre-existing errors).
  </verify>
  <done>
All 10 composables are TypeScript files. No .js files remain in composables/. Barrel export updated.
  </done>
</task>

</tasks>

<verification>
- [ ] All 8 .js files converted to .ts (useColorAndSymbols, useText, useScrollbar, useToast, useUrlParsing, useTableData, useTableMethods, index)
- [ ] No .js files remain in composables directory
- [ ] `npx vue-tsc --noEmit` passes or shows only pre-existing errors
- [ ] All composables have explicit return type annotations
- [ ] index.ts barrel export updated with all 10 composables
- [ ] Dev server starts without errors (`npm run dev`)
- [ ] Existing component imports continue to work
</verification>

<success_criteria>
- FR-05.7 satisfied: "Add TypeScript to all composables"
- All 10 composables are TypeScript files
- No .js files in composables directory
- Types are explicit (not inferred as 'any')
- Existing functionality preserved (no runtime changes)
- Components using composables still work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/14-typescript-introduction/14-09-SUMMARY.md`
</output>
