---
phase: 12-vite-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/vite.config.js
  - app/package.json
autonomous: true

must_haves:
  truths:
    - "Vite and Vue plugin are installed as devDependencies"
    - "vite.config.js exists with Vue plugin and @vue/compat alias"
    - "Package.json has Vite scripts alongside existing Vue CLI scripts"
    - "API proxy configured for local development without Docker"
  artifacts:
    - path: "app/vite.config.js"
      provides: "Vite configuration with Vue plugin, SCSS, proxy, and dev server settings"
      contains: "defineConfig"
    - path: "app/package.json"
      provides: "Vite dependencies and scripts"
      contains: "vite"
  key_links:
    - from: "app/vite.config.js"
      to: "@vitejs/plugin-vue"
      via: "plugin import"
      pattern: "import vue from '@vitejs/plugin-vue'"
    - from: "app/vite.config.js"
      to: "localhost:7778"
      via: "proxy configuration"
      pattern: "proxy.*target.*7778"
---

<objective>
Install Vite and create base configuration with Vue plugin, path aliases, API proxy, and dev server settings.

Purpose: Establish Vite foundation that can run alongside existing Vue CLI setup for comparison testing during migration.
Output: vite.config.js with all core settings including API proxy, package.json with Vite dependencies and scripts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-vite-migration/12-RESEARCH.md
@app/vue.config.js
@app/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Vite dependencies</name>
  <files>app/package.json</files>
  <action>
Install Vite and related packages as devDependencies:

```bash
cd app && npm install -D vite@^7.3.0 @vitejs/plugin-vue@^5.1.0 vite-plugin-pwa@^1.0.0
```

This installs:
- vite: Build tool and dev server
- @vitejs/plugin-vue: Vue 3 SFC compilation
- vite-plugin-pwa: PWA support (replaces @vue/cli-plugin-pwa)

Keep existing Vue CLI dependencies - they will be removed in a later phase after migration is verified.
  </action>
  <verify>
```bash
cd app && npm ls vite @vitejs/plugin-vue vite-plugin-pwa
```
All three packages should be listed without errors.
  </verify>
  <done>Vite 7.3+, @vitejs/plugin-vue 5.1+, and vite-plugin-pwa 1.0+ installed in devDependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create vite.config.js with core configuration and API proxy</name>
  <files>app/vite.config.js</files>
  <action>
Create `app/vite.config.js` (JavaScript, not TypeScript - TypeScript not available until Phase 14) with the following configuration:

1. **Plugins:**
   - vue() plugin for .vue SFC support
   - VitePWA with manifest migrated from vue.config.js pwa section

2. **Resolve aliases:**
   - '@': '/src' (path alias)
   - 'vue': '@vue/compat' (CRITICAL: maintain compat mode during migration)

3. **Dev server settings:**
   - host: '0.0.0.0' (Docker requirement)
   - port: 5173 (Vite default, avoids conflict with Vue CLI 8080)
   - strictPort: true (fail if port unavailable)
   - watch.usePolling: true (CRITICAL for Docker HMR)
   - watch.interval: 100
   - hmr.clientPort: 5173

4. **API Proxy (FR-03.7):**
   - '/api': proxy to 'http://localhost:7778' (backend API server)
   - changeOrigin: true
   - rewrite: path => path (keep /api prefix since backend expects it)

   This enables `npm run dev` (without Docker) to work for local development.
   In Docker mode, Traefik handles routing, so proxy is only used when running Vite directly.

5. **CSS preprocessor:**
   - additionalData with @use syntax for global SCSS
   - api: 'modern-compiler' for @use support
   - Note: Use @use instead of @import for Vite 5.4+ compatibility

6. **Build settings:**
   - outDir: 'dist'
   - sourcemap: 'hidden' (security: no public source maps)
   - manualChunks for vendor splitting:
     - 'vendor': ['vue', 'vue-router', 'pinia']
     - 'bootstrap': ['bootstrap', 'bootstrap-vue-next']
     - 'viz': ['d3', '@upsetjs/bundle', 'gsap']

7. **Vue feature flags** (replaces webpack.DefinePlugin):
   - __VUE_OPTIONS_API__: true
   - __VUE_PROD_DEVTOOLS__: false
   - __VUE_PROD_HYDRATION_MISMATCH_DETAILS__: false

Migrate PWA manifest icons from vue.config.js exactly as-is.

Use JavaScript (not TypeScript) for config file - TypeScript is introduced in Phase 14.
  </action>
  <verify>
```bash
cat app/vite.config.js | head -60
# Verify: Contains defineConfig, vue plugin, server.proxy configuration
grep -q "proxy" app/vite.config.js && echo "PASS: proxy configured" || echo "FAIL: proxy missing"
grep -q "7778" app/vite.config.js && echo "PASS: backend port configured" || echo "FAIL: backend port missing"
```
Config file exists and contains defineConfig, vue plugin, server settings, and proxy configuration.
  </verify>
  <done>vite.config.js created with Vue plugin, @vue/compat alias, dev server settings, API proxy for localhost:7778, SCSS config, and build optimization</done>
</task>

<task type="auto">
  <name>Task 3: Add Vite scripts to package.json</name>
  <files>app/package.json</files>
  <action>
Add new scripts to package.json for Vite, keeping existing Vue CLI scripts during transition:

```json
{
  "scripts": {
    "serve": "vue-cli-service serve",
    "build": "vue-cli-service build",
    "lint": "vue-cli-service lint",
    "sitemap": "vue-cli-service sitemap",
    "start": "vue-cli-service serve --open",
    "dev": "vite",
    "build:vite": "vite build",
    "preview": "vite preview",
    "dev:docker": "vite --mode docker",
    "build:docker": "vite build --mode docker",
    "build:production": "vite build --mode production"
  }
}
```

This allows:
- `npm run dev` for Vite dev server (port 5173) with API proxy to localhost:7778
- `npm run serve` for Vue CLI (port 8080) - still works for comparison
- `npm run build:vite` for Vite production build
- `npm run dev:docker` for Docker development with .env.docker
  </action>
  <verify>
```bash
cd app && npm run dev -- --help 2>&1 | head -5
```
Should show Vite CLI help, confirming the dev script works.
  </verify>
  <done>Package.json has both Vite and Vue CLI scripts for parallel testing during migration</done>
</task>

</tasks>

<verification>
1. `cd app && npm ls vite` shows vite@7.x installed
2. `app/vite.config.js` exists with defineConfig export
3. Config contains server.watch.usePolling: true (Docker HMR requirement)
4. Config contains 'vue': '@vue/compat' alias
5. Config contains server.proxy with target localhost:7778 (API proxy for local dev)
6. `npm run dev -- --help` shows Vite CLI
</verification>

<success_criteria>
- Vite 7.3+ installed as devDependency
- vite.config.js created with Vue plugin, compat alias, Docker-ready dev server
- API proxy configured for /api -> localhost:7778 (enables local dev without Docker)
- PWA manifest migrated from vue.config.js
- Both `npm run dev` (Vite) and `npm run serve` (Vue CLI) work
- No existing Vue CLI functionality broken
</success_criteria>

<output>
After completion, create `.planning/phases/12-vite-migration/12-01-SUMMARY.md`
</output>
