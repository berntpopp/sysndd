---
phase: 12-vite-migration
plan: 06
type: execute
wave: 4
depends_on: [12-05]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Vite dev server starts in under 5 seconds"
    - "HMR works for Vue component changes in Docker"
    - "Production build succeeds and outputs to dist/"
    - "Application loads and displays correctly in browser"
  artifacts:
    - path: "app/dist/index.html"
      provides: "Production build output"
  key_links:
    - from: "browser"
      to: "app/src/main.js"
      via: "Vite dev server"
---

<objective>
Verify Vite migration is complete: test dev server, HMR, and production build.

Purpose: Ensure the entire Vite migration works end-to-end before removing Vue CLI.
Output: Verified working Vite setup in both development and production modes.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/12-vite-migration/12-RESEARCH.md
@.planning/phases/12-vite-migration/12-01-SUMMARY.md
@.planning/phases/12-vite-migration/12-02-SUMMARY.md
@.planning/phases/12-vite-migration/12-03-SUMMARY.md
@.planning/phases/12-vite-migration/12-04-SUMMARY.md
@.planning/phases/12-vite-migration/12-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Test Vite dev server locally</name>
  <files></files>
  <action>
Test Vite dev server starts successfully:

```bash
cd app && npm run dev
```

Expected behavior:
1. Server starts in < 5 seconds (much faster than webpack)
2. Shows "Local: http://localhost:5173/"
3. No compilation errors in console
4. Environment variables loaded from .env.development

If there are errors:
- Check for missing .vue extensions in imports
- Check for remaining process.env references
- Check for syntax errors in vite.config.js

Stop the dev server after verification (Ctrl+C).
  </action>
  <verify>
```bash
# Start dev server in background, capture output, then kill it
cd /home/bernt-popp/development/sysndd/app && timeout 30 npm run dev 2>&1 | head -30
```
Look for "Local:" URL and no red error messages.
  </verify>
  <done>Vite dev server starts successfully, shows localhost:5173 URL</done>
</task>

<task type="auto">
  <name>Task 2: Test production build</name>
  <files></files>
  <action>
Test Vite production build succeeds:

```bash
cd app && npm run build:vite
```

Expected behavior:
1. Build completes without errors
2. Creates dist/ directory with:
   - index.html
   - assets/ folder with JS/CSS chunks
   - Vendor chunks (vendor-*.js, bootstrap-*.js)
3. No warnings about missing files or circular dependencies

Check the output:
```bash
ls -la app/dist/
ls -la app/dist/assets/ | head -20
```

Verify chunk splitting worked:
- Should see separate vendor chunk
- Should see separate bootstrap chunk
- Main bundle should be reasonable size (< 500KB before gzip)
  </action>
  <verify>
```bash
# Run build and check output
cd /home/bernt-popp/development/sysndd/app && npm run build:vite 2>&1 | tail -20
ls -la /home/bernt-popp/development/sysndd/app/dist/ 2>/dev/null || echo "dist/ not created"
```
  </verify>
  <done>Production build succeeds, dist/ contains index.html and chunked assets</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Vite migration:
- Vite 7.3+ installed and configured
- Environment variables migrated (VITE_*)
- index.html moved to root with Vite entry script
- All imports updated (.vue extensions, no webpack comments)
- Docker configuration updated for Vite
  </what-built>
  <how-to-verify>
**Test 1: Docker HMR (Primary Dev Workflow)**
1. Run: `docker compose up app --build`
2. Wait for container to be healthy (~60 seconds)
3. Open: http://localhost:5173
4. Verify the SysNDD application loads correctly
5. Edit a Vue component (e.g., add a comment in App.vue)
6. Verify HMR updates the page without full reload
7. Check browser console for HMR messages

**Test 2: Production Build**
1. Run: `docker compose -f docker-compose.yml build app`
2. Run: `docker compose -f docker-compose.yml up app`
3. Open: http://localhost (through Traefik) or http://localhost:8080 (direct)
4. Verify production build loads correctly
5. Check Network tab - assets should be chunked (vendor, bootstrap, etc.)

**Test 3: Environment Variables**
1. In dev mode, open browser console
2. Check that API calls go to correct URL (from VITE_API_URL)
3. Or check Network tab for API requests to correct host

**Expected Results:**
- [ ] Dev server starts in < 5 seconds
- [ ] HMR works in Docker (changes reflect without full reload)
- [ ] Production build serves correctly
- [ ] No console errors about missing modules or env vars
- [ ] Application pages load (Home, Entities table, etc.)
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors and shows localhost:5173
2. `npm run build:vite` completes successfully
3. `app/dist/index.html` exists after build
4. Docker dev container starts and HMR works
5. Production Docker build serves application correctly
6. Environment variables (VITE_API_URL, etc.) work in both modes
</verification>

<success_criteria>
- Vite dev server starts in < 5 seconds (vs ~30s for webpack)
- HMR works reliably in Docker containers
- Production build succeeds and creates optimized chunks
- Application functions identically to Vue CLI version
- No regressions in functionality
</success_criteria>

<output>
After completion, create `.planning/phases/12-vite-migration/12-06-SUMMARY.md`
</output>
