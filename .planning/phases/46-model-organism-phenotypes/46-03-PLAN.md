---
phase: 46-model-organism-phenotypes
plan: 03
type: execute
wave: 3
depends_on: ["46-02"]
files_modified:
  - app/src/components/gene/GeneClinVarCard.vue
  - app/src/components/gene/GeneConstraintCard.vue
  - app/src/components/gene/ProteinDomainLollipopCard.vue
  - app/src/components/gene/ProteinDomainLollipopPlot.vue
autonomous: false

must_haves:
  truths:
    - "All colored elements have text labels (not color-only)"
    - "All ACMG badges show text label with pathogenicity class"
    - "Zygosity chips show abbreviation with count"
    - "Constraint score bars have numeric values visible"
    - "Lollipop plot legend shows text labels with colors"
  artifacts:
    - path: "app/src/components/gene/GeneClinVarCard.vue"
      provides: "ClinVar card with accessible ACMG badges"
      contains: "aria-label"
    - path: "app/src/components/gene/GeneConstraintCard.vue"
      provides: "Constraint card with accessible score display"
      contains: "aria-label"
    - path: "app/src/components/gene/ProteinDomainLollipopCard.vue"
      provides: "Lollipop card with accessible filter toggles"
      contains: "aria-label"
  key_links:
    - from: "all card components"
      to: "WCAG 2.2 AA requirement 1.4.1"
      via: "color + text labels"
      pattern: "text.*label|label.*text|strong.*variant"
---

<objective>
Audit and fix accessibility issues across all v8.0 gene page cards to ensure WCAG 2.2 AA compliance, specifically addressing A11Y-05 (color coding supplemented with text labels).

Purpose: Ensure all colored elements (ACMG badges, zygosity chips, constraint bars, lollipop markers) have accompanying text labels so color-blind users can distinguish categories.

Output: Updated card components with text labels on all colored elements, ready for Lighthouse accessibility validation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/46-model-organism-phenotypes/46-CONTEXT.md
@.planning/phases/46-model-organism-phenotypes/46-RESEARCH.md
@.planning/phases/46-model-organism-phenotypes/46-02-SUMMARY.md

# Components to audit
@app/src/components/gene/GeneClinVarCard.vue
@app/src/components/gene/GeneConstraintCard.vue
@app/src/components/gene/ProteinDomainLollipopCard.vue
@app/src/components/gene/ProteinDomainLollipopPlot.vue
@app/src/components/gene/ModelOrganismsCard.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and fix color-only information in v8.0 cards</name>
  <files>
    app/src/components/gene/GeneClinVarCard.vue
    app/src/components/gene/GeneConstraintCard.vue
    app/src/components/gene/ProteinDomainLollipopCard.vue
    app/src/components/gene/ProteinDomainLollipopPlot.vue
  </files>
  <action>
Review each gene page card component for WCAG 1.4.1 (Use of Color) compliance. Fix any instances where color alone conveys information.

**1. GeneClinVarCard.vue - ACMG badges:**
Current state: Badges have colored backgrounds (red, orange, yellow, teal, green) WITH text labels ("Pathogenic", "Likely Pathogenic", etc.). This ALREADY complies with A11Y-05.

Verify:
- Each BBadge has both a color (variant/class) AND visible text
- aria-labels provide full context for screen readers

If any badge is missing text, add it. Example:
```vue
<!-- CORRECT: Color + text -->
<BBadge variant="danger">
  <strong>Pathogenic</strong> ({{ count }})
</BBadge>

<!-- WRONG: Color only -->
<BBadge variant="danger" />
```

**2. GeneConstraintCard.vue - Constraint score bars:**
Current state: Uses color-coded bars for o/e ratios. Check if numeric values are visible alongside bars.

Required fixes (if needed):
- Ensure o/e ratio numeric values are displayed as text (not just bar width)
- Ensure Z-scores are displayed as text
- If LOEUF < 0.6 highlighting uses color alone, add a text indicator like "(constrained)"

The card already shows values like "0.45 (0.38-0.53)" - verify this is the case for all metrics.

**3. ProteinDomainLollipopCard.vue - Filter toggles:**
Check if pathogenicity filter toggles (P/LP/VUS/LB/B) use color-only indicators.

Required fixes (if needed):
- Filter checkboxes should show text labels ("Pathogenic", "Likely Pathogenic", etc.) not just colored boxes
- Legend should have text next to each color

**4. ProteinDomainLollipopPlot.vue - Lollipop markers and legend:**
Check if the D3 visualization uses color-only markers.

Current state: Markers are colored by pathogenicity classification. The legend should show both color AND text.

Required fixes (if needed):
- Legend must show text labels alongside color swatches: "Pathogenic [red box]", "Likely Pathogenic [orange box]", etc.
- Tooltip on hover provides text classification (already implemented per Phase 43)

For the actual lollipop markers on the plot:
- The markers themselves can be color-coded (this is acceptable) as long as:
  - The legend clearly maps colors to text labels
  - Tooltips show text classification on hover
  - Filter controls use text labels

**Summary of A11Y-05 requirements:**
| Element | Color | Required Text |
|---------|-------|---------------|
| ACMG badges | Red/Orange/Yellow/Teal/Green | "Pathogenic"/"Likely Pathogenic"/"VUS"/"Likely Benign"/"Benign" |
| Constraint bars | Amber for constrained | Numeric value + "(constrained)" text if highlighted |
| Zygosity chips | Red/Yellow/Blue | "hm"/"ht"/"cn" abbreviations visible |
| Lollipop legend | All ACMG colors | Text label next to each color swatch |

Make minimal changes - if a component already complies, document this in the summary but don't modify the file.
  </action>
  <verify>
Run `npm run type-check` in app directory - should pass.
Run `npm run lint` in app directory - should pass.
Manual inspection: Each colored element should have visible text label.
  </verify>
  <done>
All v8.0 gene page cards verified/updated for WCAG 1.4.1 compliance:
- ACMG badges have text labels (Pathogenic, Likely Pathogenic, VUS, Likely Benign, Benign)
- Constraint score bars display numeric values
- Zygosity chips display abbreviations (hm/ht/cn)
- Lollipop legend shows text labels with color swatches
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 46 implementation:
- Model Organisms card with MGI mouse phenotypes (count + zygosity breakdown) and RGD rat phenotypes (count only)
- Card integrated into gene page after ClinVar card
- Accessibility audit ensuring all colored elements have text labels
  </what-built>
  <how-to-verify>
1. Start dev server: `cd app && npm run dev`
2. Navigate to a gene with phenotype data: http://localhost:5173/Gene/SCN1A

**Model Organisms Card verification:**
- [ ] Card appears after ClinVar Variants card
- [ ] Mouse (MGI) section on left shows:
  - Total phenotype count badge (e.g., "37 phenotypes")
  - Zygosity breakdown badges if available (e.g., "hm (15)", "ht (22)")
  - Link to MGI database opens in new tab
- [ ] Rat (RGD) section on right shows:
  - Total phenotype count badge (e.g., "12 phenotypes")
  - Link to RGD database opens in new tab
- [ ] On mobile viewport, sections stack vertically

**Empty state verification:**
- Navigate to a gene without phenotype data (try a less common gene)
- [ ] Card hidden entirely if neither mouse nor rat has data

**Accessibility verification:**
- [ ] Tab through the page - all interactive elements focusable
- [ ] All badges have visible text (not color-only)
- [ ] ClinVar badges show: Pathogenic, Likely Pathogenic, VUS, etc.
- [ ] Zygosity badges show: hm, ht, cn abbreviations
- [ ] Constraint card shows numeric values (not just colored bars)

**Lighthouse accessibility check (optional):**
- Open Chrome DevTools > Lighthouse tab
- Run "Accessibility" audit
- Target: Score >= 90 (100 is ideal but some issues may be beyond our control)
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `cd app && npm run type-check`
2. ESLint passes: `cd app && npm run lint`
3. Visual inspection confirms:
   - ACMG badges have text labels
   - Constraint scores show numeric values
   - Zygosity chips show abbreviations
   - No color-only information conveying meaning
4. Human verification checkpoint passed
</verification>

<success_criteria>
- A11Y-05: All ACMG pathogenicity colors include text labels
- All v8.0 gene page cards pass WCAG 1.4.1 (Use of Color)
- Model Organisms card displays correctly with phenotype data
- Gene page remains functional after accessibility updates
</success_criteria>

<output>
After completion, create `.planning/phases/46-model-organism-phenotypes/46-03-SUMMARY.md`
</output>
