---
phase: 46-model-organism-phenotypes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/src/types/external.ts
  - app/src/composables/useModelOrganismData.ts
autonomous: true

must_haves:
  truths:
    - "TypeScript interfaces exist for MGI and RGD API responses"
    - "Composable fetches MGI and RGD data from backend proxy endpoints"
    - "Per-source state isolation allows independent loading/error states"
    - "404 responses treated as 'no data' not error"
  artifacts:
    - path: "app/src/types/external.ts"
      provides: "MGIPhenotypeData and RGDPhenotypeData interfaces"
      contains: "export interface MGIPhenotypeData"
    - path: "app/src/composables/useModelOrganismData.ts"
      provides: "Composable for fetching MGI and RGD data"
      exports: ["useModelOrganismData"]
      min_lines: 80
  key_links:
    - from: "app/src/composables/useModelOrganismData.ts"
      to: "/api/external/mgi/phenotypes/<symbol>"
      via: "axios GET request"
      pattern: "axios\\.get.*mgi/phenotypes"
    - from: "app/src/composables/useModelOrganismData.ts"
      to: "/api/external/rgd/phenotypes/<symbol>"
      via: "axios GET request"
      pattern: "axios\\.get.*rgd/phenotypes"
---

<objective>
Create TypeScript interfaces and data-fetching composable for model organism phenotype data.

Purpose: Establish the data layer foundation for the Model Organisms card, following established patterns from useGeneExternalData.ts for per-source state isolation.

Output: Types in external.ts and useModelOrganismData.ts composable that fetches from existing backend proxy endpoints.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/46-model-organism-phenotypes/46-CONTEXT.md
@.planning/phases/46-model-organism-phenotypes/46-RESEARCH.md

# Existing patterns to follow
@app/src/types/external.ts
@app/src/composables/useGeneExternalData.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add MGI/RGD TypeScript interfaces</name>
  <files>app/src/types/external.ts</files>
  <action>
Add TypeScript interfaces for MGI and RGD phenotype API responses to app/src/types/external.ts.

Add after the existing ExternalDataResponse interface:

```typescript
/**
 * MGI (Mouse Genome Informatics) phenotype data
 *
 * Response structure from /api/external/mgi/phenotypes/<symbol>
 */
export interface MGIPhenotypeData {
  source: 'mgi';
  gene_symbol: string;
  mgi_id: string;
  mouse_symbol: string;
  marker_name: string | null;
  phenotype_count: number;
  phenotypes: Array<{
    phenotype_id?: string;
    term?: string;
    zygosity?: 'homozygous' | 'heterozygous' | 'conditional' | string;
  }>;
  mgi_url: string;
}

/**
 * RGD (Rat Genome Database) phenotype data
 *
 * Response structure from /api/external/rgd/phenotypes/<symbol>
 * Note: RGD does not provide zygosity breakdown in API response
 */
export interface RGDPhenotypeData {
  source: 'rgd';
  gene_symbol: string;
  rgd_id: string;
  rat_symbol: string;
  rat_name: string | null;
  phenotype_count: number;
  phenotypes: Array<{
    term?: string;
    annotation_type?: string;
  }>;
  rgd_url: string;
}
```

Also update the ExternalDataResponse.sources interface to type the mgi and rgd fields:
- Change `mgi?: unknown;` to `mgi?: MGIPhenotypeData;`
- Change `rgd?: unknown;` to `rgd?: RGDPhenotypeData;`

Preserve all existing interfaces and comments.
  </action>
  <verify>
Run `npm run type-check` in app directory - should pass with no errors.
Grep for the new interfaces: `grep -n "MGIPhenotypeData\|RGDPhenotypeData" app/src/types/external.ts`
  </verify>
  <done>
MGIPhenotypeData and RGDPhenotypeData interfaces exist in external.ts with all fields matching backend response structure.
ExternalDataResponse.sources has typed mgi and rgd fields.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create useModelOrganismData composable</name>
  <files>app/src/composables/useModelOrganismData.ts</files>
  <action>
Create a new composable at app/src/composables/useModelOrganismData.ts following the useGeneExternalData.ts pattern.

Key implementation points:

1. **Per-source state isolation** (like useGeneExternalData):
   - `mgi` object with loading, error, data refs
   - `rgd` object with loading, error, data refs
   - Overall loading computed from both sources

2. **Fetch from per-source endpoints** (not aggregation endpoint):
   - GET /api/external/mgi/phenotypes/{symbol}
   - GET /api/external/rgd/phenotypes/{symbol}
   - Fetch both in parallel with Promise.all

3. **Handle 404 as "no data"** (not error):
   - If axios returns 404, set data to null, error to null
   - This matches "gene has no phenotype data" (not API failure)

4. **Handle actual errors**:
   - Network errors, 5xx responses set error message
   - Keep data as null on error

5. **No auto-fetch** - consumer calls fetchData() explicitly

6. **retry() convenience method** that calls fetchData()

Template structure:
```typescript
import type { Ref } from 'vue';
import { ref, computed, toRef } from 'vue';
import axios from 'axios';
import type { MGIPhenotypeData, RGDPhenotypeData } from '@/types/external';

export interface UseModelOrganismDataReturn {
  mgi: {
    loading: Ref<boolean>;
    error: Ref<string | null>;
    data: Ref<MGIPhenotypeData | null>;
  };
  rgd: {
    loading: Ref<boolean>;
    error: Ref<string | null>;
    data: Ref<RGDPhenotypeData | null>;
  };
  loading: Ref<boolean>;
  fetchData: () => Promise<void>;
  retry: () => Promise<void>;
}

export function useModelOrganismData(
  geneSymbol: Ref<string> | string
): UseModelOrganismDataReturn {
  // Implementation following useGeneExternalData pattern
}
```

Add JSDoc comments documenting:
- Purpose: Fetches model organism phenotype data from MGI and RGD
- Pattern: Per-source state isolation for graceful degradation
- Usage example showing how to call fetchData() and access state
  </action>
  <verify>
Run `npm run type-check` in app directory - should pass.
Run `npm run lint` in app directory - should pass.
Check file exists: `ls -la app/src/composables/useModelOrganismData.ts`
  </verify>
  <done>
useModelOrganismData.ts composable exists with:
- Per-source state (mgi, rgd) with independent loading/error/data refs
- fetchData() fetches from both /api/external/mgi/phenotypes and /api/external/rgd/phenotypes
- 404 responses treated as "no data" (not error)
- retry() convenience method
- TypeScript types exported for consumer use
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `cd app && npm run type-check`
2. ESLint passes: `cd app && npm run lint`
3. MGIPhenotypeData interface has: source, gene_symbol, mgi_id, mouse_symbol, marker_name, phenotype_count, phenotypes array, mgi_url
4. RGDPhenotypeData interface has: source, gene_symbol, rgd_id, rat_symbol, rat_name, phenotype_count, phenotypes array, rgd_url
5. Composable exports: useModelOrganismData function, UseModelOrganismDataReturn interface
</verification>

<success_criteria>
- TypeScript interfaces match backend response structure from external-proxy-mgi.R and external-proxy-rgd.R
- Composable follows useGeneExternalData.ts pattern exactly (per-source state isolation)
- No new dependencies required (axios already in project)
- Types compile without errors
</success_criteria>

<output>
After completion, create `.planning/phases/46-model-organism-phenotypes/46-01-SUMMARY.md`
</output>
