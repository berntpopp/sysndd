---
phase: 33-logging-analytics
plan: 02
type: execute
wave: 2
depends_on: ["33-01"]
files_modified:
  - app/src/components/tables/TablesLogs.vue
autonomous: true

must_haves:
  truths:
    - "Admin can filter logs by specific user via dropdown"
    - "Admin can filter logs by action type (GET, POST, PUT, DELETE)"
    - "Admin can see active filters as removable badges"
    - "Admin can clear all filters with single click"
  artifacts:
    - path: "app/src/components/tables/TablesLogs.vue"
      provides: "User filter dropdown, action type filter, filter pills"
      contains: "activeFilters"
  key_links:
    - from: "TablesLogs.vue user filter"
      to: "/api/user/list"
      via: "loadUserList method"
      pattern: "api/user/list"
    - from: "TablesLogs.vue filter badges"
      to: "clearFilter method"
      via: "BBadge click handler"
      pattern: "clearFilter"
---

<objective>
Add user filter dropdown, action type filter, and filter pills UI to TablesLogs

Purpose: Enable admin to filter logs by user (LOG-01) and action type (LOG-02), with visual feedback via filter pills (LOG-05 feature parity with ManageUser).

Output: TablesLogs.vue with user dropdown filter, action type multi-select, active filter badges, and clear all functionality
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-logging-analytics/33-CONTEXT.md
@.planning/phases/33-logging-analytics/33-RESEARCH.md
@.planning/phases/33-logging-analytics/33-01-SUMMARY.md
@app/src/components/tables/TablesLogs.vue
@app/src/views/admin/ManageUser.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add user filter dropdown with async loading</name>
  <files>app/src/components/tables/TablesLogs.vue</files>
  <action>
Add user_options to data():
```javascript
user_options: [],
```

Add loadUserList() method that fetches all users for the filter dropdown:
```javascript
async loadUserList() {
  try {
    const response = await this.axios.get(
      `${import.meta.env.VITE_API_URL}/api/user/list`,
      {
        headers: { Authorization: `Bearer ${localStorage.getItem('token')}` },
      }
    );
    this.user_options = response.data.map((item) => ({
      value: item.user_name,
      text: `${item.user_name} (${item.user_role})`,
    }));
  } catch (e) {
    this.makeToast('Failed to load user list', 'Error', 'danger');
  }
},
```

Call loadUserList() in mounted() after URL parsing, before loadData():
```javascript
this.loadUserList();
```

Add user filter to the filter ref in setup():
```javascript
user: { content: null, join_char: null, operator: 'contains' },
```

Add user filter dropdown in the filter row (after the search input, before pagination):
```vue
<BRow class="px-2 pb-2">
  <BCol sm="4">
    <BFormSelect
      v-model="filter.user.content"
      :options="user_options"
      size="sm"
      @update:model-value="filtered()"
    >
      <template #first>
        <BFormSelectOption :value="null">All Users</BFormSelectOption>
      </template>
    </BFormSelect>
  </BCol>
  <BCol sm="4">
    <!-- Action type filter will go here in next task -->
  </BCol>
  <BCol sm="4" class="text-end">
    <span class="text-muted small">
      Showing {{ items.length }} of {{ totalRows }}
    </span>
  </BCol>
</BRow>
```

Update removeFilters() to reset user filter:
```javascript
user: { content: null, join_char: null, operator: 'contains' },
```
  </action>
  <verify>
1. User dropdown loads with list of users
2. Selecting a user triggers API call with filter param
3. URL updates to include user filter
4. "All Users" option clears the user filter
  </verify>
  <done>user_options array populated via loadUserList(). User dropdown with "All Users" default. Filter updates URL and triggers API call.</done>
</task>

<task type="auto">
  <name>Task 2: Add action type filter for request methods</name>
  <files>app/src/components/tables/TablesLogs.vue</files>
  <action>
The request_method filter already exists in the filter ref. Add a dropdown for common HTTP methods.

Add method_options to data():
```javascript
method_options: [
  { value: 'GET', text: 'GET' },
  { value: 'POST', text: 'POST' },
  { value: 'PUT', text: 'PUT' },
  { value: 'DELETE', text: 'DELETE' },
],
```

Add the action type dropdown in the second BCol of the filter row:
```vue
<BCol sm="4">
  <BFormSelect
    v-model="filter.request_method.content"
    :options="method_options"
    size="sm"
    @update:model-value="filtered()"
  >
    <template #first>
      <BFormSelectOption :value="null">All Methods</BFormSelectOption>
    </template>
  </BFormSelect>
</BCol>
```

Note: The existing filter structure for request_method has `join_char: ','` which supports multiple values. For simplicity, use single-select dropdown. Multi-select can be added later if needed per context decisions ("BFormSelect with multiple").
  </action>
  <verify>
1. Method dropdown shows GET, POST, PUT, DELETE options
2. Selecting a method filters the table
3. URL updates with filter param for request_method
4. "All Methods" clears the method filter
  </verify>
  <done>method_options with HTTP verbs. BFormSelect for request_method. Filter integrates with existing filter structure.</done>
</task>

<task type="auto">
  <name>Task 3: Add active filter pills with clear actions</name>
  <files>app/src/components/tables/TablesLogs.vue</files>
  <action>
Add computed properties for active filter display (following ManageUser.vue pattern):

```javascript
computed: {
  hasActiveFilters() {
    return Object.values(this.filter).some(
      (f) => f.content !== null && f.content !== ''
    );
  },
  activeFilters() {
    const filters = [];
    if (this.filter.any.content) {
      filters.push({ key: 'any', label: 'Search', value: this.filter.any.content });
    }
    if (this.filter.user.content) {
      filters.push({ key: 'user', label: 'User', value: this.filter.user.content });
    }
    if (this.filter.request_method.content) {
      filters.push({ key: 'request_method', label: 'Method', value: this.filter.request_method.content });
    }
    if (this.filter.status.content) {
      filters.push({ key: 'status', label: 'Status', value: this.filter.status.content });
    }
    if (this.filter.path.content) {
      filters.push({ key: 'path', label: 'Path', value: this.filter.path.content });
    }
    return filters;
  },
  removeFiltersButtonVariant() {
    return this.hasActiveFilters ? 'outline-danger' : 'outline-secondary';
  },
  removeFiltersButtonTitle() {
    return this.hasActiveFilters ? 'Clear all filters' : 'No active filters';
  },
},
```

Add clearFilter() method:
```javascript
clearFilter(key) {
  if (this.filter[key]) {
    this.filter[key].content = null;
  }
  this.filtered();
},
```

Add filter pills row between filter controls and table (following ManageUser.vue lines 192-219):
```vue
<BRow v-if="hasActiveFilters" class="px-2 pb-2">
  <BCol>
    <BBadge
      v-for="(activeFilter, index) in activeFilters"
      :key="index"
      variant="secondary"
      class="me-2 mb-1"
    >
      {{ activeFilter.label }}: {{ activeFilter.value }}
      <BButton
        size="sm"
        variant="link"
        class="p-0 ms-1 text-light"
        @click="clearFilter(activeFilter.key)"
      >
        <i class="bi bi-x" />
      </BButton>
    </BBadge>
    <BButton
      size="sm"
      variant="link"
      class="p-0"
      @click="removeFilters"
    >
      Clear all
    </BButton>
  </BCol>
</BRow>
```

Import BButton if not already imported in the component:
```javascript
import { BButton } from 'bootstrap-vue-next';
```
(Note: If using auto-import or global registration, this may not be needed)

Add empty state for no matching logs:
```vue
<div v-if="!isBusy && items.length === 0" class="text-center py-4">
  <i class="bi bi-journal-x fs-1 text-muted" />
  <p class="text-muted mt-2">No logs match your filters</p>
  <BButton v-if="hasActiveFilters" variant="link" @click="removeFilters">
    Clear filters
  </BButton>
</div>
```

Place this div before the GenericTable, wrapping the table in a v-else.
  </action>
  <verify>
1. Apply a user filter, verify badge appears with "User: username"
2. Apply method filter, verify badge appears with "Method: GET"
3. Click X on badge to remove individual filter
4. Click "Clear all" to remove all filters
5. With no results, empty state shows with "Clear filters" button
6. Remove filters button changes to danger variant when filters active
  </verify>
  <done>hasActiveFilters and activeFilters computed properties. clearFilter() method. Filter pills row with BBadge. Empty state with clear filters action.</done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. Navigate to /admin/logs
3. User dropdown populated with users from API
4. Select a user, verify:
   - Table filters to show only that user's logs
   - Badge appears: "User: [username]"
   - URL updates with filter param
5. Select a method (e.g., POST), verify:
   - Table filters to show only POST requests
   - Badge appears: "Method: POST"
   - URL updates with filter param
6. Click X on user badge, verify only user filter removed
7. Click "Clear all", verify all filters removed
8. With filters that return no results, verify empty state appears
9. Refresh page with filter URL, verify filters restored from URL
</verification>

<success_criteria>
- Admin can filter logs by user via dropdown (LOG-01)
- Admin can filter logs by HTTP method (LOG-02 partial - action type)
- Active filters displayed as removable badges (LOG-05 feature parity)
- Clear all button removes all filters at once
- Empty state guides user to clear filters when no results
</success_criteria>

<output>
After completion, create `.planning/phases/33-logging-analytics/33-02-SUMMARY.md`
</output>
