---
phase: 27-advanced-features-filters
plan: 10
type: execute
wave: 1
depends_on: []
files_modified:
  - app/src/components/analyses/AnalysesPhenotypeCorrelogram.vue
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "PhenotypeCorrelations page loads without errors"
    - "Correlation matrix visualization renders correctly"
    - "useFilterSync is safely used only for future navigation (optional)"
  artifacts:
    - path: "app/src/components/analyses/AnalysesPhenotypeCorrelogram.vue"
      provides: "Working correlogram component at /PhenotypeCorrelations"
      issue_to_fix: "useFilterSync import may cause issues when component used outside /Analysis route"
  key_links:
    - from: "AnalysesPhenotypeCorrelogram.vue"
      to: "router /PhenotypeCorrelations"
      via: "component renders at route"
      pattern: "PhenotypeCorrelations"
---

<objective>
Fix broken PhenotypeCorrelations page

Purpose: The /PhenotypeCorrelations page is broken, likely due to recent changes introducing useFilterSync for future navigation support. The component needs to work correctly when rendered at both /PhenotypeCorrelations and (potentially) /Analysis routes.
Output: Working PhenotypeCorrelations page with correlation matrix visualization
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

# Component to fix
@app/src/components/analyses/AnalysesPhenotypeCorrelogram.vue
@app/src/composables/useFilterSync.ts
@app/src/router/routes.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Diagnose PhenotypeCorrelations page error</name>
  <files>app/src/components/analyses/AnalysesPhenotypeCorrelogram.vue</files>
  <action>
    Open browser dev tools at http://localhost:5173/PhenotypeCorrelations and identify the error.

    Likely causes:
    1. useFilterSync singleton initialized in wrong context
    2. ColorLegend component import issue
    3. D3.js visualization breaking after recent changes
    4. API endpoint returning unexpected data

    Check the browser console for:
    - JavaScript errors (TypeError, ReferenceError, etc.)
    - Network errors (API calls failing)
    - Vue warnings

    Document the specific error message and stack trace.

    NOTE: This is an investigation task. The developer should check the browser console.
  </action>
  <verify>Error identified (read-only investigation)</verify>
  <done>Root cause of PhenotypeCorrelations page break identified</done>
</task>

<task type="auto">
  <name>Task 2: Make useFilterSync import conditional or remove if unused</name>
  <files>app/src/components/analyses/AnalysesPhenotypeCorrelogram.vue</files>
  <action>
    Based on the error diagnosis, fix the component.

    If the issue is useFilterSync (most likely):

    The current code imports useFilterSync but only uses it for future NAVL-02 navigation:
    ```javascript
    setup() {
      const { makeToast } = useToast();
      // useFilterSync for potential future cluster navigation (NAVL-02)
      const { setTab, setCluster } = useFilterSync();
      return { makeToast, setTab, setCluster };
    },
    ```

    Since NAVL-02 (cluster navigation) is being addressed in Plan 27-09, and the click
    handler currently doesn't use setTab/setCluster, we can safely guard this import.

    Option A - Remove unused import (safest for now):
    ```javascript
    setup() {
      const { makeToast } = useToast();
      // TODO: Add useFilterSync when NAVL-02 is implemented (Plan 27-09)
      return { makeToast };
    },
    ```

    Option B - Guard with try-catch (if we want to keep for future use):
    ```javascript
    setup() {
      const { makeToast } = useToast();

      // useFilterSync may not work outside /Analysis route
      // Will be properly integrated in Plan 27-09
      let setTab = () => {};
      let setCluster = () => {};
      try {
        const filterSync = useFilterSync();
        setTab = filterSync.setTab;
        setCluster = filterSync.setCluster;
      } catch (e) {
        console.warn('useFilterSync not available:', e.message);
      }

      return { makeToast, setTab, setCluster };
    },
    ```

    Option C - If error is NOT useFilterSync related, fix the actual issue.

    Choose the appropriate fix based on Task 1 findings.
  </action>
  <verify>Build succeeds: `cd /home/bernt-popp/development/sysndd/app && npm run build 2>&1 | head -20`</verify>
  <done>Component fix applied</done>
</task>

<task type="auto">
  <name>Task 3: Test PhenotypeCorrelations page</name>
  <files>app/src/components/analyses/AnalysesPhenotypeCorrelogram.vue</files>
  <action>
    Verify the fix works:

    1. Navigate to http://localhost:5173/PhenotypeCorrelations
    2. Verify:
       - Page loads without JavaScript errors
       - Correlation matrix visualization renders
       - ColorLegend displays below the matrix
       - Hover tooltips work on matrix cells
       - Download buttons work (PNG/SVG export)

    3. Also test related routes:
       - /PhenotypeCorrelations/PhenotypeCounts
       - /PhenotypeCorrelations/PhenotypeClusters

    4. Ensure other analysis pages still work:
       - /Analysis (new tabbed analysis view)
       - /Analysis?tab=networks
       - /Analysis?tab=correlation

    If tests pass, the fix is complete.

    Note: This is a manual verification task.
  </action>
  <verify>Manual browser test confirms PhenotypeCorrelations page works</verify>
  <done>PhenotypeCorrelations page loads and functions correctly</done>
</task>

</tasks>

<verification>
- /PhenotypeCorrelations page loads without errors
- Correlation matrix visualization renders correctly
- ColorLegend displays
- Hover tooltips work
- Download buttons work
- Tab navigation between Correlogram/Counts/Clusters works
</verification>

<success_criteria>
- PhenotypeCorrelations page no longer broken
- No regression in other analysis pages
- Future NAVL-02 navigation can be safely added in Plan 27-09
</success_criteria>

<output>
After completion, create `.planning/phases/27-advanced-features-filters/27-10-SUMMARY.md`
</output>
