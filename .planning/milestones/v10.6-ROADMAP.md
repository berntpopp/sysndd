# Milestone v10.6: Curation UX Fixes & Security

**Status:** ✅ SHIPPED 2026-02-10
**Phases:** 83-86
**Total Plans:** 6

## Overview

Fix critical curation workflow regressions blocking Christiane's daily work, clean up ghost entities, patch axios security vulnerability, and add dismiss/auto-dismiss capability for pending queue management.

## Phases

### Phase 83: Status Creation Fix & Security

**Goal**: Fix HTTP 500 on status change, verify approve-both restores, update axios
**Depends on**: v10.6 research
**Plans**: 1 plan

Plans:
- [x] 83-01: Fix status form reset ordering, update axios, verify approve-both

**Details:**
- Fix: Move `resetStatusForm()` before `loadStatusByEntity()` in `showStatusModify()` (ModifyEntity.vue)
- Verify: "Approve both" checkbox appears when status_change exists (ApproveReview.vue)
- Security: Update axios 1.13.4 → 1.13.5 (CVE-2026-25639)
- Backend: Compact NULLs in status_create before tibble conversion
- Requirements: R1, R2, R5

### Phase 84: Status Change Detection

**Goal**: Add frontend change detection to skip status creation when unchanged
**Depends on**: Phase 83
**Plans**: 3 plans

Plans:
- [x] 84-01: Add hasChanges to useStatusForm and useReviewForm composables + tests
- [x] 84-02: Wire change detection into ModifyEntity (status + review forms)
- [x] 84-03: Add change detection to ApproveReview and ApproveStatus + fix review_change indicator

**Details:**
- Added change detection to useStatusForm and useReviewForm composables
- Wired hasChanges into all 3 curation views (ModifyEntity, ApproveReview, ApproveStatus)
- Silent skip on save when no changes detected (prevents unnecessary API calls)
- Unsaved changes warning dialog on modal close
- Local change detection for review form with array comparison (sorted, order-independent)
- Fixed missing review_change indicator in ApproveStatus
- Requirements: R3

### Phase 85: Ghost Entity Cleanup & Prevention

**Goal**: Verify atomic creation prevents future ghosts, update admin issue, enhance test coverage
**Depends on**: Phase 75 (entity creation refactor)
**Plans**: 1 plan

Plans:
- [x] 85-01: Update admin issue, verify prevention, enhance rollback contract tests

**Details:**
- Verified atomic entity creation (svc_entity_create_full) already prevents future ghosts (commit 831ac85a)
- Updated GitHub issue sysndd-administration#2 to reflect prevention is already implemented
- Enhanced entity service tests with 4 rollback error-handling contract tests
- Remaining: Execute SQL remediation for 3 ghost entities (operations task, documented in issue)
- Requirements: R4

### Phase 86: Dismiss & Auto-Dismiss Pending

**Goal**: Add dismiss capability and auto-dismiss siblings on approve for statuses and reviews
**Depends on**: Phase 84, Phase 85
**Plans**: 1 plan

Plans:
- [x] 86-01: Dismiss capability, auto-dismiss siblings, duplicate warnings, integration tests

**Details:**
- Backend: Filter dismissed items from pending queries using `is.na(approving_user_id)`
- Backend: Auto-dismiss sibling pending items when one is approved
- Frontend: Add dismiss button/modal to ApproveStatus and ApproveReview
- Frontend: Add duplicate warning icons and auto-dismiss info alerts in approve modals
- Tests: 40 integration test assertions + full E2E Playwright verification
- No schema changes — uses existing approving_user_id column as dismiss marker
- Requirements: R6

---

## Milestone Summary

**Key Decisions:**
- D83-01: Reset status form BEFORE data load (modal @show fires async, destroys entity_id)
- D83-02: Compact NULLs in status_create before tibble conversion
- D84-01: Exact comparison for all fields including whitespace in comments
- D84-02: Snapshot loaded data immediately after API load completes
- D84-02-01: Wire composable-provided hasChanges for ModifyEntity status form
- D84-02-02: Local change detection for ModifyEntity review form (no composable)
- D84-02-03: Sorted array comparison for review arrays (order-independent)
- D84-03-01: Store loaded data snapshots in component state
- D84-03-03: Check !isBusy in modal hide handler (prevent warning during submit)
- D85-01-01: Test rollback contracts via mocking rather than integration tests
- D85-01-02: Document prevention in GitHub issue rather than code comments
- D86-01-01: Use existing approving_user_id column as dismiss marker (no schema migration)
- D86-01-02: Auto-dismiss only same-entity siblings (cross-entity isolation)
- D86-01-03: Show auto-dismiss warning only when entity has duplicates

**Issues Resolved:**
- HTTP 500 on status change for ATOH1 entities (modal lifecycle race condition)
- "Approve both" checkbox not appearing (symptom of status creation failure)
- Unnecessary status creation when user didn't change anything
- Ghost entity prevention verified (svc_entity_create_full transaction wrapper)
- axios CVE-2026-25639 DoS vulnerability patched
- Pending queue cluttered with no dismiss capability

**Issues Deferred:**
- SQL remediation for 3 ghost entities (4188, 4469, 4474) — operations task documented in sysndd-administration#2
- #167 entity data integrity audit (INTEG-01 through INTEG-06) — not in v10.6 scope

**Technical Debt Incurred:**
- ApproveReview/ApproveStatus use raw classes instead of composables (by design, approved pattern)
- Modal @hide unsaved-changes uses window.confirm (could be custom modal in future)
- ModifyEntity review form uses Options API (not yet refactored to useReviewForm composable)

---

_For current project status, see .planning/ROADMAP.md_
