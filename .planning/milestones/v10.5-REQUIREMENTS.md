# Requirements Archive: v10.5 Bug Fixes & Data Integrity

**Archived:** 2026-02-09
**Status:** SHIPPED

This is the archived requirements specification for v10.5.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

## v1 Requirements

Requirements for v10.5 milestone. Each maps to roadmap phases.

### Data Display Correctness

- [x] **DISP-01**: CurationComparisons shows per-source category values (no cross-database max aggregation) (#173)
- [x] **DISP-02**: Shared `normalize_comparison_categories()` helper extracted to `category-normalization.R` for DRY reuse (#173)
- [x] **DISP-03**: `definitive_only` filter applies per-source, not post-aggregation (#173)
- [x] **DISP-04**: Entity trend chart forward-fills sparse category data via `mergeGroupedCumulativeSeries()` utility (#171)
- [x] **DISP-05**: Global trend total is monotonically non-decreasing (no downward spikes) (#171)

### AdminStatistics Sub-Bugs

- [x] **STAT-01**: Re-review approval synced across all pathways via repository-layer `sync_rereview_approval()` hook (#172-1)
- [x] **STAT-02**: Re-review endpoint simplified to delegate to repository functions (DRY) (#172-1)
- [x] **STAT-03**: Three-segment leaderboard chart: Approved + Pending + Not Submitted (#172-1)
- [x] **STAT-04**: Dynamic percentage denominator from `COUNT(*)` instead of hardcoded 3650 (#172-2)
- [x] **STAT-05**: `totalEntities` KPI computed inside `fetchTrendData()` (no cross-function race) (#172-3)
- [x] **STAT-06**: Inclusive date range: `inclusiveDayCount()` and `previousPeriod()` in `dateUtils.ts` (#172-4)
- [x] **STAT-07**: `safeArray<T>()` and `clampPositive()` utilities prevent crashes and negative bars (#172-5/6)
- [x] **STAT-08**: AbortController cancels in-flight requests on granularity change (#172-7)

### External API Integration

- [x] **API-01**: PubTator annotation fetch uses LEFT JOIN to query only PMIDs missing annotations (#170)
- [x] **API-02**: PubTator batch INSERT uses `INSERT IGNORE` for deduplication (#170)
- [x] **API-03**: PubTator API calls rate-limited at 350ms delay between requests (#170)

### Infrastructure

- [x] **INFRA-01**: Traefik router rule includes `Host()` matcher for deterministic TLS cert selection (#169)
- [x] **INFRA-02**: No "No domain found" Traefik startup warnings (#169)

### Data Integrity Tooling (Deferred to v10.6)

- [ ] **INTEG-01**: Admin endpoint detects suffix-gene misalignment entities via multi-table JOIN (#167) — *Deferred: Phase 83 not started*
- [ ] **INTEG-02**: Fixability classification: auto-fixable vs needs-curator (#167) — *Deferred: Phase 83 not started*
- [ ] **INTEG-03**: Admin view `ManageEntityIntegrity.vue` with entity details and curator actions (#167) — *Deferred: Phase 83 not started*
- [ ] **INTEG-04**: Orphaned pointer (entity 4269) surfaced for curator decision (#167) — *Deferred: Phase 83 not started*
- [ ] **INTEG-05**: Compatibility rows (`is_active=FALSE`) generated for broken inactive entity FKs (#167) — *Deferred: Phase 83 not started*
- [ ] **INTEG-06**: Migration script idempotent with stored procedure guards (#167) — *Deferred: Phase 83 not started*

### Regression Tests

- [x] **TEST-01**: R unit tests for category normalization, re-review sync, dynamic denominator, PubTator incremental query — *Delivered across Phases 80-82*
- [x] **TEST-02**: TypeScript unit tests for `mergeGroupedCumulativeSeries()`, `inclusiveDayCount()`, `previousPeriod()`, `safeArray()`, `clampPositive()` — *Delivered across Phases 80-81*
- [x] **TEST-03**: Integration test for re-review approval sync across pathways

## v2 Requirements

Deferred to future milestones.

- **BACK-01**: Historical re-review backfill script (689 records) -- tracked in berntpopp/sysndd-administration#1
- **BACK-02**: PubTator backfill for ~2,900 PMIDs missing annotations
- **INTEG-07**: Scheduled nightly integrity checks after ontology updates
- **INTEG-08**: Integrity KPI card on AdminStatistics dashboard
- **INTEG-09**: Email alerts on critical entity integrity issues

## Out of Scope

| Feature | Reason |
|---------|--------|
| Automated suffix-gene fixes | Requires curator judgment for 12 of 13 entities |
| Real-time AdminStatistics refresh | Weekly review tool, not live dashboard |
| Bulk entity disease reassignment | Each entity needs individual curator review |
| PubTator full re-fetch on every update | Rate limiting makes this infeasible |
| Chart.js negative bar clamping plugin | Fix data, not rendering |
| Traefik SNI fallback documentation | Fix the root cause instead |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| DISP-01 | Phase 80 | Complete |
| DISP-02 | Phase 80 | Complete |
| DISP-03 | Phase 80 | Complete |
| DISP-04 | Phase 80 | Complete |
| DISP-05 | Phase 80 | Complete |
| INFRA-01 | Phase 80 | Complete |
| INFRA-02 | Phase 80 | Complete |
| STAT-01 | Phase 81 | Complete |
| STAT-02 | Phase 81 | Complete |
| STAT-03 | Phase 81 | Complete |
| STAT-04 | Phase 81 | Complete |
| STAT-05 | Phase 81 | Complete |
| STAT-06 | Phase 81 | Complete |
| STAT-07 | Phase 81 | Complete |
| STAT-08 | Phase 81 | Complete |
| TEST-03 | Phase 81 | Complete |
| API-01 | Phase 82 | Complete |
| API-02 | Phase 82 | Complete |
| API-03 | Phase 82 | Complete |
| TEST-01 | Cross-cutting | Complete |
| TEST-02 | Cross-cutting | Complete |
| INTEG-01 | Phase 83 | Deferred to v10.6 |
| INTEG-02 | Phase 83 | Deferred to v10.6 |
| INTEG-03 | Phase 83 | Deferred to v10.6 |
| INTEG-04 | Phase 83 | Deferred to v10.6 |
| INTEG-05 | Phase 83 | Deferred to v10.6 |
| INTEG-06 | Phase 83 | Deferred to v10.6 |

---

## Milestone Summary

**Shipped:** 21 of 27 v1 requirements
**Adjusted:** TEST-01 and TEST-02 marked complete (delivered across phases, not in Phase 83 as originally mapped)
**Dropped:** 0
**Deferred:** 6 requirements (INTEG-01 through INTEG-06) — Phase 83 not started, deferred to v10.6

---
*Archived: 2026-02-09 as part of v10.5 milestone completion*
