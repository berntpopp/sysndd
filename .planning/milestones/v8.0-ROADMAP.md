# Milestone v8.0: Gene Page & Genomic Data Integration

**Status:** SHIPPED 2026-01-29
**Phases:** 40-46
**Total Plans:** 25

## Overview

Transform the gene detail page from a flat identifier list into a modern genomic analysis interface. Backend proxy layer provides cached access to gnomAD, UniProt, Ensembl, AlphaFold, and MGI/RGD APIs. Frontend delivers constraint scores with visual gauges, ClinVar variant summaries with ACMG color coding, D3.js protein domain lollipop plots, gene structure visualization, 3D AlphaFold structure viewer with variant highlighting, and enhanced model organism phenotypes â€” all with WCAG 2.2 AA accessibility compliance and graceful degradation when external data is unavailable.

## Phases

### Phase 40: Backend External API Layer

**Goal:** Users can access gnomAD, UniProt, Ensembl, AlphaFold, and MGI/RGD data through cached R/Plumber endpoints with rate limiting and error isolation

**Depends on:** None
**Plans:** 5 plans

Plans:
- [x] 40-01: Shared proxy infrastructure (cache backends, retry/throttle, error format)
- [x] 40-02: gnomAD, UniProt, Ensembl proxy functions
- [x] 40-03: AlphaFold, MGI, RGD proxy functions
- [x] 40-04: Plumber endpoints, aggregation, AUTH_ALLOWLIST
- [x] 40-05: Unit tests for proxy infrastructure and endpoints

**Requirements:** PROXY-01 through PROXY-12 (12 total)

---

### Phase 41: Gene Page Redesign

**Goal:** Users see a modern, organized gene page with hero section, grouped information cards, and responsive layout before any external data loads

**Depends on:** None (parallel with Phase 40)
**Plans:** 5 plans

Plans:
- [x] 41-01: Reusable components (IdentifierRow, ResourceLink) and GeneApiData TypeScript interface
- [x] 41-02: Backend: Add bed_hg38 chromosome coordinates to gene API endpoint
- [x] 41-03: Section components (GeneHero, IdentifierCard, ClinicalResourcesCard)
- [x] 41-04: GeneView.vue refactor to Composition API with new component layout
- [x] 41-05: Visual and functional verification checkpoint

**Requirements:** REDESIGN-01 through REDESIGN-10 (10 total)

---

### Phase 42: Constraint Scores & Variant Summaries

**Goal:** Users can immediately assess gene constraint and variant burden through gnomAD pLI/LOEUF scores and ClinVar pathogenicity counts

**Depends on:** Phase 40 (requires gnomAD endpoint)
**Plans:** 3 plans

Plans:
- [x] 42-01: TypeScript interfaces and useGeneExternalData composable (data layer)
- [x] 42-02: GeneConstraintCard and GeneClinVarCard Vue components
- [x] 42-03: GeneView.vue integration and visual verification

**Requirements:** GNOMAD-01 through GNOMAD-05, CLINVAR-01 through CLINVAR-03, COMPOSE-01 through COMPOSE-03, A11Y-01, A11Y-02 (13 total)

---

### Phase 43: Protein Domain Lollipop Plot

**Goal:** Users can visualize protein domains with ClinVar variants mapped to amino acid positions, revealing clustering patterns in functional domains

**Depends on:** Phase 40 (requires UniProt and gnomAD endpoints), Phase 42 (uses ClinVar data)
**Plans:** 4 plans

Plans:
- [x] 43-01: TypeScript interfaces (protein.ts) and useD3Lollipop composable
- [x] 43-02: ProteinDomainLollipopPlot.vue D3 visualization component
- [x] 43-03: ProteinDomainLollipopCard.vue wrapper and GeneView.vue integration
- [x] 43-04: Automated checks and visual verification checkpoint

**Requirements:** PROTEIN-01 through PROTEIN-08, CLINVAR-04, CLINVAR-05, COMPOSE-04, A11Y-03 (12 total)

---

### Phase 44: Gene Structure Visualization

**Goal:** Users can view gene structure with exons, introns, UTRs, and strand orientation from Ensembl canonical transcript

**Depends on:** Phase 40 (requires Ensembl endpoint)
**Plans:** 3 plans

Plans:
- [x] 44-01: TypeScript interfaces (ensembl.ts) and useD3GeneStructure composable
- [x] 44-02: GeneStructurePlot.vue and GeneStructureCard.vue components
- [x] 44-03: GeneView.vue integration and visual verification checkpoint

**Requirements:** GENSTRUCT-01 through GENSTRUCT-04 (4 total)

---

### Phase 45: 3D Protein Structure Viewer

**Goal:** Users can explore AlphaFold 3D structure with pLDDT confidence coloring, toggle representations, and highlight ClinVar variants spatially

**Depends on:** Phase 40 (requires AlphaFold endpoint), Phase 42 (uses ClinVar data for variant highlighting)
**Plans:** 3 plans

Plans:
- [x] 45-01: Install NGL Viewer, AlphaFold types, ACMG constants, use3DStructure composable
- [x] 45-02: ProteinStructure3D and VariantPanel Vue components
- [x] 45-03: GeneView.vue integration with tabbed card and lazy loading

**Requirements:** STRUCT3D-01 through STRUCT3D-08, COMPOSE-05, A11Y-04 (10 total)

---

### Phase 46: Model Organism Phenotypes & Final Integration

**Goal:** Users can view model organism phenotype data from MGI and RGD, with all gene page features integrated and accessibility validated

**Depends on:** Phase 40 (requires MGI/RGD endpoints), all previous phases (final integration)
**Plans:** 3 plans

Plans:
- [x] 46-01: TypeScript interfaces (MGI/RGD) and useModelOrganismData composable
- [x] 46-02: ModelOrganismsCard.vue component and GeneView.vue integration
- [x] 46-03: Accessibility audit (A11Y-05) and visual verification checkpoint

**Requirements:** ORGANISM-01 through ORGANISM-04, A11Y-05 (5 total)

---

## Milestone Summary

**Key Decisions:**
- httr2 for all external API calls (GraphQL POST for gnomAD, REST for others)
- memoise + cachem disk caching with per-source TTL (30d static, 14d stable, 7d dynamic)
- NGL Viewer v2.4.0 for 3D structure (smaller footprint than Mol*)
- Non-reactive D3/NGL instances with markRaw() pattern for Vue 3 compatibility
- Error isolation pattern: partial success with available data on source failures
- Pre-computed gnomAD constraints via bulk TSV import (seconds vs 73 hours per-gene)

**Issues Resolved:**
- MGI API broken (switched to MouseMine API)
- RGD API lookup broken (use internal DB RGD ID instead)
- NGL grey area bug (disabled built-in tooltip)
- Bootstrap lazy tab WebGL initialization (ResizeObserver for valid dimensions)
- ClinVar non-string hgvsp values (defensive type checking)

**Technical Debt Incurred:**
- Missing formal VERIFICATION.md for phases 41-44 (work completed per summaries)
- console.log in ProteinDomainLollipopCard.vue:249 (placeholder for zoom reset feature)
- useModelOrganismData not in composables barrel export (direct import works)
- Human verification items pending (pLDDT colors, WebGL cleanup, Lighthouse score)

---

*For current project status, see .planning/ROADMAP.md*
*Archived: 2026-01-29*
