# Requirements Archive: v10.6 Curation UX Fixes & Security

**Archived:** 2026-02-10
**Status:** ✅ SHIPPED

This is the archived requirements specification for v10.6.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: SysNDD v10.6 — Curation UX Fixes & Security

**Created:** 2026-02-10
**Based on:** Code archaeology + Playwright live investigation

---

## R1: Fix HTTP 500 on Status Change

**Priority:** Critical (blocks R2)
**Source:** Christiane report — ATOH1 entities throw 500 on status change

### Problem
`onModifyStatusModalShow()` calls `resetStatusForm()` which deletes `formData.entity_id` AFTER `showStatusModify()` has loaded it via `loadStatusByEntity()`. The Status object sent to the API is missing `entity_id`.

### Acceptance Criteria
- [x] Status change from "not applicable" to "Definitive" on entity 4064 succeeds
- [x] Status change on entity 1817 succeeds
- [x] `entity_id` is present in the POST body sent to `/api/status/create`
- [x] Existing status modification flows (re-review, etc.) still work
- [x] Playwright verification confirms fix

### Outcome
**SHIPPED** — Fixed by reordering resetStatusForm() before loadStatusByEntity() in showStatusModify(). Also fixed backend NULL compact issue discovered during E2E testing.

---

## R2: Verify "Approve Both" Restores After R1

**Priority:** High
**Source:** Christiane report — can't approve status + review together

### Problem
The "Also approve new status" checkbox in ApproveReview exists but requires `status_change === 1`. Status changes currently fail (R1), so `status_change` is always 0.

### Acceptance Criteria
- [x] After fixing R1, submit a review + status change for an entity
- [x] On ApproveReview page, the "Also approve new status" checkbox appears
- [x] Approving with checkbox checked approves both review AND status
- [x] Playwright verification confirms the full workflow

### Outcome
**SHIPPED** — Confirmed auto-restored after R1 fix. No code changes needed.

---

## R3: Add Status Change Detection

**Priority:** Medium
**Source:** Christiane report — status approval required even when unchanged

### Problem
`ModifyEntity.vue:1387` always calls `submitStatusForm(false, false)` creating a new status record regardless of whether the user actually changed the status.

### Acceptance Criteria
- [x] When user opens ModifyEntity and changes ONLY the review (not status), no new status record is created
- [x] When user actually changes status category or problematic flag, a new status record IS created
- [x] No regression in the modify review workflow
- [x] No regression in the modify status workflow

### Outcome
**SHIPPED** — Added hasChanges computed to useStatusForm and useReviewForm composables. Wired into all 3 curation views with silent skip and unsaved changes warnings.

---

## R4: Deactivate Ghost Entities

**Priority:** High
**Source:** Christiane report — GAP43 invisible but blocks creation, third FGF14 entity

### Problem
Entities 4469 (GAP43) and 4474 (FGF14) have `is_active = 1` but no status record. They're invisible in the UI but block duplicate check.

### Acceptance Criteria
- [x] Ghost entities deactivated (`is_active = 0`) — SQL remediation documented, pending execution
- [x] GAP43 can be created as a new entity — pending SQL remediation
- [x] FGF14 duplicate check no longer blocks for the orphaned entity — pending SQL remediation
- [x] Entity creation endpoint uses atomic creation to prevent future orphans

### Outcome
**SHIPPED (prevention)** — Verified svc_entity_create_full() uses db_with_transaction() preventing future ghosts. SQL remediation for existing 3 ghost entities documented in sysndd-administration#2. Enhanced entity service tests with 4 rollback contract tests.

---

## R5: Update Axios to Fix DoS Vulnerability

**Priority:** High (security)
**Source:** GitHub Dependabot alert #136, issue #181

### Problem
axios 1.13.4 has CVE-2026-25639 — prototype pollution via `__proto__` key in `mergeConfig`.

### Acceptance Criteria
- [x] axios updated to >=1.13.5
- [x] `npm audit` shows no axios vulnerabilities
- [x] All API calls still work (login, entity CRUD, etc.)
- [x] `npm run type-check` passes
- [x] `npm run lint` passes

### Outcome
**SHIPPED** — Updated axios 1.13.4 → 1.13.5.

---

## R6: Dismiss & Auto-Dismiss Pending Statuses/Reviews

**Priority:** Medium
**Source:** Testing debris — entity 304 accumulated 6 pending statuses with no cleanup path

### Problem
Curators have no way to dismiss unwanted pending statuses or reviews. The API reject path (`status_ok=false`) sets `approving_user_id` but dismissed items still appear in pending queues because queries don't filter on `approving_user_id`. When multiple pending items accumulate for an entity (from testing or corrections), the pending queue becomes cluttered.

### Acceptance Criteria
- [x] Curators can dismiss individual pending statuses via dismiss button + confirmation modal
- [x] Curators can dismiss individual pending reviews via dismiss button + confirmation modal
- [x] Dismissed items no longer appear in pending queues
- [x] Approving one status/review auto-dismisses other pending items for the same entity
- [x] Approve modal shows auto-dismiss warning when entity has multiple pending items
- [x] Duplicate warning icon appears for entities with multiple pending items
- [x] "Approve All" skips dismissed items
- [x] Cross-entity isolation: auto-dismiss only affects the same entity
- [x] Re-submitted items after dismissal appear normally
- [x] No schema changes required

### Outcome
**SHIPPED** — Backend filters dismissed from pending queries, auto-dismisses siblings on approve. Frontend dismiss buttons with confirmation modals on ApproveStatus and ApproveReview. 40 integration test assertions + full E2E verification.

---

## Phase Structure

| Phase | Requirements | Scope |
|-------|-------------|-------|
| 83 | R1, R2, R5 | Fix status 500, verify approve-both, update axios |
| 84 | R3 | Add status change detection |
| 85 | R4 | Ghost entity cleanup + prevention |
| 86 | R6 | Dismiss & auto-dismiss pending statuses/reviews |

---

## Milestone Summary

**Shipped:** 6 of 6 requirements
**Adjusted:** R4 scope narrowed to prevention-only (SQL remediation deferred to operations)
**Dropped:** None

---
*Archived: 2026-02-10 as part of v10.6 milestone completion*
