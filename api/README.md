# SysNDD-API

## Overview
This folder contains scripts and data for the SysNDD API, which is part of the SysNDD database project for gene-disease relationships in neurodevelopmental disorders.
The repository for the public application programming interface (API) of SysNDD enabling programmatic access to the database.
The API is written in R using the plumber package to generate an OpenAPI/ Swagger interface.

## Directory Structure

```
.
│   README.md
│   .gitignore
│   .lintr                    # R code linting configuration
│   config.yml
│   Dockerfile
│   start_sysndd_api.R        # Main entry point - mounts all endpoints
│
├───config
│       api_spec.json
│
├───data
│       [data files]
│       README.md
│
├───endpoints                 # 21 modular endpoint files
│       admin_endpoints.R
│       analysis_endpoints.R
│       authentication_endpoints.R
│       comparisons_endpoints.R
│       entity_endpoints.R
│       external_endpoints.R
│       gene_endpoints.R
│       hash_endpoints.R
│       list_endpoints.R
│       logging_endpoints.R
│       ontology_endpoints.R
│       panels_endpoints.R
│       phenotype_endpoints.R
│       publication_endpoints.R
│       re_review_endpoints.R
│       review_endpoints.R
│       search_endpoints.R
│       statistics_endpoints.R
│       status_endpoints.R
│       user_endpoints.R
│       variant_endpoints.R
│
├───functions
│       .lintr
│       analyses-functions.R
│       config-functions.R
│       database-functions.R
│       endpoint-functions.R
│       external-functions.R
│       genereviews-functionsy.R
│       helper-functions.R
│       logging-functions.R
│       publication-functions.R
│
├───logs
│       [log files]
│
├───results
│       [results files]
│
└───scripts                   # Development and quality tools
        lint-check.R          # Code linting
        style-code.R          # Code formatting
        lint-and-fix.R        # Combined quality check
        pre-commit-check.R    # Pre-commit validation
        endpoint-inventory.R  # Extract all API routes to CSV
        verify-endpoints.R    # Verify endpoints against running API
```

## Core Files
- `README.md`: Documentation for the API.
- `.gitignore`: Configuration file.
- `.lintr`: R code linting configuration following tidyverse style guide.
- `config.yml`: Configuration settings for the API.
- `Dockerfile`: Instructions for Docker container setup.
- `start_sysndd_api.R`: Main entry point that loads and mounts all 21 endpoint modules.

## Subdirectories
- `config`: Contains `api_spec.json` for API specifications.
- `data`: Includes data files used by the API.
- `endpoints`: 21 modular endpoint files organized by domain (entity, gene, phenotype, auth, etc.).
- `functions`: Holds R scripts for various functions (analyses, database interactions, etc.).
- `logs`: Contains log files for API operations.
- `results`: Stores result files generated by the API.
- `scripts`: Development tools for code quality, linting, formatting, and endpoint verification.

## API Endpoints

The API uses a modular structure with endpoints organized by domain. Each endpoint file in `endpoints/` is mounted at `/api/<resource>`:

| Mount Path | Endpoint File | Description |
|------------|---------------|-------------|
| /api/admin | admin_endpoints.R | Administrative operations and system management |
| /api/analysis | analysis_endpoints.R | Data analysis and visualization endpoints |
| /api/auth | authentication_endpoints.R | User authentication and session management |
| /api/comparisons | comparisons_endpoints.R | Entity comparison functionality |
| /api/entity | entity_endpoints.R | Entity CRUD operations and queries |
| /api/external | external_endpoints.R | External API proxies and integrations |
| /api/gene | gene_endpoints.R | Gene information and annotations |
| /api/hash | hash_endpoints.R | Hash validation and verification |
| /api/list | list_endpoints.R | List generation and filtering |
| /api/logs | logging_endpoints.R | API logging and audit trails |
| /api/ontology | ontology_endpoints.R | Ontology services and term lookup |
| /api/panels | panels_endpoints.R | Gene panel management |
| /api/phenotype | phenotype_endpoints.R | Phenotype data and HPO terms |
| /api/publication | publication_endpoints.R | Publication references and metadata |
| /api/re_review | re_review_endpoints.R | Re-review workflow for entities |
| /api/review | review_endpoints.R | Review workflow and approval process |
| /api/search | search_endpoints.R | Search functionality across entities |
| /api/statistics | statistics_endpoints.R | Database statistics and metrics |
| /api/status | status_endpoints.R | Entity status management |
| /api/user | user_endpoints.R | User management and profiles |
| /api/variant | variant_endpoints.R | Variant data and annotations |

All endpoints are automatically mounted when starting the API via `start_sysndd_api.R`.

## Setup and Usage

### Prerequisites
1. Install R (version 4.0+ recommended)
2. Install required R packages:
   ```r
   install.packages(c("plumber", "pool", "DBI", "RMariaDB", "tidyverse", 
                      "jose", "config", "lintr", "styler"))
   ```

### Running the API
```bash
# Start the API server
Rscript start_sysndd_api.R

# The API will be available at:
# - Local: http://localhost:7778
# - Production: http://localhost:7777
```

### Development Commands

#### Code Quality Tools
```bash
# Check code style and quality
Rscript scripts/lint-check.R

# Auto-fix style issues with styler
Rscript scripts/lint-check.R --fix

# Format code according to tidyverse style
Rscript scripts/style-code.R

# Complete quality check and fix
Rscript scripts/lint-and-fix.R

# Pre-commit validation (fast)
Rscript scripts/pre-commit-check.R

# Preview formatting changes without applying
Rscript scripts/style-code.R --dry-run
```

#### Endpoint Verification Tools
```bash
# Generate CSV inventory of all 93 API endpoints
Rscript scripts/endpoint-inventory.R
# Output: results/endpoint-checklist.csv

# Verify endpoints against running API (API must be running)
Rscript scripts/verify-endpoints.R

# Verify against custom host/port
Rscript scripts/verify-endpoints.R --host localhost --port 7778
```

#### Quick Development Workflow
1. Make your code changes
2. Run `Rscript scripts/pre-commit-check.R` for fast validation
3. Run `Rscript scripts/lint-and-fix.R` for comprehensive quality check
4. Commit your changes

## Code Quality Standards

This API follows the **tidyverse style guide** with automated enforcement through `lintr` and `styler`:

### Style Requirements
- **Line Length**: Maximum 100 characters
- **Indentation**: 2 spaces (no tabs)
- **Assignment**: Use `<-` instead of `=`
- **Spacing**: Consistent spacing around operators and after commas
- **Naming**: snake_case for variables and functions

### Configuration
- **`.lintr`**: Main linting configuration in project root
- **`functions/.lintr`**: Additional function-specific rules
- **Excluded**: `data/`, `logs/`, `results/` directories

### Pre-commit Hooks
Consider running `Rscript scripts/pre-commit-check.R` before each commit to catch issues early.

## Contribution
Contributions are welcome! Please follow these guidelines:

1. **Code Quality**: Ensure all code passes `scripts/lint-and-fix.R`
2. **Style Guide**: Follow tidyverse conventions
3. **Documentation**: Use roxygen2 comments for all functions
4. **Testing**: Test your changes locally before submitting
5. **Pull Requests**: Follow the standard GitHub pull request process

## License
- All code from this project is licensed under the "MIT No Attribution" (MIT-0) License - see the LICENSE.md file for details.
- The project data, website and api usage are licensed under the "Attribution 4.0 International" (CC BY 4.0) License - see the [https://creativecommons.org/licenses/by/4.0/](https://creativecommons.org/licenses/by/4.0/) for details.