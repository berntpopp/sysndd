# SysNDD-API

## Overview
This folder contains scripts and data for the SysNDD API, which is part of the SysNDD database project for gene-disease relationships in neurodevelopmental disorders.
The repository for the public application programming interface (API) of SysNDD enabling programmatic access to the database.
The API is written in R using the plumber package to generate an OpenAPI/ Swagger interface.

## Directory Structure

```
.
│   README.md
│   .gitignore
│   .lintr                    # R code linting configuration
│   config.yml
│   Dockerfile
│   start_sysndd_api.R
│   sysndd_plumber.R
│   
├───config
│       api_spec.json
│       
├───data
│       [data files]
│       README.md
│
├───endpoints
│       [modular API endpoint files]
│       
├───functions
│       .lintr
│       analyses-functions.R
│       config-functions.R
│       database-functions.R
│       endpoint-functions.R
│       external-functions.R
│       genereviews-functionsy.R
│       helper-functions.R
│       logging-functions.R
│       publication-functions.R
│
├───logs
│       [log files]
│
├───results
│       [results files]
│
├───scripts                   # Development and quality tools
│       lint-check.R          # Code linting
│       style-code.R          # Code formatting  
│       lint-and-fix.R        # Combined quality check
│       pre-commit-check.R    # Pre-commit validation
│
└───_old
        [old versions of files]
```

## Core Files
- `README.md`: Documentation for the API.
- `.gitignore`: Configuration file.
- `.lintr`: R code linting configuration following tidyverse style guide.
- `config.yml`: Configuration settings for the API.
- `Dockerfile`: Instructions for Docker container setup.
- `start_sysndd_api.R`: Script to start the API server.
- `sysndd_plumber.R`: Script defining API endpoints and operations.

## Subdirectories
- `config`: Contains `api_spec.json` for API specifications.
- `data`: Includes data files used by the API.
- `endpoints`: Modular API endpoint definitions organized by functionality.
- `functions`: Holds R scripts for various functions (analyses, database interactions, etc.).
- `logs`: Contains log files for API operations.
- `results`: Stores result files generated by the API.
- `scripts`: Development tools for code quality, linting, and formatting.
- `_old`: Archives older versions of certain files.

## Setup and Usage

### Prerequisites
1. Install R (version 4.0+ recommended)
2. Install required R packages:
   ```r
   install.packages(c("plumber", "pool", "DBI", "RMariaDB", "tidyverse", 
                      "jose", "config", "lintr", "styler"))
   ```

### Running the API
```bash
# Start the API server
Rscript start_sysndd_api.R

# The API will be available at:
# - Local: http://localhost:7778
# - Production: http://localhost:7777
```

### Development Commands

#### Code Quality Tools
```bash
# Check code style and quality
Rscript scripts/lint-check.R

# Auto-fix style issues with styler
Rscript scripts/lint-check.R --fix

# Format code according to tidyverse style
Rscript scripts/style-code.R

# Complete quality check and fix
Rscript scripts/lint-and-fix.R

# Pre-commit validation (fast)
Rscript scripts/pre-commit-check.R

# Preview formatting changes without applying
Rscript scripts/style-code.R --dry-run
```

#### Quick Development Workflow
1. Make your code changes
2. Run `Rscript scripts/pre-commit-check.R` for fast validation
3. Run `Rscript scripts/lint-and-fix.R` for comprehensive quality check
4. Commit your changes

## Code Quality Standards

This API follows the **tidyverse style guide** with automated enforcement through `lintr` and `styler`:

### Style Requirements
- **Line Length**: Maximum 100 characters
- **Indentation**: 2 spaces (no tabs)
- **Assignment**: Use `<-` instead of `=`
- **Spacing**: Consistent spacing around operators and after commas
- **Naming**: snake_case for variables and functions

### Configuration
- **`.lintr`**: Main linting configuration in project root
- **`functions/.lintr`**: Additional function-specific rules
- **Excluded**: `_old/`, `data/`, `logs/`, `results/` directories

### Pre-commit Hooks
Consider running `Rscript scripts/pre-commit-check.R` before each commit to catch issues early.

## Contribution
Contributions are welcome! Please follow these guidelines:

1. **Code Quality**: Ensure all code passes `scripts/lint-and-fix.R`
2. **Style Guide**: Follow tidyverse conventions
3. **Documentation**: Use roxygen2 comments for all functions
4. **Testing**: Test your changes locally before submitting
5. **Pull Requests**: Follow the standard GitHub pull request process

## License
- All code from this project is licensed under the "MIT No Attribution" (MIT-0) License - see the LICENSE.md file for details.
- The project data, website and api usage are licensed under the "Attribution 4.0 International" (CC BY 4.0) License - see the [https://creativecommons.org/licenses/by/4.0/](https://creativecommons.org/licenses/by/4.0/) for details.