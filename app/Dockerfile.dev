# Development Dockerfile for Vue.js with Vite Hot Module Reload
#
# Purpose: Development environment with Vite dev server HMR
# NOT FOR PRODUCTION - Use app/Dockerfile for production builds
#
# Source code is mounted via docker-compose.override.yml or Compose Watch
# This file only installs dependencies; source code comes from volume mount
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.override.yml up app

# Match production Node version (24 LTS for Vite 7 compatibility)
ARG NODE_VERSION=24

FROM node:${NODE_VERSION}-alpine

# Set working directory
WORKDIR /app

# Copy dependency manifests
COPY package*.json ./

# Install dependencies with BuildKit cache mount
# --legacy-peer-deps required by existing package.json (matches production)
RUN --mount=type=cache,target=/root/.npm \
    npm ci --no-audit --no-fund --legacy-peer-deps

# Environment variables for Vite dev server
ENV NODE_ENV=development
ENV HOST=0.0.0.0

# Expose Vite dev server port
EXPOSE 5173

# Health check with longer start-period for Vite first compilation
# Vite is faster than webpack, but first load still takes time
# Use 127.0.0.1 instead of localhost (IPv6 resolution issues in Alpine)
HEALTHCHECK --interval=30s --timeout=5s --start-period=60s --retries=3 \
    CMD wget --spider --tries=1 --no-verbose http://127.0.0.1:5173/ || exit 1

# Start Vite dev server
# --host 0.0.0.0 allows external connections (required for Docker/Traefik)
# --mode docker uses .env.docker with correct API URL (through Traefik)
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--mode", "docker"]
