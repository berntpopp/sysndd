// Enhanced table styling for medical database application
// Includes zebra striping, row hover, and improved border styling

:root {
  // Table background colors (subtle per CONTEXT.md)
  --bs-table-striped-bg: rgba(0, 0, 0, 0.02); // Very subtle zebra striping
  --bs-table-hover-bg: rgba(13, 71, 161, 0.05); // Medical blue at 5% for row hover

  // Table border colors
  --table-border-color: rgba(0, 0, 0, 0.08); // Softer than default Bootstrap
  --table-header-border: rgba(0, 0, 0, 0.12); // Slightly stronger for header bottom
}

// Base table styling enhancements
.table {
  // Softer borders throughout
  border-color: var(--table-border-color);

  // Remove double borders between cells
  > :not(caption) > * > * {
    border-bottom-width: 1px;
    border-color: var(--table-border-color);
  }

  // Table headers - enhanced styling
  thead {
    th {
      font-weight: 600;
      border-bottom: 2px solid var(--table-header-border);
      vertical-align: middle;
    }
  }

  // Fixed layout tables - ensure header text truncation
  &.b-table-fixed,
  &[style*="table-layout: fixed"] {
    thead th {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    // Cell truncation for fixed layout
    td {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  }

  // Light header variant (commonly used in application)
  .thead-light th {
    background-color: var(--neutral-100);
    color: var(--neutral-900);
  }
}

// Zebra striping (subtle alternating row colors)
.table-striped {
  > tbody > tr:nth-of-type(odd) > * {
    background-color: var(--bs-table-striped-bg);
  }
}

// Row hover state (subtle highlight for tracking across wide tables)
.table-hover {
  > tbody > tr {
    transition: background-color var(--transition-fast);

    &:hover > * {
      background-color: var(--bs-table-hover-bg);
    }
  }
}

// Combined striped + hover: ensure hover takes precedence
.table-striped.table-hover {
  > tbody > tr:hover > * {
    background-color: var(--bs-table-hover-bg);
  }
}

// Compact table variant for data-heavy views
// Use on genes, entities tables where density is important
.table-compact {
  th,
  td {
    padding: 0.375rem 0.5rem; // Tighter than Bootstrap default (0.5rem 0.75rem)
    font-size: 0.875rem; // Slightly smaller text
  }

  // Even tighter header padding
  thead th {
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
  }
}

// Table container with border radius
.table-responsive,
.table-container {
  border-radius: var(--border-radius-base);
  overflow: hidden; // Ensures border-radius applies to inner table
}

// Bordered tables - refine border styling
.table-bordered {
  border-color: var(--table-border-color);

  > :not(caption) > * {
    border-width: 1px;
    border-color: var(--table-border-color);
  }

  > :not(caption) > * > * {
    border-width: 0 1px;
    border-color: var(--table-border-color);
  }
}

// Sort indicator styling for table headers
// Bootstrap-Vue-Next BTable adds aria-sort attributes automatically
.table {
  thead {
    // Sortable column headers - base styling
    th[aria-sort] {
      cursor: pointer;
      user-select: none;
      position: relative;
      padding-right: 1.5rem; // Extra space for sort icon
      transition: background-color var(--transition-fast);

      // Hover state for sortable headers
      &:hover {
        background-color: rgba(13, 71, 161, 0.03);
      }

      // Active sort column highlight (per CONTEXT: "Icon + highlight")
      &:not([aria-sort="none"]) {
        background-color: rgba(13, 71, 161, 0.08);
        font-weight: 600;
      }

      // Sort icon using CSS pseudo-element
      &::after {
        content: "";
        position: absolute;
        right: 0.5rem;
        top: 50%;
        transform: translateY(-50%);
        border-left: 0.25rem solid transparent;
        border-right: 0.25rem solid transparent;
        opacity: 0.3;
      }

      // Ascending sort icon (up arrow)
      &[aria-sort="ascending"]::after {
        border-bottom: 0.35rem solid currentColor;
        opacity: 1;
      }

      // Descending sort icon (down arrow)
      &[aria-sort="descending"]::after {
        border-top: 0.35rem solid currentColor;
        opacity: 1;
      }

      // Neutral/none state - show both arrows stacked
      &[aria-sort="none"]::after {
        border-bottom: 0.35rem solid currentColor;
        margin-top: -0.2rem;
      }

      &[aria-sort="none"]::before {
        content: "";
        position: absolute;
        right: 0.5rem;
        top: 50%;
        transform: translateY(-50%);
        border-left: 0.25rem solid transparent;
        border-right: 0.25rem solid transparent;
        border-top: 0.35rem solid currentColor;
        opacity: 0.3;
        margin-top: 0.2rem;
      }

      // Focus state for keyboard navigation (WCAG 2.2)
      &:focus-visible {
        outline: var(--focus-ring-width) solid var(--focus-ring-color);
        outline-offset: calc(-1 * var(--focus-ring-width)); // Inset focus ring
        z-index: 1;
      }

      // Remove default focus for mouse users
      &:focus:not(:focus-visible) {
        outline: none;
      }
    }
  }
}

// Stacked table mode overrides (mobile)
// Bootstrap-Vue-Next stacked tables render each cell as a flex row
// with a ::before pseudo-element label. The fixed-layout truncation
// rules (white-space: nowrap, overflow: hidden) break this layout.
.b-table-stacked-md,
.b-table-stacked-sm,
.b-table-stacked {
  td {
    white-space: normal !important;
    overflow: visible !important;
    text-overflow: clip !important;

    // Ensure the ::before label and cell value don't overlap
    &::before {
      white-space: normal;
      word-break: break-word;
      min-width: 40%;
      flex-shrink: 0;
      float: none !important; // Neutralize BVN float on stacked pseudo-labels
      width: auto !important;
    }
  }

  // Details row inner table also needs wrapping
  .b-table {
    td {
      white-space: normal !important;
      overflow: visible !important;
      text-overflow: clip !important;
    }
  }
}

// WCAG 2.2 NFR-03.6: Respect reduced motion preferences
// Transitions already use var(--transition-fast) which becomes 0.01ms with prefers-reduced-motion
// No additional overrides needed
